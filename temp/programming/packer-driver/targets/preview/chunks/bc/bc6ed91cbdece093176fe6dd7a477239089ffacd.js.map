{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/TSGFDemo/Demo/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/mainMenu/SelectStageLayer.ts"],"names":["_decorator","Component","Node","Prefab","instantiate","Label","find","director","JsonAsset","UITransform","Sprite","Material","ScrollView","em","ggd","glf","ccclass","property","SelectCheckpointLayer","_isLoading","_mapName","_prefabArr","_initPos","y","gap","changePos","changeRank","_stageTotal","onLoad","getStageTotal","initPrefabs","onEnable","scheduleOnce","prefab","stageNum","stageProgress","getComponent","material","grayMaterial","defaultMaterial","percentage","totalStage","node","getChildByName","scrollToPercentVertical","all","stageConfigJson","json","len","key","Object","prototype","hasOwnProperty","call","total","i","SCPrefab","parent","prefabPar","setPosition","active","string","btNode","createButton","push","detail","UIT","toBottom","setContentSize","width","Math","abs","showStageDetail","e","target","stageDetail","des","getStageDesByStageNum","stageData","length","time","stageDesJson","strongList","stageStrongJson","blood","damage","moveSpeed","onBtnCloseDetail","onBtnCheckpoint","console","log","onBtnEnter","update","dt","updatePrefabs","wp","getWorldPosition","pwp","offset","setWorldPosition","x","z","p","openLoading","curStage","parseInt","loadScene","dispatch","warn","onBtnChangeStage"],"mappings":"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","sourcesContent":["\r\n/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-09-05 11:37:53\r\n * @LastEditors: li_jiang_wei 739671694@qq.com\r\n * @LastEditTime: 2022-12-11 21:09:53\r\n * @FilePath: \\to-be-immortal\\assets\\script\\mainMenu\\SelectStageLayer.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, Prefab, instantiate, Label, find, director, input, Input, JsonAsset, UITransform, utils, UI, Sprite, Material, ScrollView } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nimport { ggd } from '../global/globalData';\r\nimport { glf } from '../global/globalFun';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('SelectStageLayer')\r\nexport class SelectCheckpointLayer extends Component {\r\n    @property(Prefab)\r\n    SCPrefab;\r\n    @property(Node)\r\n    prefabPar;\r\n    @property(JsonAsset)\r\n    stageConfigJson;\r\n    @property(JsonAsset)\r\n    stageDesJson;\r\n    @property(JsonAsset)\r\n    stageStrongJson;\r\n    @property(Material)\r\n    grayMaterial;\r\n    @property(Material)\r\n    defaultMaterial;\r\n    @property(Node)\r\n    stageDetail;\r\n\r\n    _isLoading = false;\r\n    _mapName = {\r\n        \"1\": \"青青草原\",\r\n        \"2\": \"暗黑大陆\",\r\n        \"3\": \"晨星荒漠\",\r\n        \"4\": \"绝命谷\",\r\n        \"5\": \"寂静岭\",\r\n        \"6\": \"灼烧大陆\",\r\n        \"7\": \"无声荒漠\",\r\n        \"8\": \"虚无之地\",\r\n        \"9\": \"极寒之地\",\r\n        \"10\": \"魔幻大陆\"\r\n    }\r\n    _prefabArr = [];\r\n    _initPos = {\r\n        y: -300,\r\n        gap: -400,\r\n        changePos: 1000,\r\n        changeRank: 5\r\n    }\r\n    _stageTotal = 0;\r\n    onLoad() {\r\n        this._stageTotal = this.getStageTotal();\r\n        this.initPrefabs();\r\n    }\r\n    onEnable() {\r\n        // this.updatePrefabs();\r\n        //刷新材质\r\n        this.scheduleOnce(() => {\r\n            for (const prefab of this._prefabArr) {\r\n                if (prefab.stageNum > ggd.stageProgress) {\r\n                    prefab.getComponent(Sprite).material = this.grayMaterial;\r\n                } else {\r\n                    prefab.getComponent(Sprite).material = this.defaultMaterial;\r\n                }\r\n            }\r\n        }, 0);\r\n        let percentage = (ggd.stageProgress - 1) / ggd.totalStage;\r\n        this.node.getChildByName(\"bg\").getComponent(ScrollView).scrollToPercentVertical(1 - percentage, 0.1);\r\n    }\r\n    //获取关卡总数\r\n    getStageTotal() {\r\n        let all = this.stageConfigJson.json;\r\n        let len = 0;\r\n        for (const key in all) {\r\n            if (Object.prototype.hasOwnProperty.call(all, key)) {\r\n                len++;\r\n            }\r\n        } \r\n        return len;\r\n        // return 60;\r\n    }\r\n    initPrefabs() {\r\n        let total = 5;\r\n        for (let i = 0; i < total; i++) {\r\n            let prefab = instantiate(this.SCPrefab);\r\n            prefab.parent = this.prefabPar;\r\n            prefab.setPosition(0, this._initPos.y + i * this._initPos.gap);\r\n            let stageNum = i + 1;\r\n            prefab.stageNum = stageNum;\r\n\r\n            if (prefab.stageNum > ggd.stageProgress) {\r\n                prefab.getChildByName(\"btnBg\").getChildByName(\"stageLock\").active = true;\r\n                prefab.getComponent(Sprite).material = this.grayMaterial;\r\n            } else {\r\n                prefab.getChildByName(\"btnBg\").getChildByName(\"stageLock\").active = false;\r\n                prefab.getComponent(Sprite).material = this.defaultMaterial;\r\n            }\r\n            prefab.getChildByName(\"Label\").getComponent(Label).string = \"第\" + stageNum + \"关\";\r\n            let btNode = prefab.getChildByName(\"btnBg\");\r\n            glf.createButton(this.node, btNode, \"SelectStageLayer\", \"onBtnEnter\");\r\n            this._prefabArr.push(prefab);\r\n            // this.showStageDetail(stageNum);\r\n            let detail = prefab.getChildByName(\"detail\");\r\n            glf.createButton(this.node, detail, \"SelectStageLayer\", \"showStageDetail\");\r\n        };\r\n        let UIT = this.prefabPar.getComponent(UITransform);\r\n        let toBottom = 200;\r\n        UIT.setContentSize(UIT.width, this._stageTotal * Math.abs(this._initPos.gap) + toBottom);\r\n        // UIT.setContentSize(UIT.width, this._stageTotal * Math.abs(this._initPos.gap));\r\n        // this.prefabPar.height = this._stageTotal * Math.abs(this._initPos.gap);\r\n    }\r\n    /**\r\n     * @description 展示关卡详情\r\n     * @param {Node} prefab 通过prefab.stageNum 属性 获取相应关卡详情\r\n    */\r\n    showStageDetail(e) {\r\n        let prefab = e.target.parent;\r\n        this.stageDetail.active = true;\r\n        let stageNum = prefab.stageNum;\r\n        let des: string = \"\";\r\n        if (stageNum > ggd.stageProgress) des = \"尚未可知。\"\r\n        else des = this.getStageDesByStageNum(stageNum);\r\n        find(\"bg/title\", this.stageDetail).getComponent(Label).string = \"第\" + stageNum + \"关\";\r\n        find(\"bg/content\", this.stageDetail).getComponent(Label).string = des;\r\n    }\r\n    getStageDesByStageNum(stageNum) {\r\n        let des = \"\";\r\n        let stageData = this.stageConfigJson.json[\"stage\" + stageNum];\r\n        des = \"游戏时长：\" + stageData[stageData.length - 1].time / 60 + \"分钟\";\r\n        des += \"\\n\";\r\n        if (stageNum <= 5) des += \"建议等级：炼气期\\n通关奖励：一阶物品\";\r\n        else if (stageNum <= 10) des += \"建议等级：筑基期\\n通关奖励：二阶物品\";\r\n        else if (stageNum <= 20) des += \"建议等级：结丹期\\n通关奖励：三阶物品\";\r\n        else if (stageNum <= 40) des += \"建议等级：元婴期\\n通关奖励：四阶物品\";\r\n        else des += \"通关奖励：五阶物品\\n建议等级：化神期\";\r\n        if (this.stageDesJson.json[\"stage\" + stageNum]) des = des + \"\\n关卡描述：\" + this.stageDesJson.json[\"stage\" + stageNum];\r\n        let strongList = this.stageStrongJson.json[\"stage\" + stageNum];\r\n        if(strongList&&(strongList.blood||strongList.damage||strongList.moveSpeed)){\r\n            des = des + \"\\n怪物属性强化：\";\r\n            if(strongList.blood) des = des + \"\\n血量增加\"+strongList.blood*100 + \"%\";\r\n            if(strongList.damage) des = des + \"\\n伤害增加\"+strongList.damage*100 + \"%\";\r\n            if(strongList.moveSpeed) des = des + \"\\n移速增加\"+strongList.moveSpeed*100 + \"%\";\r\n        } \r\n        return des;\r\n    }\r\n    // getStageDesByStageNum(stageNum) {\r\n    //     let des = \"\";\r\n    //     let stageData = this.stageConfigJson.json[\"stage\" + stageNum];\r\n    //     des = \"游戏时长：\" + stageData[stageData.length - 1].time / 60 + \"分钟\";\r\n    //     des += \"\\n\";\r\n    //     if (stageNum <= 5) des += \"通关奖励：一阶物品\\n建议等级：炼气期\";\r\n    //     else if (stageNum <= 10) des += \"通关奖励：二阶物品\\n建议等级：筑基期\";\r\n    //     else if (stageNum <= 20) des += \"通关奖励：三阶物品\\n建议等级：结丹期\";\r\n    //     else if (stageNum <= 40) des += \"通关奖励：四阶物品\\n建议等级：元婴期\";\r\n    //     else des += \"通关奖励：五阶物品\\n建议等级：化神期\";\r\n    //     des = des + \"\\n关卡描述：\" + this.stageDesJson.json[\"stage\" + stageNum];;\r\n    //     return des;\r\n    // }\r\n    onBtnCloseDetail() {\r\n        this.stageDetail.active = false;\r\n    }\r\n    onBtnCheckpoint(e) {\r\n        let prefab = e.target.parent;\r\n        console.log(\"onBtnCheckpoint\", prefab.stageNum);\r\n        this.onBtnEnter(e,);\r\n    }\r\n    //循环使用预制件\r\n    update(dt) {\r\n        this.updatePrefabs();\r\n    }\r\n    updatePrefabs() {\r\n        let wp = this.prefabPar.parent.getWorldPosition();\r\n        for (let i = 0; i < this._prefabArr.length; i++) {\r\n            let prefab = this._prefabArr[i];\r\n            let pwp = prefab.getWorldPosition();\r\n            if (pwp.y - wp.y > this._initPos.changePos && prefab.stageNum + this._initPos.changeRank <= this._stageTotal) {//下移\r\n                let offset = this._initPos.changeRank * this._initPos.gap;\r\n                prefab.setWorldPosition(pwp.x, pwp.y + offset, pwp.z);\r\n                prefab.stageNum += this._initPos.changeRank;\r\n                prefab.getChildByName(\"Label\").getComponent(Label).string = \"第\" + prefab.stageNum + \"关\";\r\n            } else if (pwp.y - wp.y < -this._initPos.changePos && prefab.stageNum - this._initPos.changeRank >= 1) {//上移\r\n                let offset = this._initPos.changeRank * this._initPos.gap;\r\n                prefab.setWorldPosition(pwp.x, pwp.y - offset, pwp.z);\r\n                prefab.stageNum -= this._initPos.changeRank;\r\n                prefab.getChildByName(\"Label\").getComponent(Label).string = \"第\" + prefab.stageNum + \"关\";\r\n            }\r\n            //刷新材质\r\n            if (prefab.stageNum > ggd.stageProgress) {\r\n                prefab.getChildByName(\"btnBg\").getChildByName(\"stageLock\").active = true;\r\n                prefab.getComponent(Sprite).material = this.grayMaterial;\r\n            } else {\r\n                prefab.getChildByName(\"btnBg\").getChildByName(\"stageLock\").active = false;\r\n                prefab.getComponent(Sprite).material = this.defaultMaterial;\r\n            }\r\n        }\r\n    }\r\n\r\n    //点击进入关卡\r\n    onBtnEnter(e) {\r\n        let p = e.target.parent.stageNum;\r\n        if (this._isLoading) return;\r\n        this._isLoading = true;\r\n        console.log(\"进入关卡\" + p);\r\n        if (p <= ggd.totalStage) {\r\n            this.openLoading();\r\n            ggd.curStage = parseInt(p);\r\n            // director.loadScene(\"game\");\r\n            console.log(\"切换音效\");\r\n\r\n            director.loadScene(\"game\", () => {\r\n                // em.dispatch(\"switchMainBgm\",\"/audio/music/风声\");\r\n                em.dispatch(\"switchMainBgm\", \"/audio/music/不谓侠\");\r\n            });\r\n        }\r\n        else {\r\n            console.warn(\"current stage is  undefined\");\r\n            this._isLoading = false;\r\n        }\r\n    }\r\n    openLoading() {\r\n        find(\"Canvas/loading\").active = true;\r\n    }\r\n    // 解锁下一关\r\n    onBtnChangeStage() {\r\n        ggd.stageProgress++;\r\n        em.dispatch(\"savingGlobalDataToTempData\");\r\n    }\r\n}\r\n\r\n"]}