{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/ZA/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/hero/weapon/Darts.ts"],"names":["find","_decorator","em","tagData","plm","Weapon","ccclass","Darts","_isCanSplit","_isCanSplitTimes","init","data","lv","flyDir","isCanSplit","initWeaponInfo","weaponName","name","initBoxCollider","colliderMonster","other","isStopRun","updateMonsterBlood","_canAttackTimes","recoveryToPool","changeFlyDir","colliderBoss","updateBossBlood","radian","Math","sin","random","_flyDir","x","y","dir1","getRotationDir","dir2","createSplitDarts","dir","x2","cos","y2","dispatch","darts","getFromPool","layer","parent","wp","node","getWorldPosition","setWorldPosition","getComponent","maxLevel"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUgBA,MAAAA,I,OAAAA,I;AAAYC,MAAAA,U,OAAAA,U;;AACnBC,MAAAA,E,iBAAAA,E;;AACKC,MAAAA,O,iBAAAA,O;;AACLC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,M,iBAAAA,M;;;;;;AAdT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;OAMM;AAAEC,QAAAA;AAAF,O,GAAcL,U;;uBAGPM,K,WADZD,OAAO,CAAC,OAAD,C,gBAAR,MACaC,KADb;AAAA;AAAA,4BACkC;AAAA;AAAA;AAAA,eAE9BC,WAF8B,GAEhB,KAFgB;AAEV;AAFU,eAG9BC,gBAH8B,GAGX,CAHW;AAAA;;AAGT;AAErBC,QAAAA,IAAI,CAACC,IAAD,EAAOC,EAAP,EAAWC,MAAX,EAA6CC,UAA7C,EAA0E;AAAA,cAA7BA,UAA6B;AAA7BA,YAAAA,UAA6B,GAAP,KAAO;AAAA;;AAC1E,eAAKC,cAAL,CAAoBH,EAApB,EAAwBD,IAAxB,EAA8BE,MAA9B;AACA,cAAIG,UAAkB,GAAGL,IAAI,CAACM,IAA9B;AACA,eAAKC,eAAL,CAAqB;AAAA;AAAA,kCAAQF,UAAR,CAArB;AACA,eAAKR,WAAL,GAAmBM,UAAnB,CAJ0E,CAK1E;AACH;;AACDK,QAAAA,eAAe,CAACC,KAAD,EAAQ;AACnB,cAAI,KAAKC,SAAL,CAAeD,KAAf,CAAJ,EAA2B;AAC3B,eAAKE,kBAAL,CAAwBF,KAAxB;AACA,eAAKG,eAAL;AACA,cAAI,KAAKA,eAAL,IAAwB,CAA5B,EAA+B,KAAKC,cAAL,GAA/B,KACK,KAAKC,YAAL;AACR;;AACDC,QAAAA,YAAY,CAACN,KAAD,EAAQ;AAChB,cAAI,KAAKC,SAAL,CAAeD,KAAf,CAAJ,EAA2B;AAC3B,eAAKO,eAAL,CAAqBP,KAArB;AACA,cAAI,KAAKG,eAAL,IAAwB,CAA5B,EAA+B,KAAKC,cAAL,GAA/B,KACK,KAAKC,YAAL;AACR;;AACDA,QAAAA,YAAY,GAAG;AACX,cAAIG,MAAM,GAAGC,IAAI,CAACC,GAAL,CAASD,IAAI,CAACE,MAAL,KAAgB,EAAzB,CAAb,CADW,CAEX;;AACA,eAAKC,OAAL,CAAaC,CAAb,GAAiB,CAAC,KAAKD,OAAL,CAAaC,CAA/B;AACA,eAAKD,OAAL,CAAaE,CAAb,GAAiB,CAAC,KAAKF,OAAL,CAAaE,CAA/B;AACA,cAAIC,IAAI,GAAG,KAAKC,cAAL,CAAoB,KAAKJ,OAAzB,EAAkCJ,MAAlC,CAAX;AACA,cAAIS,IAAI,GAAG,KAAKD,cAAL,CAAoB,KAAKJ,OAAzB,EAAkC,CAACJ,MAAnC,CAAX;AACA,eAAKI,OAAL,GAAeG,IAAf;;AACA,cAAI,KAAK3B,WAAT,EAAsB;AAClB,iBAAK8B,gBAAL,CAAsBD,IAAtB;AACA,iBAAK7B,WAAL,GAAmB,KAAnB,CAFkB,CAEO;AAC5B;;AAAA;AACJ,SArC6B,CAsC9B;;;AACA4B,QAAAA,cAAc,CAACG,GAAD,EAAMX,MAAN,EAAc;AACxB;AACA,cAAIK,CAAC,GAAGM,GAAG,CAACN,CAAZ;AACA,cAAIC,CAAC,GAAGK,GAAG,CAACL,CAAZ;AACA,cAAIM,EAAE,GAAGP,CAAC,GAAGJ,IAAI,CAACY,GAAL,CAASb,MAAT,CAAJ,GAAuBM,CAAC,GAAGL,IAAI,CAACC,GAAL,CAASF,MAAT,CAApC;AACA,cAAIc,EAAE,GAAGT,CAAC,GAAGJ,IAAI,CAACC,GAAL,CAASF,MAAT,CAAJ,GAAuBM,CAAC,GAAGL,IAAI,CAACY,GAAL,CAASb,MAAT,CAApC;AACA,iBAAO;AAAEK,YAAAA,CAAC,EAAEO,EAAL;AAASN,YAAAA,CAAC,EAAEQ;AAAZ,WAAP;AACH,SA9C6B,CA+C9B;;;AACAJ,QAAAA,gBAAgB,CAACC,GAAD,EAAM;AAClB,cAAI5B,IAAI,GAAG;AAAA;AAAA,wBAAGgC,QAAH,CAAY,yBAAZ,EAAuC,OAAvC,CAAX;AACA,cAAIC,KAAK,GAAG;AAAA;AAAA,0BAAIC,WAAJ,CAAgB,OAAhB,CAAZ;AACA,cAAIC,KAAK,GAAG9C,IAAI,CAAC,oBAAD,CAAhB;AACA4C,UAAAA,KAAK,CAACG,MAAN,GAAeD,KAAf;AACA,cAAIE,EAAE,GAAG,KAAKC,IAAL,CAAUC,gBAAV,EAAT;AACAN,UAAAA,KAAK,CAACO,gBAAN,CAAuBH,EAAvB;AACAJ,UAAAA,KAAK,CAACQ,YAAN,CAAmB,OAAnB,EAA4B1C,IAA5B,CAAiCC,IAAjC,EAAuCA,IAAI,CAAC0C,QAA5C,EAAsDd,GAAtD;AACH;;AAxD6B,O","sourcesContent":["/*\r\n * @Author: li_jiang_wei 739671694@qq.com\r\n * @Date: 2022-08-22 22:03:51\r\n * @LastEditors: li_jiang_wei 739671694@qq.com\r\n * @LastEditTime: 2022-11-27 16:28:21\r\n * @FilePath: \\to-be-immortal\\assets\\script\\hero\\weapon\\Darts.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { Color, find, Vec2, _decorator } from 'cc';\r\nimport { em } from '../../global/EventManager';\r\nimport { ggd, tagData } from '../../global/globalData';\r\nimport { plm } from '../../global/PoolManager';\r\nimport { Weapon } from './Weapon';\r\nconst { ccclass } = _decorator;\r\n\r\n@ccclass('Darts')\r\nexport class Darts extends Weapon {\r\n\r\n    _isCanSplit = false;//是否可分裂\r\n    _isCanSplitTimes = 0;//可分裂次数\r\n\r\n    init(data, lv, flyDir: { x: number, y: number }, isCanSplit: boolean = false) {\r\n        this.initWeaponInfo(lv, data, flyDir);\r\n        let weaponName: string = data.name;\r\n        this.initBoxCollider(tagData[weaponName]);\r\n        this._isCanSplit = isCanSplit;\r\n        //em.dispatch(\"playOneShot\",\"battle/bullet\");\r\n    }\r\n    colliderMonster(other) {\r\n        if (this.isStopRun(other)) return;\r\n        this.updateMonsterBlood(other);\r\n        this._canAttackTimes--;\r\n        if (this._canAttackTimes <= 0) this.recoveryToPool();\r\n        else this.changeFlyDir();\r\n    }\r\n    colliderBoss(other) {\r\n        if (this.isStopRun(other)) return;\r\n        this.updateBossBlood(other);\r\n        if (this._canAttackTimes <= 0) this.recoveryToPool();\r\n        else this.changeFlyDir();\r\n    }\r\n    changeFlyDir() {\r\n        let radian = Math.sin(Math.random() * 30);\r\n        //反向向量\r\n        this._flyDir.x = -this._flyDir.x;\r\n        this._flyDir.y = -this._flyDir.y;\r\n        let dir1 = this.getRotationDir(this._flyDir, radian);\r\n        let dir2 = this.getRotationDir(this._flyDir, -radian);\r\n        this._flyDir = dir1;\r\n        if (this._isCanSplit) {\r\n            this.createSplitDarts(dir2);\r\n            this._isCanSplit = false;//只可分裂一次\r\n        };\r\n    }\r\n    // 获取旋转后的方向\r\n    getRotationDir(dir, radian) {\r\n        //向量旋转指定弧度的角度\r\n        let x = dir.x;\r\n        let y = dir.y;\r\n        let x2 = x * Math.cos(radian) - y * Math.sin(radian);\r\n        let y2 = x * Math.sin(radian) + y * Math.cos(radian);\r\n        return { x: x2, y: y2 };\r\n    }\r\n    // 创建分裂飞镖\r\n    createSplitDarts(dir) {\r\n        let data = em.dispatch(\"getWeaponDataByIdOrName\", \"darts\");\r\n        let darts = plm.getFromPool(\"darts\");\r\n        let layer = find(\"Canvas/bulletLayer\");\r\n        darts.parent = layer;\r\n        let wp = this.node.getWorldPosition();\r\n        darts.setWorldPosition(wp);\r\n        darts.getComponent(\"Darts\").init(data, data.maxLevel, dir);\r\n    }\r\n}\r\n\r\n"]}