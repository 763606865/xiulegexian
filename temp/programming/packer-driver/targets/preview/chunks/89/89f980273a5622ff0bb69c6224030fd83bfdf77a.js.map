{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/mainMenu/PrizeHallLayer.ts"],"names":["_decorator","Component","find","Sprite","Label","NodePool","em","gUrl","hr","plm","ccclass","property","PrizeHallLayer","_curCdkeySting","_itemPrefab","_itemContent","onLoad","node","pool","addPoolToPools","onDisable","clearContent","inputCdkey","box","string","sendPrizeRequest","url","list","getPrize","get","cdk","response","console","log","successful","dispatch","distributePrizes","data","prize","i","total","prizeData","item","getFromPool","parent","sprite","getChildByName","getComponent","loadUrl","assets","spriteFrame","name","active","length","content","children","child","removeFromParent","putToPool"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-10-27 14:48:15\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-11-23 16:37:04\r\n * @FilePath: \\to-be-immortal\\assets\\script\\mainMenu\\PrizeHallLayer.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, find, instantiate, Sprite, Label, NodePool } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nimport { gUrl } from '../global/GameUrl';\r\nimport { hr } from '../global/HttpRequest';\r\nimport { plm } from '../global/PoolManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PrizeHallLayer')\r\nexport class PrizeHallLayer extends Component {\r\n\r\n    _curCdkeySting: string;\r\n    _itemPrefab: Node;\r\n    _itemContent: Node;\r\n\r\n    onLoad() {\r\n        this._itemPrefab = find(\"item\", this.node);\r\n        this._itemContent = find(\"ScrollView/view/content\", this.node);\r\n        let pool = new NodePool();\r\n        plm.addPoolToPools(\"PrizeHallItem\", pool, this._itemPrefab);\r\n    }\r\n    onDisable() {\r\n        this.clearContent();\r\n    }\r\n\r\n    inputCdkey(box) {\r\n        this._curCdkeySting = box.string;\r\n        // console.log(\"this._curCdkeySting\", this._curCdkeySting);\r\n    }\r\n    //发送奖励请求\r\n    sendPrizeRequest() {\r\n        let url = gUrl.list.getPrize;\r\n        hr.get(url, { cdk: this._curCdkeySting }, (response) => {\r\n            console.log(\"response\", response);\r\n            if (response.successful) {\r\n                console.log(\"添加领取奖励效果 还没写\");\r\n                em.dispatch(\"tipsViewShow\", \"领取奖励成功\");\r\n                this.distributePrizes(response.data);\r\n            } else {\r\n                em.dispatch(\"tipsViewShow\", \"cdk错误或已失效，领取失败。\");\r\n            }\r\n        });\r\n    }\r\n\r\n    //分发奖励\r\n    distributePrizes(data) {\r\n        this.clearContent();\r\n        console.log(\"get prizes\", data);\r\n        for (let i = 0; i < data.prize.length; i++) {\r\n            let prize = data.prize[i];\r\n            let total = data.total[i];\r\n            let prizeData = em.dispatch(\"getItemDataByIdOrName\", prize);\r\n            em.dispatch(\"addItemToSS\", prize, total);\r\n            let item = plm.getFromPool(\"PrizeHallItem\");\r\n            item.parent = this._itemContent;\r\n            let sprite = item.getChildByName(\"Sprite\").getComponent(Sprite);\r\n            let loadUrl = \"images/items/\" + prizeData.loadUrl + \"/spriteFrame\";\r\n            em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => sprite.spriteFrame = assets);\r\n            item.getChildByName(\"Label\").getComponent(Label).string = prizeData.name + \"\\n\" + \"X\" + total;\r\n            item.active = true;\r\n            item.parent = this._itemContent;\r\n        }\r\n    }\r\n    // 清除content\r\n    clearContent() {\r\n        console.log(\"清除content\");\r\n        let content = find(\"ScrollView/view/content\", this.node);\r\n        while (content.children.length) {\r\n            let child = this._itemContent.children[0];\r\n            child.removeFromParent();\r\n            plm.putToPool(\"PrizeHallItem\", child);\r\n        };\r\n    }\r\n\r\n}\r\n\r\n"]}