{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/preLoad/PreLoad.ts"],"names":["_decorator","Component","director","Sprite","Label","find","sys","EditBox","em","gUrl","ggd","hr","ccclass","property","PreLoad","_curAccountString","_curPasswordString","onLoad","active","preloadScene","versionCode","string","onDestroy","eventIsDefined","dispatch","start","updateLoadingProgress","fillRange","fillSprite","progressLabel","toFixed","enterMainMenuScene","loadScene","showLoginLayer","data","localStorage","getItem","console","log","JSON","parse","getComponent","account","password","inputAccount","box","inputPassword","onBtnLogin","url","list","login","cb","loginComplete","bind","eb","loginError","tb","loginTimeout","post","res","code","userInfo","isVisitor","token","accountMetadata","setItem","stringify","message","onBtnRegister","register","registerComplete","registerTimeout","registerError","onBtnAsVisitor"],"mappings":"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","sourcesContent":["import { _decorator, Component, director, Sprite, Label, Game, game, find, sys, Settings, profiler, EditBox } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nimport { gUrl } from '../global/GameUrl';\r\nimport { ggd } from '../global/globalData';\r\nimport { hr } from '../global/HttpRequest';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PreLoad')\r\nexport class PreLoad extends Component {\r\n    @property(Sprite)\r\n    fillSprite;\r\n    @property(Label)\r\n    progressLabel;\r\n    @property(Label)\r\n    versionCode;\r\n\r\n    _curAccountString: string;\r\n    _curPasswordString: string;\r\n\r\n    onLoad() {\r\n        // console.log(\"sys.os\", sys.os);\r\n        // console.log(\"sys.osVersion\", sys.osVersion);\r\n        find(\"Canvas/gameName\").active = true;\r\n        find(\"Canvas/loadingProgressBg\").active = true;\r\n        director.preloadScene(\"mainMenu\");\r\n        // this.enterMainMenuScene();\r\n        this.versionCode.string = ggd.versionCode;\r\n    }\r\n    onDestroy() {\r\n        if (em.eventIsDefined(\"hideBanner\")) em.dispatch(\"hideBanner\");\r\n    }\r\n    start() {\r\n        // profiler.hideStats();//关闭fps\r\n    }\r\n    //刷新加载进度\r\n    updateLoadingProgress(fillRange) {\r\n        if (fillRange <= this.fillSprite.fillRange) return;\r\n        this.fillSprite.fillRange = fillRange;\r\n        this.progressLabel.string = (fillRange * 100).toFixed(2) + \"%\";\r\n        // this.progressLabel.string = (fillRange * 100)|0;\r\n    }\r\n    //进入主界面场景\r\n    enterMainMenuScene() {\r\n        director.loadScene(\"mainMenu\");\r\n    }\r\n    showLoginLayer() {\r\n        // let platform = \"wx\";\r\n        // if (platform==\"wx\") {\r\n        //     this.onBtnAsVisitor();\r\n        //     return;\r\n        // }\r\n        find(\"Canvas/gameName\").active = false;\r\n        find(\"Canvas/loadingProgressBg\").active = false;\r\n        find(\"Canvas/loginLayer\").active = true;\r\n        //通过本地缓存信息显示登录信息\r\n        let data: any = sys.localStorage.getItem(\"loginInfo\");\r\n        if (data) {\r\n            console.log(\"账号密码输入框显示data 还没写\");\r\n            console.log(\"data\", data);\r\n            data = JSON.parse(data);\r\n            find(\"Canvas/loginLayer/inputAccount\").getComponent(EditBox).string = data.account;\r\n            find(\"Canvas/loginLayer/inputPassword\").getComponent(EditBox).string = data.password;\r\n            this._curAccountString = data.account;\r\n            this._curPasswordString = data.password;\r\n        }\r\n    }\r\n    inputAccount(box) {\r\n        this._curAccountString = box.string;\r\n    }\r\n    inputPassword(box) {\r\n        this._curPasswordString = box.string;\r\n    }\r\n    onBtnLogin() {\r\n        let url = gUrl.list.login;\r\n        let data = {\r\n            \"loginIdentity\": this._curAccountString,\r\n            \"credential\": this._curPasswordString,\r\n        }\r\n        let cb = this.loginComplete.bind(this);\r\n        let eb = this.loginError.bind(this);\r\n        let tb = this.loginTimeout.bind(this);\r\n        hr.post(url, data, cb, eb, tb);\r\n        find(\"Canvas/loading/Label\").getComponent(Label).string = \"登录中...\";\r\n        find(\"Canvas/loading\").active = true;\r\n\r\n    }\r\n    loginComplete(res) {\r\n        find(\"Canvas/loading\").active = false; //出现报错\r\n        console.log(\"loginComplete\", res);\r\n        if (res.code == 200) {\r\n            ggd.userInfo.isVisitor = false;\r\n            ggd.userInfo.token = res.data.token;\r\n            ggd.userInfo.accountMetadata = res.data.accountMetadata;\r\n            // ggd.userInfo.token = res.data.data.token;\r\n            // ggd.userInfo.accountMetadata = res.data.data.accountMetadata;\r\n            //存储当前账号密码\r\n            let data = {\r\n                \"account\": this._curAccountString,\r\n                \"password\": this._curPasswordString\r\n            };\r\n            sys.localStorage.setItem(\"loginInfo\", JSON.stringify(data));\r\n            this.enterMainMenuScene();\r\n        } else {\r\n            em.dispatch(\"tipsViewShow\", res.message);\r\n        }\r\n    }\r\n    loginError() {\r\n        find(\"Canvas/loading\").active = false;\r\n        em.dispatch(\"tipsViewShow\", \"网络异常，请重试或通过游客登录。\");\r\n    }\r\n    loginTimeout() {\r\n        find(\"Canvas/loading\").active = false;\r\n        em.dispatch(\"tipsViewShow\", \"网络延迟，请重试或通过游客登录。\");\r\n    }\r\n    onBtnRegister() {\r\n        let url = gUrl.list.register;\r\n        let data = {\r\n            \"nickname\": this._curAccountString,\r\n            \"password\": this._curPasswordString,\r\n        }\r\n        let cb = this.registerComplete.bind(this);\r\n        let eb = this.registerComplete.bind(this);\r\n        let tb = this.registerTimeout.bind(this);\r\n        hr.post(url, data, cb, eb, tb);\r\n        find(\"Canvas/loading/Label\").getComponent(Label).string = \"注册中...\";\r\n        find(\"Canvas/loading\").active = true;\r\n    }\r\n    registerComplete(res) {\r\n        console.log(\"registerComplete\", res);\r\n        if (res.code == 200) {\r\n            find(\"Canvas/loading\").active = false;\r\n            em.dispatch(\"tipsViewShow\", \"注册成功，请登录\");\r\n        } else {\r\n            find(\"Canvas/loading\").active = false;\r\n            em.dispatch(\"tipsViewShow\", res.message);\r\n        }\r\n    }\r\n    registerError() {\r\n        find(\"Canvas/loading\").active = false;\r\n        em.dispatch(\"tipsViewShow\", \"网络异常，请重试或通过游客登录。\");\r\n    }\r\n    registerTimeout() {\r\n        find(\"Canvas/loading\").active = false;\r\n        em.dispatch(\"tipsViewShow\", \"网络延迟，请重试或通过游客登录。\");\r\n    }\r\n    onBtnAsVisitor() {\r\n        ggd.userInfo.isVisitor = true;\r\n        this.enterMainMenuScene();\r\n    }\r\n}\r\n\r\n"]}