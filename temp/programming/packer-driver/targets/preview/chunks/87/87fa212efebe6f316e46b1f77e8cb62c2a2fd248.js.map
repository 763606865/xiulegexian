{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/TSGFDemo/Demo/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/hero/weapon/JustOneSwordDivideWorld.ts"],"names":["_decorator","Vec2","em","tagData","Weapon","ccclass","property","JustOneSwordDivideWorld","init","initSkillData","playThisWeaponAudio","total","i","scheduleOnce","dispatch","data","_damage","baseDamage","_damageTimes","damageTimes","_duration","Infinity","_moveSpeed","_canAttackTimes","_backDis","_attackInterval","_weaponName","name2","_flyDir","clearCacheData","initBoxCollider","sword","changeBulletRotationByFlyDir","colliderMonster","other","isStopRun","isHasAttacked","node","uuid","updateMonsterBlood","_hasAttackedEnemies","push","recoveryToPool","x","y","angle","bevelLen","Math","sqrt","sin","abs","asin","destroy"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei 739671694@qq.com\r\n * @Date: 2022-09-20 01:51:52\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-11-30 11:18:08\r\n * @FilePath: \\to-be-immortal\\assets\\script\\hero\\weapon\\JustOneSwordDivideWorld.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, Vec2 } from 'cc';\r\nimport { em } from '../../global/EventManager';\r\nimport { attackInterval, tagData } from '../../global/globalData';\r\nimport { Weapon } from './Weapon';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('JustOneSwordDivideWorld')\r\nexport class JustOneSwordDivideWorld extends Weapon {\r\n    init() {\r\n        this.initSkillData();\r\n        this.playThisWeaponAudio(3);\r\n    }\r\n    playThisWeaponAudio(total) {\r\n        for (let i = 0; i < total; i++) {\r\n            this.scheduleOnce(() => {\r\n                em.dispatch(\"playOneShot\", \"battle/spell\");\r\n            }, i);\r\n        }\r\n\r\n    }\r\n    initSkillData() {\r\n        let data = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"一剑隔世\");\r\n        this._damage = data.baseDamage;\r\n        this._damageTimes = data.damageTimes;\r\n        this._duration = Infinity;\r\n        this._moveSpeed = 0;\r\n        this._canAttackTimes = Infinity;\r\n        this._backDis = 0;\r\n        this._attackInterval = 0.5;\r\n        this._weaponName = data.name2;\r\n        this._flyDir = new Vec2(-.25, -1);\r\n        this.clearCacheData();\r\n        this.initBoxCollider(tagData.sword);\r\n        this.changeBulletRotationByFlyDir();\r\n    }\r\n    colliderMonster(other) {\r\n        if (this.isStopRun(other)) return;\r\n        if (this.isHasAttacked(other.node.uuid)) return;//已经被剑攻击过的对象 忽略后续攻击\r\n        this.updateMonsterBlood(other);\r\n        this._hasAttackedEnemies.push(other.node.uuid);\r\n        this._canAttackTimes--;\r\n        if (this._canAttackTimes <= 0) this.recoveryToPool();\r\n    }\r\n    // 通过飞行方向修改子弹旋转方向 没有方向的子弹暂不处理\r\n    changeBulletRotationByFlyDir() {\r\n        if (this._flyDir.x == 0 && this._flyDir.y == 0) return;//无方向 暂不处理\r\n        if (this._flyDir.x == 0) {//没有x方向\r\n            if (this._flyDir.y > 0) this.node.angle = -90;\r\n            else this.node.angle = 90;\r\n            return;\r\n        };\r\n        if (this._flyDir.y == 0) {//没有y方向\r\n            if (this._flyDir.x > 0) this.node.angle = 180;\r\n            else this.node.angle = 0;\r\n            return;\r\n        };\r\n        let bevelLen = Math.sqrt(this._flyDir.x * this._flyDir.x + this._flyDir.y * this._flyDir.y);\r\n        // let sin = Math.sin(this._flyDir.x / bevelLen);\r\n        let sin = Math.sin(Math.abs(this._flyDir.y) / bevelLen);\r\n        let asin = Math.asin(sin);\r\n        let angle = asin * 90;\r\n        // console.log(\"angle\", angle);\r\n        if (this._flyDir.y > 0) {//向上飞行\r\n            if (this._flyDir.x > 0) this.node.angle = 180 + angle;\r\n            else this.node.angle = 360 - angle;\r\n        } else {\r\n            if (this._flyDir.x > 0) this.node.angle = 180 - angle;\r\n            else this.node.angle = angle\r\n        }\r\n        // this.node.angle = 70;\r\n    }\r\n    // 回收进对象池\r\n    recoveryToPool() {\r\n        this.node.destroy();\r\n    }\r\n\r\n}\r\n\r\n"]}