{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/hero/weapon/SkillManager.ts"],"names":["_decorator","Component","Sprite","Prefab","instantiate","Label","find","em","ggd","glf","ccclass","property","SkillManager","_openSecretList","_bloodMakeMeStrongTimes","_drinkBloodValue","_godWindCloudBodyTimes","_thunderGodAngryTimes","_thunderGodDignifiedTimes","_percentageDamage","_avoidAttackingTotalTime","_beAttackedSSTimesList","_countdownList","_skillDebuffEffect","onDestroy","remove","onLoad","add","usingSkillManagerFun","bind","getSkillManagerProperty","initSkill","start","openAllSecretSkill","startRecodeAvoidTime","schedule","stopAll","updateBeAttackedListCountdown","key","Object","prototype","hasOwnProperty","call","element","countdown","times","list","dispatch","usingBookList","type","skillName","skill","skillPrefab","parent","node","sprite","getComponent","loadUrl","assets","spriteFrame","createButton","onBtnSkill","e","p","target","getChildByName","fillRange","totalTime","cd","label","skillData","name","startCoolDowntime","interval","curTime","string","setInterval","toFixed","clearInterval","param","changeMoveSpeed","moveSpeedTimes","duration","swordRain","justOneSwordDivideWorld","collectGas","criticalHitRate","t","fun","unschedule","thousandsSwordToTomb","trackDisappear","lionRoar","iceCone","iceShield","iceAge","moveLikeMeteor","samadhiTrueFire","url","prefab","init","sunHeart","sunHeartCountdownRun","damageTimes","fireBloom","hellFire","moveLikeShadow","fingerLikeWind","console","log","likeSpringBreeze","baseDamage","dangerWindToNear","doomsdayStorm","flyingThunderGod","thunderGodPower","paralysis","probability","thundercloud","layer","wp","setWorldPosition","thunderRunning","thunderFissionBead","finishBookList","forEach","name2","likeWindMove","push","bloodMakeMeStrong","add_bloodMakeMeStrongTimes","indexOf","drinkBlood","iceHeart","moveLikeFire","flowFire","godWindCloudBody","Math","ceil","driveWind","thunderGodAngry","maxTimes","value","thunderGodDignified","getMoveSpeedFromSecretSkill","d1","likeWindMoveTimes","getDamageValueFromSecretSkill","damage","getPercentageDamageFromSecretSkill","total","getRecoveryBloodFromSecretSkill","getPercentageReduceDamageFromSecretSkill","warn","getBackDisFromSecretSkill","backDis","dwd","getCHRFromSecretSkill","updateSecretSkillTimesAfterAttacked","getSSDes","getSkillDebuffEffectList","random"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-09-19 10:05:41\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @FilePath: \\to-be-immortal\\assets\\script\\hero\\weapon\\SkillManager.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, Sprite, Prefab, instantiate, Label, find } from 'cc';\r\nimport { em } from '../../global/EventManager';\r\nimport { ggd } from '../../global/globalData';\r\nimport { glf } from '../../global/globalFun';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('SkillManager')\r\nexport class SkillManager extends Component {\r\n\r\n    @property(Prefab)\r\n    skillPrefab;\r\n\r\n    _openSecretList = [];//存储激活的秘法\r\n    _bloodMakeMeStrongTimes: number = 0;//血煞功叠加层数\r\n    _drinkBloodValue: number = 0;//嗜血诀回血量\r\n    _godWindCloudBodyTimes: number = 0;//仙风云体叠加层数\r\n    _thunderGodAngryTimes: number = 0;//雷神之怒叠加层数\r\n    _thunderGodDignifiedTimes: number = 0;//雷神之威叠加层数\r\n\r\n    _percentageDamage: number = 0;//百分比伤害提升 叠加所有静态秘法\r\n    _avoidAttackingTotalTime: number = 0;//避开攻击总时长（未必攻击的时长）\r\n\r\n    _beAttackedSSTimesList = {};//存储被击中触发的秘法\r\n\r\n    _countdownList = {\r\n        \"sunHeart\": 0,\r\n    };\r\n    //技能控制效果\r\n    _skillDebuffEffect = {\r\n        \"paralysis\": {\r\n            \"probability\": 0,\r\n            \"duration\": 0\r\n        }\r\n    }\r\n\r\n\r\n    onDestroy() {\r\n        em.remove(\"usingSkillManagerFun\");\r\n        em.remove(\"getSkillManagerProperty\");\r\n    }\r\n    onLoad() {\r\n        em.add(\"usingSkillManagerFun\", this.usingSkillManagerFun.bind(this));\r\n        em.add(\"getSkillManagerProperty\", this.getSkillManagerProperty.bind(this));\r\n        this.initSkill();\r\n\r\n\r\n    }\r\n    start() {\r\n        this.openAllSecretSkill();\r\n        this.startRecodeAvoidTime();\r\n        //记录未被击中时长\r\n\r\n    }\r\n    //开始记录未被击中的时长\r\n    startRecodeAvoidTime() {\r\n        this.schedule(() => {\r\n            if (ggd.stopAll) return;\r\n            this._avoidAttackingTotalTime++;\r\n            this.updateBeAttackedListCountdown();\r\n        }, 1);\r\n    }\r\n    //刷新被攻列表的倒计时\r\n    updateBeAttackedListCountdown() {\r\n        for (const key in this._beAttackedSSTimesList) {\r\n            if (Object.prototype.hasOwnProperty.call(this._beAttackedSSTimesList, key)) {\r\n                const element = this._beAttackedSSTimesList[key];\r\n                if (element.countdown > 0) {\r\n                    element.countdown--;\r\n                    if (element.countdown <= 0) element.times = 0;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    initSkill() {\r\n        let list = em.dispatch(\"getTempData\", \"SkillBookLayer\") && em.dispatch(\"getTempData\", \"SkillBookLayer\").usingBookList;\r\n        if (!list) return;\r\n        for (const type in list) {\r\n            if (Object.prototype.hasOwnProperty.call(list, type)) {\r\n                const skillName = list[type];\r\n                if (skillName) {\r\n                    let skill = instantiate(this.skillPrefab);\r\n                    skill.parent = this.node;\r\n                    let sprite = skill.getComponent(Sprite);\r\n                    let loadUrl = \"images/icons/icon_\" + skillName + \"/spriteFrame\";\r\n                    em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => sprite.spriteFrame = assets);\r\n                    glf.createButton(this.node, skill, \"SkillManager\", \"onBtnSkill\", skillName);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // 通用方法\r\n    onBtnSkill(e, p) {\r\n        let sprite = e.target.getChildByName(\"mask\").getComponent(Sprite);\r\n        if (sprite.fillRange > 0) return;\r\n        // this.changeMoveSpeed();\r\n        this[p]();\r\n        sprite.fillRange = 1;\r\n        let totalTime = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", p).cd;\r\n        let label = e.target.getChildByName(\"remainingTime\").getComponent(Label);\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", p);\r\n        em.dispatch(\"createTipsTex\", skillData.name);\r\n        this.startCoolDowntime(sprite, label, totalTime);\r\n    }\r\n    // 开始冷却\r\n    startCoolDowntime(sprite, label, totalTime) {\r\n        let interval = 1 / 60;\r\n        // let interval = 1;\r\n        let curTime = 0;\r\n        label.string = totalTime;\r\n        let cd = setInterval(() => {\r\n            if (ggd.stopAll) return;\r\n            curTime += interval;\r\n            sprite.fillRange = (1 - curTime / totalTime);\r\n            label.string = (totalTime - curTime).toFixed(2);\r\n            // label.string = Math.floor(totalTime - curTime);\r\n            if (curTime >= totalTime) {\r\n                clearInterval(cd);\r\n                sprite.fillRange = 0;\r\n                label.string = \"\";\r\n            };\r\n        }, interval * 1000);\r\n    }\r\n\r\n    usingSkillManagerFun(string, ...param) {\r\n\r\n        if (this[string] && typeof this[string] == \"function\") return this[string](...param);\r\n        else throw string + \" is not fun or undefined\";\r\n    }\r\n    //获取hero control 属性\r\n    getSkillManagerProperty(string: string) {\r\n        if (this.hasOwnProperty(string)) return this[string];\r\n        else throw \"skill manager 中不存在属性：\" + string;\r\n    }\r\n    // ===========================具体实现===========================\r\n    /**\r\n     * @description: 一阶功法\r\n     */\r\n    //凌波微步 --->身法\r\n    changeMoveSpeed() {\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"changeMoveSpeed\");\r\n        // em.dispatch(\"usingHeroControlFun\", \"changeHeroMoveSpeed\", 2, 10);//两倍移速 10s\r\n        em.dispatch(\"usingHeroControlFun\", \"changeHeroMoveSpeed\", skillData.moveSpeedTimes, skillData.duration);//两倍移速 10s\r\n    }\r\n    //剑雨术 --->武技\r\n    swordRain() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillSwordRain\");\r\n    }\r\n    // 一剑隔世 --->绝技\r\n    justOneSwordDivideWorld() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillJustOneSwordDivideWorld\");\r\n    }\r\n    // 凝气术 --->心法\r\n    collectGas() {\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"凝气术\");\r\n        em.dispatch(\"usingHeroControlFun\", \"updateTempCriticalHitRate\", skillData.criticalHitRate);\r\n        em.dispatch(\"usingHeroControlFun\", \"isOpenCollectGas\", true);\r\n        let t = skillData.duration;\r\n        let fun = () => {\r\n            if (ggd.stopAll) return;\r\n            t--;\r\n            if (t <= 0) {\r\n                this.unschedule(fun);\r\n                em.dispatch(\"usingHeroControlFun\", \"updateTempCriticalHitRate\", -skillData.criticalHitRate);\r\n                em.dispatch(\"usingHeroControlFun\", \"isOpenCollectGas\", false);\r\n            }\r\n        }\r\n        this.schedule(fun, 1);\r\n    }\r\n    //万剑归冢 --->神通\r\n    thousandsSwordToTomb() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillThousandsSwordToTomb\");\r\n    }\r\n    /**\r\n     * @description: 二阶功法\r\n     */\r\n    // 迷踪步 --->身法\r\n    trackDisappear() {\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"trackDisappear\");\r\n        em.dispatch(\"usingHeroControlFun\", \"usingSkillTrackDisappear\", skillData.duration);\r\n        em.dispatch(\"usingHeroControlFun\", \"changeHeroMoveSpeed\", skillData.moveSpeedTimes, skillData.duration);//两倍移速 10s\r\n    }\r\n    // 怒狮狂吼 --->武技\r\n    lionRoar() {\r\n        em.dispatch(\"usingHeroControlFun\", \"usingSkillLionRoar\");\r\n    }\r\n    // 冰锥术 --->绝技 向周围发射冰锥，每个冰锥造成500伤害，附加1.5伤害加成，并冻结对方\r\n    iceCone() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillIceCone\");\r\n    }\r\n    // 冰盾术 ---> 心法\r\n    iceShield() {\r\n        em.dispatch(\"usingHeroControlFun\", \"usingSkillIceShield\");\r\n    }\r\n    // 冰河世纪 --->神通\r\n    iceAge() {\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"iceAge\");\r\n        em.dispatch(\"usingMapLayerFun\", \"frozenMap\", skillData.duration, 0.2);\r\n    }\r\n    /**\r\n     * @description: 三阶功法\r\n     */\r\n    //大步流星 --> 身法\r\n    moveLikeMeteor() {\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"moveLikeMeteor\");\r\n        em.dispatch(\"usingHeroControlFun\", \"changeHeroMoveSpeed\", skillData.moveSpeedTimes, skillData.duration);//两倍移速 10s\r\n    }\r\n    // 三昧真火 --> 武技\r\n    samadhiTrueFire() {\r\n        let url = \"/prefabs/hero/weapon/samadhiTrueFire\";\r\n        em.dispatch(\"loadTheDirResources\", url, (assets) => {\r\n            let prefab = instantiate(assets);\r\n            prefab.getComponent(\"SamadhiTrueFire\").init();\r\n        })\r\n    }\r\n    // 烈日心决 ---> 心法\r\n    sunHeart() {\r\n        let url = \"/prefabs/hero/weapon/sunHeart\";\r\n        em.dispatch(\"loadTheDirResources\", url, (assets) => {\r\n            let prefab = instantiate(assets);\r\n            prefab.parent = em.dispatch(\"getHeroControlProperty\", \"node\").getChildByName(\"effect\");\r\n        })\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"sunHeart\");\r\n        em.dispatch(\"usingHeroControlFun\", \"updateTempCriticalHitRate\", skillData.criticalHitRate);\r\n        this._countdownList.sunHeart = skillData.duration;\r\n        this.unschedule(this.sunHeartCountdownRun);\r\n        this.schedule(() => {\r\n            this.sunHeartCountdownRun();\r\n        }, 1);\r\n    }\r\n    // 烈日心决倒计时运行\r\n    sunHeartCountdownRun() {\r\n        if (ggd.stopAll) return;\r\n        this._countdownList.sunHeart--;\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"sunHeart\");\r\n        em.dispatch(\"usingHeroControlFun\", \"updatePercentageBloodProgress\", -skillData.damageTimes);\r\n        if (this._countdownList.sunHeart <= 0) {\r\n            em.dispatch(\"usingHeroControlFun\", \"updateTempCriticalHitRate\", -skillData.criticalHitRate);\r\n            this.unschedule(this.sunHeartCountdownRun);\r\n        }\r\n    }\r\n    // 炎爆术 ---> 绝技\r\n    fireBloom() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillFireBloom\");\r\n    }\r\n    // 地狱火\r\n    hellFire() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillHellFire\");\r\n    }\r\n    // ==================四阶功法===================\r\n    /**\r\n     * @description: 身法 移形换影  留下残影，吸引火力\r\n     */\r\n    moveLikeShadow() {\r\n        em.dispatch(\"usingHeroControlFun\", \"usingSkillMoveLikeShadow\");\r\n    }\r\n    /**\r\n     * @description: 武技 灵风指 持续变化的技能，跟随瞄准方向。持续伤害\r\n     */\r\n    fingerLikeWind() {\r\n        console.log(\"使用灵风指\");\r\n        em.dispatch(\"loadTheDirResources\", \"/prefabs/hero/weapon/fingerLikeWind\", (assets) => {\r\n            let prefab = instantiate(assets);\r\n            prefab.getComponent(\"FingerLikeWind\").init();\r\n        });\r\n    }\r\n    /**\r\n     * @description: 心法 如沐春风 持续回血，提升百分比伤害，提升暴击率\r\n     */\r\n    likeSpringBreeze() {\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"likeSpringBreeze\");\r\n        em.dispatch(\"usingHeroControlFun\", \"updateTempCriticalHitRate\", skillData.criticalHitRate);\r\n        em.dispatch(\"usingHeroControlFun\", \"updateTempPercentageDamage\", skillData.damageTimes);\r\n        em.dispatch(\"usingHeroControlFun\", \"isOpenLikeSpringBreeze\", true);\r\n        let t = skillData.duration;\r\n        let fun = () => {\r\n            if (ggd.stopAll) return;\r\n            em.dispatch(\"usingHeroControlFun\", \"updatePercentageBloodProgress\", skillData.baseDamage);\r\n            t--;\r\n            if (t <= 0) {\r\n                this.unschedule(fun);\r\n                em.dispatch(\"usingHeroControlFun\", \"updateTempCriticalHitRate\", -skillData.criticalHitRate);\r\n                em.dispatch(\"usingHeroControlFun\", \"updateTempPercentageDamage\", -skillData.damageTimes);\r\n                em.dispatch(\"usingHeroControlFun\", \"isOpenLikeSpringBreeze\", false);\r\n            }\r\n        }\r\n        this.schedule(fun, 1);\r\n    }\r\n    /**\r\n     * @description: 绝技  八面危风   向周边发射持续的八道龙卷风 \r\n     */\r\n    dangerWindToNear() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillDangerWindToNear\");\r\n    }\r\n    /**\r\n     * @description: 末日风暴 不断向周边发射大风暴，范围广。伤害高,攻击间隔短\r\n     */\r\n    doomsdayStorm() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillDoomsdayStorm\");\r\n    }\r\n\r\n\r\n    // ==================五阶功法===================\r\n    // 飞雷神\r\n    flyingThunderGod() {\r\n        em.dispatch(\"usingHeroControlFun\", \"usingSkillFlyingThunderGod\");\r\n    }\r\n    // 雷神之力\r\n    thunderGodPower() {\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"thunderGodPower\");\r\n        this._skillDebuffEffect.paralysis.duration = skillData.baseDamage;\r\n        this._skillDebuffEffect.paralysis.probability = skillData.damageTimes;\r\n        em.dispatch(\"usingHeroControlFun\", \"isOpenThunderGodPower\");\r\n    }\r\n    //雷云术\r\n    thundercloud() {\r\n        em.dispatch(\"loadTheDirResources\", \"/prefabs/hero/weapon/thundercloud\", (assets) => {\r\n            let prefab = instantiate(assets);\r\n            let layer = find(\"Canvas/bulletLayer\");\r\n            prefab.parent = layer;\r\n            let wp = em.dispatch(\"getHeroWorldPos\");\r\n            prefab.setWorldPosition(wp);\r\n            prefab.getComponent(\"Thundercloud\").init();\r\n        });\r\n    }\r\n    // 奔雷术\r\n    thunderRunning() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillThunderRunning\");\r\n    }\r\n    /**\r\n     * @description: 雷裂珠  向移动方向发射一枚雷裂珠，雷裂珠在造成和高额伤害的同时并不会消失，而是分裂为两颗新珠子。可持续分裂5次。\r\n     */\r\n    thunderFissionBead() {\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillThunderFissionBead\");\r\n    }\r\n\r\n\r\n    //==================秘法======================\r\n    // 开启所有被动秘法\r\n    openAllSecretSkill() {\r\n        let list = em.dispatch(\"getTempData\", \"SkillBookLayer\") && em.dispatch(\"getTempData\", \"SkillBookLayer\").finishBookList;\r\n        console.log(\"openAllSecretSkill\", list);\r\n        if (list) {\r\n            list.forEach(skillName => {\r\n                let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", skillName);\r\n                if (skillData.type == \"秘法\") {\r\n                    this[skillData.name2]();\r\n                }\r\n            });\r\n        }\r\n    }\r\n    //风行诀\r\n    likeWindMove() {\r\n        this._openSecretList.push(\"likeWindMove\");\r\n    }\r\n    // 血煞功\r\n    bloodMakeMeStrong() {\r\n        this._openSecretList.push(\"bloodMakeMeStrong\");\r\n    }\r\n    //叠加血煞功层数\r\n    add_bloodMakeMeStrongTimes() {\r\n        if (this._openSecretList.indexOf(\"bloodMakeMeStrong\") < 0) return;\r\n        this._bloodMakeMeStrongTimes++;\r\n    }\r\n    // 嗜血诀\r\n    drinkBlood() {\r\n        this._openSecretList.push(\"drinkBlood\");\r\n        this._drinkBloodValue = 20;\r\n    }\r\n    //冰心诀\r\n    iceHeart() {\r\n        this._openSecretList.push(\"iceHeart\");\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"iceHeart\");\r\n        this._percentageDamage += skillData.damageTimes;\r\n    }\r\n    //火行步\r\n    moveLikeFire() {\r\n        this._openSecretList.push(\"moveLikeFire\");\r\n        em.dispatch(\"usingWeaponManagerFun\", \"usingSkillMoveLikeFire\");\r\n    }\r\n    //流火诀\r\n    flowFire() {\r\n        this._openSecretList.push(\"flowFire\");\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"flowFire\");\r\n        this._percentageDamage += skillData.damageTimes;\r\n    }\r\n    //仙风云体\r\n    godWindCloudBody() {\r\n        this._openSecretList.push(\"godWindCloudBody\");\r\n        this.schedule(() => {\r\n            let times = Math.ceil(em.dispatch(\"getCurStageTime\") / 60);\r\n            this._godWindCloudBodyTimes = times;\r\n        }, 1);\r\n    }\r\n    // 御风术 打开即用，外部获取\r\n    driveWind() {\r\n        this._openSecretList.push(\"driveWind\");\r\n    }\r\n    thunderGodAngry() {\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"thunderGodAngry\");\r\n        this._openSecretList.push(\"thunderGodAngry\");\r\n        this._beAttackedSSTimesList[\"thunderGodAngry\"] = {\r\n            duration: skillData.duration,\r\n            countdown: 0,\r\n            maxTimes: skillData.damageTimes,\r\n            times: 0,\r\n            value: skillData.baseDamage\r\n        }\r\n    }\r\n    thunderGodDignified() {\r\n        this._openSecretList.push(\"thunderGodDignified\");\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"thunderGodDignified\");\r\n        this._openSecretList.push(\"thunderGodDignified\");\r\n        this._beAttackedSSTimesList[\"thunderGodDignified\"] = {\r\n            duration: skillData.duration,\r\n            countdown: 0,\r\n            maxTimes: skillData.damageTimes,\r\n            times: 0,\r\n            value: skillData.baseDamage\r\n        }\r\n    }\r\n    //============外部调用==============\r\n    // 获取秘法提供的移速加成\r\n    getMoveSpeedFromSecretSkill() {\r\n        let d1 = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"仙风云体\");\r\n        let skillData = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"likeWindMove\");\r\n        let likeWindMoveTimes = this._avoidAttackingTotalTime > skillData.damageTimes ? skillData.damageTimes : this._avoidAttackingTotalTime;\r\n        if (this._openSecretList.indexOf(\"likeWindMove\") < 0) likeWindMoveTimes = 0;\r\n        if (this._openSecretList.indexOf(\"godWindCloudBody\") < 0) d1.moveSpeedTimes = 0;\r\n        return likeWindMoveTimes + this._godWindCloudBodyTimes * d1.moveSpeedTimes;\r\n    }\r\n    // 获取秘法提供的数值加成（伤害）  \r\n    getDamageValueFromSecretSkill() {\r\n        let damage = this._bloodMakeMeStrongTimes;\r\n        if (this._openSecretList.indexOf(\"iceHeart\") > -1) damage += em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"iceHeart\").baseDamage;\r\n        return damage;\r\n    }\r\n    // 获取秘法提供的百分比加成（伤害）  \r\n    getPercentageDamageFromSecretSkill() {\r\n        let total = this._percentageDamage;\r\n        if (this._beAttackedSSTimesList.hasOwnProperty(\"thunderGodAngry\")) {\r\n            let value = (this._beAttackedSSTimesList[\"thunderGodAngry\"].times) * (this._beAttackedSSTimesList[\"thunderGodAngry\"].value);\r\n            total += value;\r\n        }\r\n        return total;\r\n    }\r\n    //获取秘法提供的血量恢复\r\n    getRecoveryBloodFromSecretSkill() {\r\n        return this._drinkBloodValue;\r\n    }\r\n    //获取秘法提供的百分比减伤效果\r\n    getPercentageReduceDamageFromSecretSkill() {\r\n        let d1 = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"仙风云体\");\r\n        let total = this._godWindCloudBodyTimes * d1.damageTimes;\r\n        if (total > 0.5) console.warn(\"免伤达到50%以上\");\r\n        return total;\r\n    }\r\n    // 获取秘法提供的击退效果\r\n    getBackDisFromSecretSkill() {\r\n        let backDis = 0;\r\n        if (this._openSecretList.indexOf(\"driveWind\") > -1) {\r\n            let dwd = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"御风术\");\r\n            backDis += dwd.baseDamage;\r\n        };\r\n        return backDis;\r\n    }\r\n    //获取秘法提供的暴击率\r\n    getCHRFromSecretSkill() {\r\n        let total = 0;\r\n        if (this._beAttackedSSTimesList.hasOwnProperty(\"thunderGodDignified\")) {\r\n            let value = (this._beAttackedSSTimesList[\"thunderGodDignified\"].times) * (this._beAttackedSSTimesList[\"thunderGodDignified\"].value);\r\n            total += value;\r\n        }\r\n        return total;\r\n    }\r\n    //刷新被击中后触发的秘法的层数\r\n    updateSecretSkillTimesAfterAttacked() {\r\n        this._avoidAttackingTotalTime = 0;\r\n        for (const key in this._beAttackedSSTimesList) {\r\n            if (Object.prototype.hasOwnProperty.call(this._beAttackedSSTimesList, key)) {\r\n                const element = this._beAttackedSSTimesList[key];\r\n                element.countdown = element.duration;\r\n                if (element.times < element.maxTimes) element.times++;\r\n            }\r\n        }\r\n\r\n    }\r\n    /**\r\n     * @description: 获取秘法描述\r\n     */\r\n    getSSDes() {\r\n        // let string = \"================秘法================\\n\";\r\n        let string = \"秘法：\\n\";\r\n        if (this._openSecretList.indexOf(\"likeWindMove\") > -1) {\r\n            string += (\"风行诀层数:\" + this._avoidAttackingTotalTime + \"\\n\");\r\n        };\r\n        if (this._openSecretList.indexOf(\"bloodMakeMeStrong\") > -1) {\r\n            string += (\"血煞功层数:\" + this._bloodMakeMeStrongTimes + \"\\n\");\r\n        };\r\n        if (this._openSecretList.indexOf(\"godWindCloudBody\") > -1) {\r\n            string += (\"仙风云体层数:\" + this._godWindCloudBodyTimes + \"\\n\");\r\n        };\r\n        if (this._openSecretList.indexOf(\"thunderGodAngry\") > -1) {\r\n            string += (\"雷神之怒层数:\" + this._beAttackedSSTimesList[\"thunderGodAngry\"].times + \"\\n\");\r\n        };\r\n        if (this._openSecretList.indexOf(\"thunderGodDignified\") > -1) {\r\n            string += (\"雷神之威层数:\" + this._beAttackedSSTimesList[\"thunderGodDignified\"].times + \"\\n\");\r\n        };\r\n        return string;\r\n    }\r\n    // 判断是否被控制\r\n    getSkillDebuffEffectList() {\r\n        let list = [];\r\n        for (const key in this._skillDebuffEffect) {\r\n            if (Object.prototype.hasOwnProperty.call(this._skillDebuffEffect, key)) {\r\n                const element = this._skillDebuffEffect[key];\r\n                if (element.probability > Math.random()) {\r\n                    list.push({ type: key, duration: element.duration });\r\n                };\r\n            }\r\n        }\r\n        return list;\r\n    }\r\n}\r\n\r\n\r\n"]}