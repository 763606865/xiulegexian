{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/TSGFDemo/Demo/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/hero/weapon/Weapon.ts"],"names":["_decorator","Component","BoxCollider2D","Size","Contact2DType","UITransform","CircleCollider2D","Animation","find","em","ggd","groupIndex","tagData","plm","ccclass","Weapon","_curLevel","_curData","_weaponId","_weaponName","_damage","_damageTimes","_duration","_moveSpeed","_maxLevel","_canAttackTimes","_backDis","_attackInterval","_flyDir","_touchingArr","_hasAttackedEnemies","initWeaponInfo","curLv","weaponData","flyDir","x","y","id","name","maxLevel","initCurLvInfo","clearCacheData","index","damage","damageTimes","length","duration","Infinity","moveSpeed","canAttackTimes","backDis","attackInterval","bonusDuration","dispatch","bonusMS","bonusATs","onDisable","unscheduleAllCallbacks","initBoxCollider","tag","changeSize","collider","node","getComponent","addComponent","UIT","weaponSize","contentSize","size","group","heroWeapon","on","BEGIN_CONTACT","onBeginContact","END_CONTACT","onEndContact","initCircleCollider","changeR","radius","update","dt","weaponMove","weaponDuration","deltaTime","stopAll","dis","moveX","moveY","setPosition","getPosition","recoveryToPool","changeBulletRotationByFlyDir","angle","bevelLen","Math","sqrt","sin","abs","asin","changeDirByAimDir","offsetAngle","dir","PI","changeDirByMoveDir","self","other","wall","colliderWall","monster","push","colliderMonster","scheduleOnce","removeFromTouchArr","boss","colliderBoss","colliderEnemyEnd","console","log","isStopRun","updateMonsterBlood","updateCanAttackTimes","updateBossBlood","indexOf","parent","box","circle","isCollide","rectIsIntersectsRect","worldAABB","isTouching","isHasAttacked","uuid","isCriticalHit","bonusBackDis","updateBlood","script","components","type","putToPool","addToAnimManger","anim","removeAnimFromList","rect1","rect2","intersects","isExceedMaxDistance","interval","fun","flag","recoveryToPoolWhenWeaponIsDistant","unschedule","schedule","getDistanceToHero","targetPos","curPos","getWorldPosition","getTwoPointDistance","pos1","pos2","initEquBoxCollider","initEquDataByExtraProperties","data","qData","effect","setScale","destroyWeapon","sword"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-08-19 11:46:40\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-12-14 11:41:43\r\n * @FilePath: \\to-be-immortal\\assets\\script\\hero\\weapon\\Weapon.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, BoxCollider2D, Size, Contact2DType, Collider2D, Color, UITransform, physics, CircleCollider2D, PolygonCollider2D, game, Animation, Intersection2D, find } from 'cc';\r\nimport { em } from '../../global/EventManager';\r\nimport { attackInterval, ggd, groupIndex, tagData } from '../../global/globalData';\r\nimport { plm } from '../../global/PoolManager';\r\nconst { ccclass } = _decorator;\r\n\r\n@ccclass('Weapon')\r\nexport class Weapon extends Component {\r\n\r\n    //待初始化属性\r\n    _curLevel: number;\r\n    _curData: any;\r\n    _weaponId: number;\r\n    _weaponName: string;\r\n    _damage: number;\r\n    _damageTimes: number = 0;\r\n    _duration: number;\r\n    _moveSpeed: number;\r\n    // _total: number;\r\n    _maxLevel: number;\r\n    _canAttackTimes: number;\r\n    _backDis: number;\r\n    _attackInterval: number;\r\n\r\n    _flyDir: { x: number, y: number };\r\n    //自带属性\r\n    _touchingArr: Collider2D[] = [];//碰撞中的碰撞体\r\n    _hasAttackedEnemies: Collider2D[] = [];//碰撞过的碰撞体\r\n\r\n\r\n    // 初始化武器信息\r\n    initWeaponInfo(curLv, weaponData, flyDir = { x: 1, y: 1 }) {\r\n        // console.log(\"初始化\" + weaponData.name+this.node.uuid);\r\n        this._curLevel = curLv;\r\n        this._curData = weaponData;\r\n        this._weaponId = weaponData.id;\r\n        this._weaponName = weaponData.name;\r\n        this._maxLevel = weaponData.maxLevel;\r\n        this.initCurLvInfo();\r\n        this._flyDir = flyDir;\r\n\r\n        this.clearCacheData();\r\n    }\r\n    // 初始化当前等级信息\r\n    initCurLvInfo() {\r\n        let index = this._curLevel - 1;\r\n        this._damage = this._curData.damage[index];\r\n        this._damageTimes = this._curData.damageTimes.length > 0 ? this._curData.damageTimes[index] : 0;\r\n        this._duration = this._curData.duration.length > 0 ? this._curData.duration[index] : Infinity;\r\n        this._moveSpeed = this._curData.moveSpeed.length > 0 ? this._curData.moveSpeed[index] : 0;\r\n        this._canAttackTimes = this._curData.canAttackTimes.length > 0 ? this._curData.canAttackTimes[index] : Infinity;\r\n        this._backDis = this._curData.backDis.length > 0 ? this._curData.backDis[index] : 0;\r\n        this._attackInterval = this._curData.attackInterval.length > 0 ? this._curData.attackInterval[index] : 0.5;//默认攻击间隔0.5s\r\n\r\n        if (this._duration !== 0) {\r\n            let bonusDuration = em.dispatch(\"getHeroControlProperty\", \"_bonusBulletDuration\");\r\n            this._duration += bonusDuration;\r\n        }\r\n        if (this._moveSpeed !== 0) {\r\n            let bonusMS = em.dispatch(\"getHeroControlProperty\", \"_bonusBulletMoveSpeed\");\r\n            this._moveSpeed += bonusMS;\r\n        }\r\n        if (this._canAttackTimes !== 0) {\r\n            let bonusATs = em.dispatch(\"getHeroControlProperty\", \"_bonusBulletAttackTimes\");\r\n            this._canAttackTimes += bonusATs;\r\n        }\r\n    }\r\n    // 清理缓存数据\r\n    clearCacheData() {\r\n        // console.log(\"清理缓存数据\"+this.node.uuid);\r\n        this._touchingArr.length = 0;\r\n        this._hasAttackedEnemies.length = 0;\r\n    }\r\n    onDisable() {\r\n        this.unscheduleAllCallbacks();\r\n    }\r\n    // 初始化box碰撞器\r\n    initBoxCollider(tag: number, changeSize: { x, y } = { x: 0, y: 0 }) {\r\n        if (!tag) throw \"tag is\" + tag;\r\n        // let collider = this.node.addComponent(BoxCollider2D);\r\n        let collider = this.node.getComponent(BoxCollider2D);\r\n        if (!collider) collider = this.node.addComponent(BoxCollider2D);\r\n        let UIT = this.node.getComponent(UITransform);\r\n        let weaponSize = new Size(UIT.contentSize.x + changeSize.x, UIT.contentSize.y + changeSize.y);\r\n        collider.tag = tag;\r\n        collider.size = weaponSize;\r\n        collider.group = groupIndex.heroWeapon;\r\n        // console.log(\"collider\", collider);\r\n        collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        collider.on(Contact2DType.END_CONTACT, this.onEndContact, this);\r\n    }\r\n\r\n    // 初始化circle碰撞器\r\n    initCircleCollider(tag: number, changeR: number = 0) {\r\n        if (!tag) throw \"tag is\" + tag;\r\n        let collider = this.node.getComponent(CircleCollider2D);\r\n        if (!collider) collider = this.node.addComponent(CircleCollider2D);\r\n        let UIT = this.node.getComponent(UITransform);\r\n        collider.tag = tag;\r\n        collider.radius = UIT.contentSize.x / 2 + changeR;\r\n        collider.group = groupIndex.heroWeapon;\r\n        collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        collider.on(Contact2DType.END_CONTACT, this.onEndContact, this);\r\n    }\r\n    update(dt: number) {\r\n        this.weaponMove(dt);\r\n        this.weaponDuration(dt);\r\n    }\r\n    weaponMove(deltaTime: number) {\r\n        if (ggd.stopAll) return;\r\n        if (!this._flyDir) return;\r\n        if (this._moveSpeed == 0 || this._duration == Infinity) return;\r\n\r\n        let dis = deltaTime * this._moveSpeed;\r\n        // let dis = deltaTime*(this._moveSpeed+bonusMS);\r\n        let moveX = this._flyDir.x * dis;\r\n        let moveY = this._flyDir.y * dis;\r\n        this.node.setPosition(this.node.getPosition().x + moveX, this.node.getPosition().y + moveY, 0);\r\n    }\r\n    weaponDuration(deltaTime: number) {\r\n        if (ggd.stopAll) return;\r\n        this._duration -= deltaTime;\r\n        if (this._duration <= 0) this.recoveryToPool(\"weaponDuration\");\r\n    }\r\n\r\n    // 通过飞行方向修改子弹旋转方向 没有方向的子弹暂不处理\r\n    changeBulletRotationByFlyDir() {\r\n        if (this._flyDir.x == 0 && this._flyDir.y == 0) return;//无方向 暂不处理\r\n        if (this._flyDir.x == 0) {//没有x方向\r\n            if (this._flyDir.y > 0) this.node.angle = -90;\r\n            else this.node.angle = 90;\r\n            return;\r\n        };\r\n        if (this._flyDir.y == 0) {//没有y方向\r\n            if (this._flyDir.x > 0) this.node.angle = 180;\r\n            else this.node.angle = 0;\r\n            return;\r\n        };\r\n        let bevelLen = Math.sqrt(this._flyDir.x * this._flyDir.x + this._flyDir.y * this._flyDir.y);\r\n        // let sin = Math.sin(this._flyDir.x / bevelLen);\r\n        let sin = Math.sin(Math.abs(this._flyDir.y) / bevelLen);\r\n        let asin = Math.asin(sin);\r\n        let angle = asin * 90;\r\n        // console.log(\"angle\", angle);\r\n        if (this._flyDir.y > 0) {//向上飞行\r\n            if (this._flyDir.x > 0) this.node.angle = 180 + angle;\r\n            else this.node.angle = 360 - angle;\r\n        } else {\r\n            if (this._flyDir.x > 0) this.node.angle = 180 - angle;\r\n            else this.node.angle = angle\r\n        }\r\n    }\r\n    changeDirByAimDir(offsetAngle = 0) {\r\n        let dir = em.dispatch(\"getHeroControlProperty\", \"_curAimDir\");\r\n        if (dir.x == 0 && dir.y == 0) return;//无方向 暂不处理\r\n        if (dir.x == 0) {//没有x方向\r\n            if (dir.y > 0) this.node.angle = -90 + offsetAngle;\r\n            else this.node.angle = 90 + offsetAngle;\r\n            return;\r\n        };\r\n        if (dir.y == 0) {//没有y方向\r\n            if (dir.x > 0) this.node.angle = 180 + offsetAngle;\r\n            else this.node.angle = offsetAngle;\r\n            return;\r\n        };\r\n        let bevelLen = Math.sqrt(dir.x * dir.x + dir.y * dir.y);\r\n        // let sin = Math.sin(dir.x / bevelLen);\r\n        let sin = Math.abs(dir.y) / bevelLen;\r\n        let asin = Math.asin(sin);\r\n        let angle = asin / Math.PI * 180;\r\n        if (dir.y > 0) {//向上飞行\r\n            if (dir.x > 0) this.node.angle = 180 + angle + offsetAngle;\r\n            else this.node.angle = 360 - angle + offsetAngle;\r\n        } else {\r\n            if (dir.x > 0) this.node.angle = 180 - angle + offsetAngle;\r\n            else this.node.angle = angle + offsetAngle;\r\n        }\r\n    }\r\n    changeDirByMoveDir(offsetAngle = 0) {\r\n        let dir = em.dispatch(\"getHeroControlProperty\", \"_curDirection\");\r\n        if (dir.x == 0 && dir.y == 0) return;//无方向 暂不处理\r\n        if (dir.x == 0) {//没有x方向\r\n            if (dir.y > 0) this.node.angle = -90 + offsetAngle;\r\n            else this.node.angle = 90 + offsetAngle;\r\n            return;\r\n        };\r\n        if (dir.y == 0) {//没有y方向\r\n            if (dir.x > 0) this.node.angle = 180 + offsetAngle;\r\n            else this.node.angle = offsetAngle;\r\n            return;\r\n        };\r\n        let bevelLen = Math.sqrt(dir.x * dir.x + dir.y * dir.y);\r\n        let sin = Math.abs(dir.y) / bevelLen;\r\n        let asin = Math.asin(sin);\r\n        let angle = asin / Math.PI * 180;\r\n        // console.log(\"angle\", angle);\r\n        if (dir.y > 0) {//向上飞行\r\n            if (dir.x > 0) this.node.angle = 180 + angle + offsetAngle;\r\n            else this.node.angle = 360 - angle + offsetAngle;\r\n        } else {\r\n            if (dir.x > 0) this.node.angle = 180 - angle + offsetAngle;\r\n            else this.node.angle = angle + offsetAngle;\r\n        }\r\n    }\r\n    // ==============================武器碰撞==============================\r\n    onBeginContact(self: Collider2D, other: Collider2D) {\r\n\r\n        switch (other.tag) {\r\n            case tagData.wall:\r\n                this.colliderWall(other);\r\n                break;\r\n            case tagData.monster:\r\n                this._touchingArr.push(other);\r\n                this.colliderMonster(other);\r\n                this.scheduleOnce(() => {\r\n                    this.removeFromTouchArr(other);\r\n                }, this._attackInterval);\r\n\r\n                break;\r\n            case tagData.boss:\r\n                this._touchingArr.push(other);\r\n                // console.log(this.node.uuid+\"添加node uuid is \" + other.node.uuid);\r\n                this.colliderBoss(other);\r\n                this.scheduleOnce(() => {\r\n                    this.removeFromTouchArr(other);\r\n                }, this._attackInterval);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    onEndContact(self: Collider2D, other: Collider2D) {\r\n        switch (other.tag) {\r\n            case tagData.monster:\r\n                this.colliderEnemyEnd(other);\r\n                break;\r\n            case tagData.boss:\r\n                this.colliderEnemyEnd(other);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    //父类提供接口 子类实现\r\n    colliderWall(other) {\r\n        console.log(this._weaponName + \"撞墙\");\r\n    }\r\n    colliderMonster(other) {\r\n        if (this.isStopRun(other)) return;\r\n        this.updateMonsterBlood(other);\r\n        // this._canAttackTimes--;\r\n        // if (this._canAttackTimes <= 0) this.recoveryToPool();\r\n        this.updateCanAttackTimes();\r\n    }\r\n    //攻击怪物和boss的区别 在于击退 穿透等属性 和一些other的内部回调 暂时没写\r\n    colliderBoss(other) {\r\n        if (this.isStopRun(other)) return;\r\n        this.updateBossBlood(other);\r\n        this.updateCanAttackTimes();\r\n    }\r\n    colliderEnemyEnd(other) {\r\n        this.removeFromTouchArr(other);\r\n        // let index = this._touchingArr.indexOf(other);\r\n        // if (index > -1) {\r\n        //     this._touchingArr.splice(index, 1)[0];\r\n        //     // console.log(this.node.uuid+\"移除node uuid is \" + other.node.uuid);\r\n        // } else {\r\n        //     // this._touchingArr.forEach(node => {\r\n        //     //     console.log(\"node.uuid is \"+node.uuid);\r\n        //     // });\r\n        //     // console.warn(this.node.uuid+\"移除node uuid is \" + other.node.uuid+\" error\");\r\n        //     // console.log(\"other.node\", other.node);\r\n        // }\r\n    }\r\n    //从touchArr中移除\r\n    removeFromTouchArr(other) {\r\n        let index = this._touchingArr.indexOf(other);\r\n        if (index > -1) {\r\n            this._touchingArr[index] = this._touchingArr[this._touchingArr.length - 1];\r\n            --this._touchingArr.length;\r\n            if (!other.node || (other.node.parent !== find(\"Canvas/enemyLayer\") && other.node.parent !== find(\"Canvas/bossLayer\"))) return;//不在enemyLayer  已经放入对象池 不在做判断\r\n            let box = this.getComponent(BoxCollider2D);\r\n            let circle = this.getComponent(CircleCollider2D);\r\n            let self = box ? box : circle;\r\n            let isCollide: boolean;\r\n            if (box) isCollide = this.rectIsIntersectsRect(box.worldAABB, other.worldAABB);\r\n            else isCollide = this.rectIsIntersectsRect(circle.worldAABB, other.worldAABB);\r\n            if (isCollide) {\r\n                this.onBeginContact(self, other);\r\n            }\r\n        }\r\n    }\r\n    //是否正在碰撞中\r\n    isTouching(other) {\r\n        return this._touchingArr.indexOf(other) > -1;\r\n    }\r\n    // 是否已经产生过碰撞伤害 通过uuid记录 \r\n    isHasAttacked(uuid) {\r\n        return this._hasAttackedEnemies.indexOf(uuid) > -1;\r\n    }\r\n    updateMonsterBlood(other) {\r\n        let damage = em.dispatch(\"usingHeroControlFun\", \"getCurDamage\") * (1 + this._damageTimes) + this._damage;\r\n        damage = damage | 0;\r\n        // let damage = em.dispatch(\"getHeroControlProperty\",\"_damage\") + this._damage;\r\n        let isCriticalHit = em.dispatch(\"usingHeroControlFun\", \"isCriticalHit\")\r\n        if (isCriticalHit) {\r\n            damage *= em.dispatch(\"usingHeroControlFun\", \"getCurCriticalHitDamage\");\r\n            damage = damage | 0;\r\n            em.dispatch(\"createDamageTex\", other.node, damage, { x: 0, y: 20 }, \"criticalHit\");\r\n        } else em.dispatch(\"createDamageTex\", other.node, damage, { x: 0, y: 20 });\r\n        let bonusBackDis = em.dispatch(\"getHeroControlProperty\",\"_bonusBackDis\");\r\n        other.node.getComponent(\"Monster\").updateBlood(-damage, this._backDis+bonusBackDis);\r\n    }\r\n    updateBossBlood(other) {\r\n        //boss节点名 必须和boss 名 相同\r\n        let damage = em.dispatch(\"usingHeroControlFun\", \"getCurDamage\") + this._damage;\r\n        em.dispatch(\"createDamageTex\", other.node, damage, { x: 0, y: 20 });\r\n        let script = other.node.parent.components[0];\r\n        if (script) {\r\n            script.updateBlood(-damage);\r\n        } else {\r\n            throw \"script is not init\";\r\n        }\r\n    }\r\n    isStopRun(other) {\r\n        // return ggd.stopAll && !this.isTouching(other);\r\n        return ggd.stopAll || !this.isTouching(other);\r\n    }\r\n    // 回收进对象池\r\n    recoveryToPool(type = \"unknown\") {\r\n        // console.log(\"回调类型：\"+type);\r\n        plm.putToPool(this._weaponName, this.node);\r\n        // plm.putToPool(this._weaponName, this.node, true);\r\n    }\r\n    // 刷新穿透次数\r\n    updateCanAttackTimes() {\r\n        this._canAttackTimes--;\r\n        if (this._canAttackTimes <= 0) this.recoveryToPool(\"updateCanAttackTimes\");\r\n    }\r\n    addToAnimManger() {\r\n        let anim = this.node.getComponent(Animation);\r\n        em.dispatch(\"usingGameAnimManagerFun\", \"addAnimToList\", anim);\r\n    }\r\n    removeAnimFromList() {\r\n        let anim = this.node.getComponent(Animation);\r\n        em.dispatch(\"usingGameAnimManagerFun\", \"removeAnimFromList\", anim);\r\n    }\r\n    //判断矩形是否相交\r\n    rectIsIntersectsRect(rect1, rect2) {\r\n        return rect1.intersects(rect2);\r\n    }\r\n    // 检查是否超过最远距离\r\n    isExceedMaxDistance(dis: number, interval: number) {\r\n        let fun = () => {\r\n            let flag = this.recoveryToPoolWhenWeaponIsDistant(dis);\r\n            if (flag) {\r\n                this.unschedule(fun);\r\n                this.recoveryToPool(\"isExceedMaxDistance\");\r\n            }\r\n        }\r\n        this.schedule(fun, interval);\r\n    }\r\n    recoveryToPoolWhenWeaponIsDistant(dis: number) {\r\n        if (ggd.stopAll) return false;\r\n        if (this.getDistanceToHero() > dis) return true;\r\n    }\r\n    getDistanceToHero() {\r\n        let targetPos = em.dispatch(\"getTargetWorldPos\");\r\n        let curPos = this.node.getWorldPosition();\r\n        return this.getTwoPointDistance(targetPos, curPos);\r\n    }\r\n    //获取两点的距离\r\n    getTwoPointDistance(pos1, pos2) {\r\n        let x = pos1.x - pos2.x;\r\n        let y = pos1.y - pos2.y;\r\n        return Math.sqrt(x * x + y * y);\r\n    }\r\n\r\n    //=====================法器专用=====================\r\n    //初始化法器碰撞器 区别在于 法器碰撞器大小和偏移预先设置好 无需变化 只需要设置碰撞回调等...\r\n    initEquBoxCollider(tag: number) {\r\n        let collider = this.node.getComponent(BoxCollider2D);\r\n        if (!collider) throw \"未初始化法器碰撞器\";\r\n        collider.tag = tag;\r\n        collider.group = groupIndex.heroWeapon;\r\n        // console.log(\"collider\", collider);\r\n        collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        collider.on(Contact2DType.END_CONTACT, this.onEndContact, this);\r\n    }\r\n    //初始化装备额外属性\r\n    initEquDataByExtraProperties(data) {\r\n        if (data.qData.effect.indexOf(1) > -1) this._damage = 0;\r\n        if (data.qData.effect.indexOf(3) > -1) {\r\n            this._damage *= 0.7;\r\n            this._damageTimes *= 0.8;\r\n        }\r\n        if (data.qData.effect.indexOf(1002) > -1) this._damageTimes *= 0.1;\r\n        if (data.qData.effect.indexOf(1003) > -1) this._damageTimes *= 0.3;\r\n        if (data.qData.effect.indexOf(1004) > -1) this._damageTimes *= 0.5;\r\n        if (data.qData.effect.indexOf(1008) > -1) this.node.setScale(1.5, 1.5, 2);\r\n        if (data.qData.effect.indexOf(1009) > -1) this.node.setScale(2, 2, 2);\r\n        if (data.qData.effect.indexOf(1010) > -1) this._canAttackTimes++;\r\n        if (data.qData.effect.indexOf(1005) > -1) this.initEquBoxCollider(tagData.destroyWeapon);\r\n        else this.initEquBoxCollider(tagData.sword);\r\n        if (data.qData.effect.indexOf(5001) > -1) this._duration *= 2;\r\n        if (data.qData.effect.indexOf(5002) > -1) this._duration = Infinity;\r\n    }\r\n}\r\n\r\n"]}