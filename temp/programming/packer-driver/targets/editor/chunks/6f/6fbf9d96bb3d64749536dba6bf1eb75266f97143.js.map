{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/hero/weapon/SwordRain.ts"],"names":["_decorator","Vec2","tagData","Weapon","ccclass","property","SwordRain","init","skillData","initSkillData","data","_damage","damage","_duration","duration","_moveSpeed","_canAttackTimes","Infinity","_backDis","_attackInterval","_weaponName","name","_flyDir","clearCacheData","initBoxCollider","sword","changeBulletRotationByFlyDir","colliderMonster","other","isStopRun","isHasAttacked","node","uuid","updateMonsterBlood","_hasAttackedEnemies","push","recoveryToPool","x","y","angle","bevelLen","Math","sqrt","sin","abs","asin"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-09-26 14:06:40\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-10-26 16:18:56\r\n * @FilePath: \\copy9train\\assets\\script\\hero\\weapon\\SwordRain.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, Vec2 } from 'cc';\r\nimport { em } from '../../global/EventManager';\r\nimport { attackInterval, tagData } from '../../global/globalData';\r\nimport { Weapon } from './Weapon';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('SwordRain')\r\nexport class SwordRain extends Weapon {\r\n\r\n    init(skillData) {\r\n        this.initSkillData(skillData);\r\n        //em.dispatch(\"playOneShot\",\"battle/bullet\");\r\n    }\r\n    initSkillData(data) {\r\n        this._damage = data.damage;\r\n        this._duration = data.duration;\r\n        this._moveSpeed = 500;\r\n        this._canAttackTimes = Infinity;\r\n        this._backDis = 0;\r\n        this._attackInterval = 0.5;\r\n        this._weaponName = data.name;\r\n        this._flyDir = new Vec2(-.25, -1);\r\n        this.clearCacheData();\r\n        this.initBoxCollider(tagData.sword);\r\n        this.changeBulletRotationByFlyDir();\r\n    }\r\n    colliderMonster(other) {\r\n        if (this.isStopRun(other)) return;\r\n        if (this.isHasAttacked(other.node.uuid)) return;//已经被剑攻击过的对象 忽略后续攻击\r\n        this.updateMonsterBlood(other);\r\n        this._hasAttackedEnemies.push(other.node.uuid);\r\n        this._canAttackTimes--;\r\n        if (this._canAttackTimes <= 0) this.recoveryToPool();\r\n    }\r\n    // 通过飞行方向修改子弹旋转方向 没有方向的子弹暂不处理\r\n    changeBulletRotationByFlyDir() {\r\n        if (this._flyDir.x == 0 && this._flyDir.y == 0) return;//无方向 暂不处理\r\n        if (this._flyDir.x == 0) {//没有x方向\r\n            if (this._flyDir.y > 0) this.node.angle = -90;\r\n            else this.node.angle = 90;\r\n            return;\r\n        };\r\n        if (this._flyDir.y == 0) {//没有y方向\r\n            if (this._flyDir.x > 0) this.node.angle = 180;\r\n            else this.node.angle = 0;\r\n            return;\r\n        };\r\n        let bevelLen = Math.sqrt(this._flyDir.x * this._flyDir.x + this._flyDir.y * this._flyDir.y);\r\n        // let sin = Math.sin(this._flyDir.x / bevelLen);\r\n        let sin = Math.sin(Math.abs(this._flyDir.y) / bevelLen);\r\n        let asin = Math.asin(sin);\r\n        let angle = asin * 90;\r\n        // console.log(\"angle\", angle);\r\n        if (this._flyDir.y > 0) {//向上飞行\r\n            if (this._flyDir.x > 0) this.node.angle = 180 + angle;\r\n            else this.node.angle = 360 - angle;\r\n        } else {\r\n            if (this._flyDir.x > 0) this.node.angle = 180 - angle;\r\n            else this.node.angle = angle\r\n        }\r\n        // this.node.angle = 70;\r\n    }\r\n}\r\n\r\n"]}