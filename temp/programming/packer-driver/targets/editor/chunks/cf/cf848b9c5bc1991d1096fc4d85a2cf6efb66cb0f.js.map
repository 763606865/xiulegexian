{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/global/HttpRequest.ts"],"names":["HttpRequest","sys","ggd","constructor","get","url","params","cb","eb","tb","xhr","XMLHttpRequest","data","param","key","paramStr","console","log","open","setRequestHeader","xhrBindCallback","send","post","JSON","stringify","Date","now","imei","phoneInfo","localStorage","getItem","randomCreateImei","setItem","os","userInfo","token","s","randomImei","hexDigits","i","substr","Math","floor","random","join","cpCb","errCb","toCb","onreadystatechange","readyState","status","response","parse","responseText","runDefaultCompleteCallback","onerror","runDefaultErrorCallback","timeout","ontimeout","e","runDefaultTimeoutCallback","string","hr"],"mappings":"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","sourcesContent":["import { sys } from \"cc\";\r\nimport { ggd } from \"./globalData\";\r\n\r\n\r\n/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-10-27 15:38:10\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-10-27 17:14:25\r\n * @FilePath: \\copy9train\\assets\\script\\global\\HttpRequest.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nexport { hr }\r\nclass HttpRequest {\r\n    constructor() {\r\n        // console.log(\"创建http请求\");\r\n    }\r\n    get(url, params, cb, eb = null, tb = null) {\r\n        var xhr = new XMLHttpRequest();\r\n\r\n        var data = params;\r\n        let param = '?';\r\n        for (var key in data) {\r\n            var paramStr = key + \"=\" + data[key];\r\n            // if (param == \"\") param += paramStr;\r\n            if (param == \"?\") param += paramStr;\r\n            else param += \"&\" + paramStr;\r\n        };\r\n        console.log(\"get:请求路径\", url + param);\r\n        xhr.open(\"GET\", url + param);\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded;charset=utf-8\");\r\n        // xhr.setRequestHeader(\"Authorization\", \"Bearer \"+token);\r\n        this.xhrBindCallback(xhr, cb, eb, tb);\r\n        xhr.send();\r\n    };\r\n    post(url, params, cb, eb = null, tb = null) {\r\n        if (typeof (params) !== \"object\") {\r\n            return console.log(\"参数不是对象 传输错误\");\r\n        };\r\n        var xhr = new XMLHttpRequest();\r\n        // console.log(\"post:请求路径\", url);\r\n        xhr.open(\"POST\", url);\r\n        // xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded;charset=utf-8\");\r\n        this.setRequestHeader(xhr);\r\n\r\n        this.xhrBindCallback(xhr, cb, eb, tb);\r\n        // console.log(params);\r\n        xhr.send(JSON.stringify(params));\r\n    };\r\n    setRequestHeader(xhr) {\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        xhr.setRequestHeader(\"version\", 101);\r\n        xhr.setRequestHeader(\"nonce\", Date.now());\r\n        let imei = ggd.phoneInfo.imei;\r\n        if (imei) xhr.setRequestHeader(\"imei\", imei);\r\n        else {\r\n            let imei = sys.localStorage.getItem(\"imei\");\r\n            if (imei) xhr.setRequestHeader(\"imei\", imei);\r\n            else {\r\n                imei = this.randomCreateImei();\r\n                sys.localStorage.setItem(\"imei\", imei);\r\n                xhr.setRequestHeader(\"imei\", imei);\r\n            }\r\n        }\r\n\r\n        if (sys.os == \"Android\") xhr.setRequestHeader(\"os\", \"ANDROID\");\r\n        else if (sys.os == \"iOS\") xhr.setRequestHeader(\"os\", \"IOS\");\r\n        else xhr.setRequestHeader(\"os\", \"PC\");\r\n        if (ggd.userInfo.token) xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ggd.userInfo.token);\r\n\r\n    }\r\n    //获取随机imei\r\n    randomCreateImei() {\r\n        var s = [];\r\n        var randomImei;\r\n        var hexDigits = \"0123456789abcdef\";\r\n        for (var i = 0; i < 36; i++) {\r\n            s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\r\n        }\r\n        s[14] = \"4\";\r\n        s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);\r\n        s[8] = s[13] = s[18] = s[23] = \"-\";\r\n        randomImei = s.join(\"\");\r\n        return randomImei;\r\n    }\r\n    //xhr绑定回掉函数 \r\n    xhrBindCallback(xhr, cpCb, errCb, toCb) {\r\n        xhr.onreadystatechange = () => {\r\n            if (xhr.readyState != 4) return;\r\n            if (xhr.status >= 200 && xhr.status <= 207) {\r\n                // console.log(\"xhr.responseText\",xhr.responseText);\r\n                let response = JSON.parse(xhr.responseText);\r\n                if (cpCb) cpCb(response);\r\n                else this.runDefaultCompleteCallback(response);\r\n            } else {\r\n                console.log(\"xhr.status\", xhr.status);\r\n            };\r\n        };\r\n        xhr.onerror = () => {\r\n            if (xhr.readyState == 1 && xhr.status == 0) {\r\n                if (errCb) errCb(\"断网\");\r\n                else this.runDefaultErrorCallback(\"断网\"); // 断网\r\n            } else {\r\n                if (errCb) errCb(\"未知错误\");\r\n                else this.runDefaultErrorCallback(\"未知错误\"); // 断网\r\n            }\r\n        };\r\n        xhr.timeout = 60000;\r\n        xhr.ontimeout = (e) => {\r\n            if (toCb) toCb(e);\r\n            else this.runDefaultTimeoutCallback(e);\r\n        };\r\n    };\r\n    //运行默认 completeCallback\r\n    runDefaultCompleteCallback(response) {\r\n        console.log(\"run Default Complete Callback\");\r\n        console.log(\"response\", response);\r\n    };\r\n    //运行默认 errorCallback\r\n    runDefaultErrorCallback(string) {\r\n        console.log(\"run Default Error Callback\");\r\n        console.log(\"string\", string);\r\n    };\r\n    //运行默认 ontimeoutCallback\r\n    runDefaultTimeoutCallback(e) {\r\n        console.log(\"run default timeout callback\");\r\n        console.log(\"e\", e);\r\n    };\r\n};\r\n\r\nconst hr = new HttpRequest();"]}