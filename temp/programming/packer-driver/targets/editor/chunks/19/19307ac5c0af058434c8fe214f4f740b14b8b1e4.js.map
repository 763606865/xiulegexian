{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/enemy/skill/EnemySkill.ts"],"names":["_decorator","Component","BoxCollider2D","UITransform","Size","Contact2DType","CircleCollider2D","em","ggd","groupIndex","tagData","plm","ccclass","property","EnemySkill","_skillName","_damage","_flyDir","_moveSpeed","_duration","Infinity","_canAttackTimes","_curData","init","data","flyDir","scale","name","damage","duration","moveSpeed","canAttackTimes","initCollider","collider","node","getComponent","addComponent","UIT","skillSize","contentSize","x","y","tag","enemySkill","size","group","on","BEGIN_CONTACT","onBeginContact","initCircleCollider","radius","self","other","hero","colliderHero","destroyWeapon","recoveryPrefab","hasOwnProperty","effects","indexOf","dispatch","putToPool","destroyPrefab","destroy","update","deltaTime","weaponMove","weaponDuration","stopAll","dis","moveX","moveY","setPosition","getPosition"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-09-26 16:21:41\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-12-14 14:32:01\r\n * @FilePath: \\to-be-immortal\\assets\\script\\enemy\\skill\\EnemySkill.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, BoxCollider2D, UITransform, Size, Contact2DType, Collider2D, Animation, CircleCollider2D } from 'cc';\r\nimport { em } from '../../global/EventManager';\r\nimport { ggd, groupIndex, tagData } from '../../global/globalData';\r\n\r\nimport { plm } from '../../global/PoolManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('EnemySkill')\r\nexport class EnemySkill extends Component {\r\n\r\n    _skillName: string;\r\n    _damage: number;\r\n    _flyDir: any;\r\n    _moveSpeed: number;\r\n    _duration: number = Infinity;\r\n    _canAttackTimes: number;\r\n\r\n    _curData = null;\r\n\r\n    init(data, flyDir = null, scale = 1) {\r\n        this._curData = data;\r\n        this._skillName = data.name;\r\n        this._damage = data.damage;\r\n        this._duration = data.duration;\r\n        this._moveSpeed = data.moveSpeed;\r\n        if (data.canAttackTimes) this._canAttackTimes = data.canAttackTimes;\r\n        else this._canAttackTimes = Infinity;\r\n        this._flyDir = flyDir;\r\n        this.initCollider(scale);\r\n    }\r\n    initCollider(scale = 1) {\r\n        let collider = this.node.getComponent(BoxCollider2D);\r\n        if (!collider) collider = this.node.addComponent(BoxCollider2D);\r\n        let UIT = this.node.getComponent(UITransform);\r\n        let skillSize = new Size(UIT.contentSize.x * scale, UIT.contentSize.y * scale);\r\n        collider.tag = tagData.enemySkill;\r\n        collider.size = skillSize;\r\n        collider.group = groupIndex.enemySkill;\r\n        collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        // console.log(\"EnemySkill collider\",collider);\r\n    }\r\n    initCircleCollider(scale = 1) {\r\n        let collider = this.node.getComponent(CircleCollider2D);\r\n        if (!collider) collider = this.node.addComponent(CircleCollider2D);\r\n        let UIT = this.node.getComponent(UITransform);\r\n        let skillSize = new Size(UIT.contentSize.x * scale, UIT.contentSize.y * scale);\r\n        collider.tag = tagData.enemySkill;\r\n        collider.radius = skillSize.x / 2;\r\n        collider.group = groupIndex.enemySkill;\r\n        collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n    }\r\n    onBeginContact(self, other) {\r\n        // 攻击玩家\r\n        if (other.tag == tagData.hero) {\r\n            this.colliderHero();\r\n        }\r\n        //碰撞销毁\r\n        if (other.tag == tagData.destroyWeapon) {\r\n            this.recoveryPrefab();\r\n        }\r\n    }\r\n    colliderHero() {\r\n        if (this._curData.hasOwnProperty(\"effects\") && this._curData.effects.indexOf(\"slow\") > -1) {//减速\r\n            em.dispatch(\"usingHeroControlFun\", \"addDebuffSlow\", 5, 20);//降低20点移速 持续3s\r\n        }\r\n        if (this._damage) {//技能存在伤害\r\n            em.dispatch(\"usingHeroControlFun\", \"createBossDamageTex\", -this._damage);\r\n        }\r\n        this._canAttackTimes--;\r\n        if (this._canAttackTimes <= 0) this.recoveryPrefab();\r\n    }\r\n    recoveryPrefab() {\r\n        plm.putToPool(this._skillName, this.node);\r\n        // plm.putToPool(this._skillName,this.node,true);\r\n    }\r\n    destroyPrefab() {\r\n        this.node.destroy();\r\n    }\r\n    update(deltaTime: number) {\r\n        this.weaponMove(deltaTime);\r\n        this.weaponDuration(deltaTime);\r\n    }\r\n    weaponMove(deltaTime: number) {\r\n        if (ggd.stopAll) return;\r\n        if (!this._flyDir) return;\r\n        if (this._moveSpeed == 0 || this._duration == Infinity) return;\r\n\r\n        let dis = deltaTime * this._moveSpeed;\r\n        // let dis = deltaTime*(this._moveSpeed+bonusMS);\r\n        let moveX = this._flyDir.x * dis;\r\n        let moveY = this._flyDir.y * dis;\r\n        this.node.setPosition(this.node.getPosition().x + moveX, this.node.getPosition().y + moveY, 0);\r\n    }\r\n    weaponDuration(deltaTime: number) {\r\n        if (ggd.stopAll) return;\r\n        this._duration -= deltaTime;\r\n        if (this._duration <= 0) this.recoveryPrefab();\r\n    }\r\n}\r\n\r\n"]}