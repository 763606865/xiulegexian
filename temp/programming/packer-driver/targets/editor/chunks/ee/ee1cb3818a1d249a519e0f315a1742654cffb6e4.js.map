{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/ZA/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/system/GameReward.ts"],"names":["_decorator","Component","em","ccclass","property","GameReward","_rewardList","today","lastTodaySignIn","sevenDaySignIn","lastSignIn","continueDays","todayEquVideoShowTimes","versionReward1_0_3_2","_maxTodayEquVideoShowTimes","onLoad","add","usingGameRewardFun","bind","onDestroy","remove","start","initRewardList","data","dispatch","key","Object","prototype","hasOwnProperty","call","Date","getDay","versionUpdateReward","string","param","signInToday","getContinueDays","gap","signInSevenDay","todayEquVideoIsCanShow","afterPlayEquVideo"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n// 各种奖励的处理逻辑 每日签到 七日签到 每日视频\r\n@ccclass('GameReward')\r\nexport class GameReward extends Component {\r\n\r\n    _rewardList = {\r\n        today: 99,\r\n        lastTodaySignIn: 999,\r\n        sevenDaySignIn: {\r\n            lastSignIn: 99,\r\n            continueDays: 0,\r\n        },\r\n        todayEquVideoShowTimes: 0,\r\n        versionReward1_0_3_2: false,\r\n    }\r\n\r\n    _maxTodayEquVideoShowTimes = 2;//每日最大播放次数\r\n    onLoad() {\r\n        em.add(\"usingGameRewardFun\", this.usingGameRewardFun.bind(this));\r\n    }\r\n    onDestroy() {\r\n        em.remove(\"usingGameRewardFun\");\r\n    }\r\n    start() {\r\n        this.initRewardList();\r\n    }\r\n    // 初始化 游戏奖励列表 读取记录列表，并用最新的列表去覆盖。\r\n    initRewardList() {\r\n        let data = em.dispatch(\"getTempData\", \"gameRewardList\");\r\n        if (data) {\r\n            for (const key in data) {\r\n                if (Object.prototype.hasOwnProperty.call(data, key) && this._rewardList.hasOwnProperty(key)) {\r\n                    this._rewardList[key] = data[key];\r\n                }\r\n            }\r\n        }\r\n        //判定是否要重置今日日期 重置后可再次签到\r\n        let today = new Date().getDay();\r\n        if (this._rewardList.today !== today || this._rewardList.today == 99) {\r\n            this._rewardList.today = today;\r\n            this._rewardList.todayEquVideoShowTimes = 0;\r\n        }\r\n\r\n        this.versionUpdateReward();\r\n\r\n        em.dispatch(\"savingToTempData\", \"gameRewardList\", this._rewardList);\r\n    }\r\n    // 版本更新补偿奖励发放\r\n    versionUpdateReward() {\r\n        // return;\r\n        //版本1.0.3.2的更新补偿奖励\r\n        if (!this._rewardList.versionReward1_0_3_2) {\r\n            this._rewardList.versionReward1_0_3_2 = true;\r\n            em.dispatch(\"addItemToSS\", \"破旧装备箱\", 5);\r\n            em.dispatch(\"showGets\", {\r\n                \"破旧装备箱\": 5,\r\n            });\r\n        }\r\n    }\r\n    //使用GameReward 方法\r\n    usingGameRewardFun(string, ...param) {\r\n        if (this[string] && typeof this[string] == \"function\") return this[string](...param);\r\n        else throw string + \" is not fun or undefined\";\r\n    }\r\n    // 今日签到\r\n    signInToday() {\r\n        if (this._rewardList.today == this._rewardList.lastTodaySignIn) {\r\n            em.dispatch(\"tipsViewShow\", \"今日已签到\");\r\n            this._rewardList.lastTodaySignIn = this._rewardList.today;\r\n            return;\r\n        }\r\n        this._rewardList.lastTodaySignIn = this._rewardList.today;\r\n        em.dispatch(\"addItemToSS\", \"破旧装备箱\", 1);\r\n        em.dispatch(\"addItemToSS\", \"神秘钥匙\", 1);\r\n        em.dispatch(\"showGets\", { \"破旧装备箱\": 1, \"神秘钥匙\": 1 });\r\n        em.dispatch(\"savingToTempData\", \"gameRewardList\", this._rewardList);\r\n    }\r\n    /**\r\n     * @description 获取连续签到天数\r\n     * @returns {number} 连续签到天数\r\n    */\r\n    getContinueDays() {\r\n        let today = new Date().getDay();\r\n        let gap = today - this._rewardList.sevenDaySignIn.lastSignIn;\r\n        //中间只差一天 或者是当天\r\n        if (gap == 1 || gap == -6 || gap == 0) return this._rewardList.sevenDaySignIn.continueDays;\r\n        else return 0;\r\n    }\r\n    /**\r\n     * @description 七日签到\r\n     * @returns {boolean} 签到是否成功\r\n     * */\r\n    signInSevenDay() {\r\n        let today = new Date().getDay();\r\n        if (this._rewardList.sevenDaySignIn.lastSignIn == today) return false;\r\n        let gap = today - this._rewardList.sevenDaySignIn.lastSignIn;\r\n        if (gap == 1 || gap == -6) {\r\n            this._rewardList.sevenDaySignIn.lastSignIn = today;\r\n            this._rewardList.sevenDaySignIn.continueDays++;\r\n            if (this._rewardList.sevenDaySignIn.continueDays > 7) this._rewardList.sevenDaySignIn.continueDays = 1;\r\n            em.dispatch(\"savingToTempData\", \"gameRewardList\", this._rewardList);\r\n            return true;\r\n        } else {\r\n            this._rewardList.sevenDaySignIn.continueDays = 1;\r\n            this._rewardList.sevenDaySignIn.lastSignIn = today;\r\n            em.dispatch(\"savingToTempData\", \"gameRewardList\", this._rewardList);\r\n            return true;\r\n        }\r\n    }\r\n    //今日装备奖励视频是否可以展示\r\n    todayEquVideoIsCanShow() {\r\n        return this._rewardList.todayEquVideoShowTimes >= this._maxTodayEquVideoShowTimes;\r\n    }\r\n    // 播放装备奖励视频\r\n    afterPlayEquVideo() {\r\n        this._rewardList.todayEquVideoShowTimes++;\r\n        em.dispatch(\"savingToTempData\", \"gameRewardList\", this._rewardList);\r\n    }\r\n}\r\n\r\n\r\n"]}