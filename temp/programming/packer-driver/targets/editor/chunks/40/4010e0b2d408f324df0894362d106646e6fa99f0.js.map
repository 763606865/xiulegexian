{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/ZA/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/system/LevelManager.ts"],"names":["LevelManager","constructor","obj","level","maxLevel","curExp","maxExp","levelMappingExpList","exp","console","log","addExp","num","isUpgrade","upgrade","len","start","afterLv","i","addNum","getExpProgress","fontLvExp","curLvExp"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-11-11 17:57:36\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-11-25 17:34:04\r\n * @FilePath: \\to-be-immortal\\assets\\script\\system\\LevelManager.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nexport { LevelManager };\r\n\r\n/**\r\n * 类说明  等级管理类\r\n * @class LevelManager\r\n * @constructor {Object}  obj 初始化数据对象\r\n * @property {Number} level 当前技能等级\r\n * @property {Number} maxLevel 当前技能最大等级\r\n * @property {Number} curExp 当前技能最大等级\r\n * @property {Object} levelMappingExpList 当前技能等级经验映射表\r\n * @property {Number} maxExp 当前技能满级经验\r\n */\r\nclass LevelManager {\r\n    level: number;\r\n    maxLevel: number;\r\n    curExp: number;\r\n    maxExp: number;\r\n    levelMappingExpList: object;\r\n    constructor(obj:{level:number,maxLevel:number,curExp:number,levelMappingExpList:any}) {\r\n        this.level = obj.level;\r\n        this.maxLevel = obj.maxLevel;\r\n        this.curExp = obj.curExp;\r\n        this.levelMappingExpList = obj.levelMappingExpList; //可以单独拿出来\r\n        this.maxExp = this.levelMappingExpList[this.maxLevel - 1].exp;\r\n        console.log(\"levelManager\",this);\r\n        \r\n    }\r\n    /**\r\n     * @method addExp 增加经验\r\n     * @return {boolean} 是否升级；\r\n     */\r\n    addExp(num:number) {\r\n        // console.log(\"this.curExp \",this.curExp );\r\n        // console.log(\"this.maxExp  \",this.maxExp  );\r\n        // console.log(\"num\",num);\r\n        \r\n        \r\n        //新增 最大等级限制\r\n        if (this.curExp >= this.maxExp || this.level >= this.maxLevel) return console.log(\"经验已满\");\r\n        this.curExp += num;\r\n        // console.log(\"经验+\" + num);\r\n        if (this.curExp >= this.maxExp) this.curExp = this.maxExp;\r\n        // console.log(\"this.curExp\",this.curExp);\r\n        // console.log(\"this.maxExp\",this.maxExp);\r\n        if (this.isUpgrade()) {\r\n            this.upgrade();\r\n            return true;\r\n        };\r\n    }\r\n    // 是否能够升级\r\n    isUpgrade() {\r\n        return this.curExp >= this.levelMappingExpList[this.level].exp;\r\n    }\r\n    // 升级\r\n    upgrade() {\r\n        let len = this.maxLevel;\r\n        let start = this.level + 1;\r\n        let afterLv:number;\r\n        for (let i = start; i < len; i++) {\r\n            // let exp = this.levelMappingExpList[i].exp;\r\n            let exp = this.levelMappingExpList[i - 1].exp;\r\n            if (exp > this.curExp) {\r\n                afterLv = i - 1;\r\n                break;\r\n            }\r\n            if (i == len - 1 && exp <= this.curExp) afterLv = this.maxLevel;\r\n        }\r\n        let addNum = afterLv - this.level;\r\n        this.level = afterLv;\r\n        console.log(\"等级+\" + addNum);\r\n    }\r\n    //获取经验进度\r\n    getExpProgress() {\r\n        if (this.level == 1) return this.curExp / this.levelMappingExpList[this.level ].exp;\r\n        else {\r\n            let fontLvExp = this.levelMappingExpList[this.level - 1].exp;\r\n            let curLvExp = this.levelMappingExpList[this.level -0].exp;\r\n            // console.log(\"fontLvExp\",fontLvExp);\r\n            // console.log(\"curLvExp\",curLvExp);\r\n            // console.log(\"this.curExp - fontLvExp\",this.curExp - fontLvExp);\r\n            // console.log(\"curLvExp - fontLvExp\",curLvExp - fontLvExp);\r\n            return (this.curExp - fontLvExp)/(curLvExp - fontLvExp);\r\n        };\r\n    }\r\n    // 返回当前等级\r\n}\r\n\r\n"]}