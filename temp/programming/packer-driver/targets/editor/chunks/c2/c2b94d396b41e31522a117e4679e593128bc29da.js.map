{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/ZA/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/mainMenu/MakePillsLayer.ts"],"names":["_decorator","Component","Node","Prefab","find","SpriteFrame","instantiate","Sprite","Label","Color","NodePool","Material","tween","Vec3","em","glf","plm","ccclass","property","MakePillsLayer","_curPillData","_pillPar","_pillPrefabArr","_itemPrefabArr","_pillListConfig","onLoad","node","addPoolToPools","itemPrefab","initPillList","updatePillState","tipsTexPool","tipsPrefab","initStoveBtn","forEach","data","index","pill","pillPrefab","parent","getChildByName","getComponent","spriteFrame","pillSF","imageIndex","string","name","total","dispatch","createButton","push","updatePillList","btn","callback","onBtnMakePill","on","EventType","TOUCH_START","schedule","TOUCH_END","unschedule","onEnable","updateMaterialDemand","guideData","startMakePillsLayerGuide","onBtnPill","e","target","console","log","color","m1","m2","data1","consumeItemName","data2","t1","t2","s1","s2","loadUrl","assets","l1","l2","l12","l22","consumeTotal","consumeLingshi","scheduleOnce","material","defaultMaterial","grayMaterial","guideFinger","active","itemIsEnough","lingshiIsEnough","id","createTipsTex","tips","content","initPos","x","y","tex","getFromPool","setPosition","playTIPSTeXEffect","a1","by","position","onUpdate","ratio","lerp","r","g","b","a2","to","scale","action","parallel","call","setScale","putToPool","start","guideTips"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-09-08 17:30:34\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-12-12 21:27:02\r\n * @FilePath: \\to-be-immortal\\assets\\script\\mainMenu\\MakePillsLayer.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, Prefab, find, SpriteFrame, instantiate, Sprite, Label, Color, NodePool, Material, tween, Vec3 } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nimport { glf } from '../global/globalFun';\r\nimport { plm } from '../global/PoolManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MakePillsLayer')\r\nexport class MakePillsLayer extends Component {\r\n    @property(Prefab)\r\n    pillPrefab;\r\n    @property(Prefab)\r\n    itemPrefab;\r\n    @property([SpriteFrame])\r\n    pillSF;\r\n    @property(Node)\r\n    itemPar;\r\n    @property(Material)\r\n    grayMaterial;\r\n    @property(Material)\r\n    defaultMaterial;\r\n    @property(Node)\r\n    guideFinger;\r\n    @property(Prefab)\r\n    tipsPrefab;\r\n\r\n    _curPillData;\r\n    _pillPar: Node;\r\n    _pillPrefabArr: any[] = [];\r\n    _itemPrefabArr: Node[] = [];//下方丹药数量显示\r\n    _pillListConfig = [\r\n        {\r\n            \"id\": 4,\r\n            \"name\": \"炼气丹\",\r\n            \"imageIndex\": 0,\r\n            \"description\": \"提升修为，通过妖丹炼制\",\r\n            \"consumeTotal\": 10,\r\n            \"consumeItemName\": \"一阶妖丹\",\r\n            \"consumeLingshi\": 50,\r\n        },\r\n        {\r\n            \"id\": 5,\r\n            \"name\": \"筑基丹\",\r\n            \"imageIndex\": 1,\r\n            \"description\": \"提升修为，通过妖丹炼制\",\r\n            \"consumeTotal\": 10,\r\n            \"consumeItemName\": \"二阶妖丹\",\r\n            \"consumeLingshi\": 500,\r\n        },\r\n        {\r\n            \"id\": 6,\r\n            \"name\": \"金元丹\",\r\n            \"imageIndex\": 2,\r\n            \"description\": \"提升修为，通过妖丹炼制\",\r\n            \"consumeTotal\": 10,\r\n            \"consumeItemName\": \"三阶妖丹\",\r\n            \"consumeLingshi\": 5000,\r\n        },\r\n        {\r\n            \"id\": 7,\r\n            \"name\": \"元婴丹\",\r\n            \"imageIndex\": 3,\r\n            \"description\": \"提升修为，通过妖丹炼制\",\r\n            \"consumeTotal\": 10,\r\n            \"consumeItemName\": \"四阶妖丹\",\r\n            \"consumeLingshi\": 50000,\r\n        },\r\n        {\r\n            \"id\": 8,\r\n            \"name\": \"化神丹\",\r\n            \"imageIndex\": 4,\r\n            \"description\": \"提升修为，通过妖丹炼制\",\r\n            \"consumeTotal\": 10,\r\n            \"consumeItemName\": \"五阶妖丹\",\r\n            \"consumeLingshi\": 500000,\r\n        },\r\n    ];\r\n    onLoad() {\r\n        this._pillPar = find(\"/selectPill/sliding/content\", this.node);\r\n        // plm.addPoolToPools(\"MPLPillPrefab\",new NodePool(),this.pillPrefab);//不需要回收 无需生成对象池\r\n        plm.addPoolToPools(\"MPLItemPrefab\", new NodePool(), this.itemPrefab);\r\n        this.initPillList();\r\n        this._curPillData = this._pillListConfig[0];\r\n        this.updatePillState(this._pillPrefabArr[0]);\r\n        // this.updateMaterialDemand();\r\n\r\n        let tipsTexPool = new NodePool();\r\n        plm.addPoolToPools(\"tipsTex\", tipsTexPool, this.tipsPrefab);\r\n        this.initStoveBtn();\r\n    }\r\n    // 初始化炼丹列表\r\n    initPillList() {\r\n        this._pillListConfig.forEach((data, index) => {\r\n            let pill = instantiate(this.pillPrefab);\r\n            // let pill = plm.getFromPool(\"MPLPillPrefab\");\r\n            pill.parent = this._pillPar;\r\n            pill.getChildByName(\"sprite\").getComponent(Sprite).spriteFrame = this.pillSF[data.imageIndex];\r\n            pill.getChildByName(\"name\").getComponent(Label).string = data.name;\r\n            let total = em.dispatch(\"getItemTotalByIdOrName\", data.name);\r\n            pill.getChildByName(\"total\").getComponent(Label).string = total;\r\n            pill.data = data;//可以直接通过节点获取\r\n            glf.createButton(this.node, pill, \"MakePillsLayer\", \"onBtnPill\");\r\n            this._pillPrefabArr.push(pill);\r\n        });\r\n    }\r\n    // 刷新炼丹列表丹药数量\r\n    updatePillList() {\r\n        for (const pill of this._pillPrefabArr) {\r\n            let data = pill.data;\r\n            let total = em.dispatch(\"getItemTotalByIdOrName\", data.name);\r\n            pill.getChildByName(\"total\").getComponent(Label).string = total;\r\n        }\r\n    }\r\n    // 初始化丹炉按钮\r\n    initStoveBtn() {\r\n        let btn = find(\"/stove\", this.node);\r\n        // btn.on(\"touchstart\",this.onBtnMakePill,this);\r\n        let callback = () => {\r\n            this.onBtnMakePill();\r\n        };\r\n        btn.on(Node.EventType.TOUCH_START, () => {\r\n            this.onBtnMakePill();\r\n            this.schedule(callback, 0.1);\r\n        }, this);\r\n        btn.on(Node.EventType.TOUCH_END, () => {\r\n            this.unschedule(callback);\r\n        }, this);\r\n\r\n    }\r\n    onEnable() {\r\n        // this.updatePillsContent();\r\n        this.updateMaterialDemand();\r\n\r\n        let guideData = em.dispatch(\"getGuideData\");\r\n        if (!guideData.MakePillsLayer) {\r\n            this.startMakePillsLayerGuide();\r\n        }\r\n    }\r\n    onBtnPill(e) {\r\n        let node = e.target;\r\n        this._curPillData = node.data;\r\n        console.log(\"_curPillData\", this._curPillData);\r\n        em.dispatch(\"playOneShot\", \"common/通用按键\");\r\n        this.updatePillState(node);\r\n        this.updateMaterialDemand();\r\n    }\r\n    //刷新丹药选择状态\r\n    updatePillState(node) {\r\n        this._pillPrefabArr.forEach(pill => {\r\n            if (pill === node) {\r\n                pill.getChildByName(\"name\").getComponent(Label).color = new Color(255, 204, 0, 255);\r\n            } else {\r\n                // pill.getChildByName(\"name\").getComponent(Label).color = new Color(0, 0, 0, 255);\r\n                pill.getChildByName(\"name\").getComponent(Label).color = new Color(255, 255, 255, 255);\r\n            }\r\n        });\r\n    }\r\n    // 刷新需要材料显示 妖丹和灵石\r\n    updateMaterialDemand() {\r\n        console.log(\"this._curPillData \", this._curPillData);\r\n        let m1 = find(\"/stove/m1\", this.node);\r\n        let m2 = find(\"/stove/m2\", this.node);\r\n        let data1 = em.dispatch(\"getItemDataByIdOrName\", this._curPillData.consumeItemName);\r\n        let data2 = em.dispatch(\"getItemDataByIdOrName\", \"灵石\");\r\n        let t1 = em.dispatch(\"getItemTotalByIdOrName\", this._curPillData.consumeItemName);\r\n        let t2 = em.dispatch(\"getItemTotalByIdOrName\", \"灵石\");\r\n        let s1 = m1.getChildByName(\"sprite\").getComponent(Sprite);\r\n        let s2 = m2.getChildByName(\"sprite\").getComponent(Sprite);\r\n        em.dispatch(\"loadTheDirResources\", \"images/items/\" + data1.loadUrl + \"/spriteFrame\", (assets) => s1.spriteFrame = assets);\r\n        em.dispatch(\"loadTheDirResources\", \"images/items/\" + data2.loadUrl + \"/spriteFrame\", (assets) => s2.spriteFrame = assets);\r\n        let l1 = m1.getChildByName(\"Label\").getComponent(Label);\r\n        let l2 = m2.getChildByName(\"Label\").getComponent(Label);\r\n        let l12 = m1.getChildByName(\"Label2\").getComponent(Label);\r\n        let l22 = m2.getChildByName(\"Label2\").getComponent(Label);\r\n        m1.getChildByName(\"nameBg\").getChildByName(\"Label\").getComponent(Label).string = data1.name;\r\n        m2.getChildByName(\"nameBg\").getChildByName(\"Label\").getComponent(Label).string = data2.name;\r\n        l1.string = \"x\" + this._curPillData.consumeTotal;\r\n        l2.string = \"x\" + this._curPillData.consumeLingshi;\r\n        l12.string = t1;\r\n        l22.string = t2;\r\n        this.scheduleOnce(() => {\r\n            if (t1 >= this._curPillData.consumeTotal) {\r\n                s1.material = this.defaultMaterial;\r\n            } else {\r\n                s1.material = this.grayMaterial;\r\n            }\r\n            if (t2 >= this._curPillData.consumeLingshi) {\r\n                s2.material = this.defaultMaterial;\r\n            } else {\r\n                s2.material = this.grayMaterial;\r\n            }\r\n        }, 0);\r\n\r\n        // l1.string = data1.name + \"\\n需要：\" + this._curPillData.consumeTotal + \"\\n拥有：\" + t1;\r\n        // l2.string = data2.name + \"\\n需要：\" + this._curPillData.consumeLingshi + \"\\n拥有：\" + t2;\r\n    }\r\n    onBtnMakePill() {\r\n        this.guideFinger.active = false;\r\n        if (!em.dispatch(\"getGuideData\").MakePillsLayer) {\r\n            em.dispatch(\"setGuideData\", \"MakePillsLayer\", true);\r\n            em.dispatch(\"initMainMenuByGuideData\");\r\n        }\r\n        em.dispatch(\"playOneShot\", \"common/炼制丹药\");\r\n        let itemIsEnough = em.dispatch(\"itemIsEnough\", this._curPillData.consumeItemName, this._curPillData.consumeTotal);\r\n        let lingshiIsEnough = em.dispatch(\"itemIsEnough\", \"灵石\", this._curPillData.consumeLingshi);\r\n        if (itemIsEnough && lingshiIsEnough) {\r\n            em.dispatch(\"reduceItemFromSS\", this._curPillData.consumeItemName, this._curPillData.consumeTotal);\r\n            em.dispatch(\"reduceItemFromSS\", \"灵石\", this._curPillData.consumeLingshi);\r\n            console.log(this._curPillData.name + \"+1\");\r\n            em.dispatch(\"addItemToSS\", this._curPillData.id, 1);\r\n            this.updatePillList();\r\n            this.updateMaterialDemand();\r\n            this.createTipsTex(this._curPillData.name + \"+1\");\r\n            let total = em.dispatch(\"getItemTotalByIdOrName\", \"灵石\");\r\n            find(\"Canvas/menuLayer/title/lingshiTotalBg/total\").getComponent(Label).string = total;\r\n        } else {\r\n            let tips = \"\";\r\n            if (!itemIsEnough && !lingshiIsEnough) tips = \"妖丹和灵石不足，无法炼制。\";\r\n            else if (!itemIsEnough) tips = \"妖丹不足，无法炼制。\";\r\n            else tips = \"灵石不足，无法炼制。\"\r\n            em.dispatch(\"tipsViewShow\", tips);\r\n        }\r\n    }\r\n\r\n    //=================创建提示信息===============\r\n    createTipsTex(content: string, initPos = { x: 0, y: 100 }) {\r\n        let tex = plm.getFromPool(\"tipsTex\");\r\n        tex.getComponent(Label).string = content;\r\n        tex.parent = find(\"Canvas/menuLayer/MakePillsLayer/tipsPar\");\r\n        tex.setPosition(initPos.x, initPos.y, 0);\r\n        this.playTIPSTeXEffect(tex);\r\n    }\r\n    playTIPSTeXEffect(tex, color = new Color(255, 255, 255, 255)) {\r\n        let a1 = tween().by(1, { position: new Vec3(0, 200, 0) }, {\r\n            onUpdate: (target, ratio) => {\r\n                // if(ratio>0.5) tex.getComponent(Label).color = Color.lerp(new Color(), color, new Color(color.r, color.g, color.b, 0), (ratio -0.5)*2);\r\n                tex.getComponent(Label).color = Color.lerp(new Color(), color, new Color(color.r, color.g, color.b, 0), ratio);\r\n            }\r\n        });\r\n        let a2 = tween().to(0.5, { scale: new Vec3(1.2, 1.2, 1) });\r\n        let action = tween(tex).parallel(a1, a2)\r\n            .call(() => {\r\n                tex.setScale(new Vec3(1, 1, 1));\r\n                plm.putToPool(\"tipsTex\", tex, true);\r\n            });\r\n        action.start();\r\n    }\r\n    startMakePillsLayerGuide() {\r\n        this.guideFinger.active = true;\r\n        find(\"Canvas/menuLayer/guideFinger\").active = false;\r\n        em.dispatch(\"addItemToSS\", \"一阶妖丹\", 10);\r\n        em.dispatch(\"addItemToSS\", \"灵石\", 50);\r\n        let tips = \"获得物品一阶妖丹x10、灵石x50\";\r\n        em.dispatch(\"tipsViewShow\", tips);\r\n        this.updateMaterialDemand();\r\n        let guideTips = \"点击丹炉，炼制丹药，提升修为。当材料不足时，材料图片会置灰。可以通过修炼场获取材料。\"\r\n        em.dispatch(\"openGuideTips\", guideTips);\r\n    }\r\n\r\n}\r\n\r\n"]}