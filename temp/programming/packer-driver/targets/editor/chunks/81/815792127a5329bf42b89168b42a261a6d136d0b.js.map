{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/ZA/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/hero/HeroCollider.ts"],"names":["_decorator","Component","Contact2DType","BoxCollider2D","UITransform","Size","em","ggd","groupIndex","tagData","ccclass","property","HeroCollider","_touchFireBallFire","_isInsideObs","start","openCollider","collider","getComponent","node","addComponent","UIT","monsterSize","contentSize","x","y","tag","hero","size","group","self","on","BEGIN_CONTACT","onBeginContact","END_CONTACT","onEndContact","other","fireBall","fireBallAttackHero","fireBallFire","fireBallFireAttackHero","obstacle","dispatch","fun","unschedule","schedule","randomSkillReward","destroy","ignore","boss","monster","enemySkill","indexOf","Error","console","log","stopAll","damage","attackInterval","scheduleOnce"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei 739671694@qq.com\r\n * @Date: 2022-08-13 11:48:15\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-11-28 13:49:58\r\n * @FilePath: \\to-be-immortal\\assets\\script\\hero\\HeroCollider.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, Contact2DType, Collider2D, BoxCollider2D, UITransform, Size, Sprite, UI } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nimport { ggd, groupIndex, tagData } from '../global/globalData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroCollider')\r\nexport class HeroCollider extends Component {\r\n\r\n    _touchFireBallFire = false;\r\n    _isInsideObs = false;\r\n\r\n    start() {\r\n        this.openCollider();\r\n\r\n    }\r\n    openCollider() {\r\n        let collider = this.getComponent(BoxCollider2D);\r\n        if (!collider) collider = this.node.addComponent(BoxCollider2D);\r\n        let UIT = this.node.getComponent(UITransform);\r\n        let monsterSize = new Size(UIT.contentSize.x/2, UIT.contentSize.y);\r\n        collider.tag = tagData.hero;\r\n        collider.size = monsterSize;\r\n        collider.group = groupIndex.self;\r\n        collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        collider.on(Contact2DType.END_CONTACT, this.onEndContact, this);\r\n    }\r\n    onBeginContact(self: Collider2D, other: Collider2D) {\r\n        switch (other.tag) {\r\n            case tagData.fireBall:\r\n                this.fireBallAttackHero();\r\n                break;\r\n            case tagData.fireBallFire:\r\n                this._touchFireBallFire = true;\r\n                this.fireBallFireAttackHero();\r\n                break;\r\n            case tagData.obstacle:\r\n                this._isInsideObs = true;\r\n                em.dispatch(\"usingHeroControlFun\", \"changeMoveState\",false);\r\n                let fun = ()=>{\r\n                    if(this._isInsideObs) em.dispatch(\"usingHeroControlFun\", \"ejectFormObs\");\r\n                    else this.unschedule(fun);\r\n                }\r\n                this.schedule(fun,0.01);\r\n                break;\r\n            case tagData.randomSkillReward:\r\n                other.node.destroy();\r\n                em.dispatch(\"usingHeroControlFun\",\"selectUpgradeReward\");\r\n                break;\r\n            default:\r\n                let ignore = [tagData.boss, tagData.monster, tagData.enemySkill];//在其他碰撞脚本中已经做过处理 再此忽略\r\n                if (ignore.indexOf(other.tag) > -1) break;\r\n                throw new Error(\"未处理的碰撞开始：\" + self.tag + \"与\" + other.tag + \"发生碰撞\");\r\n        }\r\n    }\r\n\r\n    onEndContact(self: Collider2D, other: Collider2D) {\r\n        switch (other.tag) {\r\n            case tagData.fireBallFire:\r\n                this._touchFireBallFire = false;\r\n                break;\r\n            case tagData.obstacle:\r\n                console.log(\"碰撞障碍物 未处理\");\r\n                this._isInsideObs = false;\r\n                em.dispatch(\"usingHeroControlFun\", \"changeMoveState\",true);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    // 火球攻击玩家\r\n    fireBallAttackHero() {\r\n        if (ggd.stopAll) return;\r\n        let damage = 10;\r\n        em.dispatch(\"usingHeroControlFun\", \"createBossDamageTex\", -damage);\r\n    }\r\n    //火球爆炸后的火攻击玩家\r\n    fireBallFireAttackHero() {\r\n        if (ggd.stopAll) return;\r\n        if (!this._touchFireBallFire) return;\r\n        let damage = 8;\r\n        em.dispatch(\"usingHeroControlFun\", \"createBossDamageTex\", -damage);\r\n        let attackInterval = 0.5;\r\n        this.scheduleOnce(() => {\r\n            this.fireBallFireAttackHero();\r\n        }, attackInterval);\r\n    }\r\n\r\n\r\n}\r\n\r\n"]}