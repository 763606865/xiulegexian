{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/mainMenu/TrainingLayer.ts"],"names":["_decorator","Component","Node","find","tween","Vec3","JsonAsset","Prefab","Label","Sprite","NodePool","Animation","Color","Tween","em","glf","plm","LevelManager","ccclass","property","TrainingLayer","_itemPrefabArr","_trainingLvList","_rotationSpeed","_pillList","_isUpgrading","_curTrainingExp","_curTrainingLv","_TIM","onLoad","node","trainingLvListJson","json","addPoolToPools","pillPrefab","tipsTexPool","tipsPrefab","onEnable","guideData","dispatch","startTrainingLayerGuide","updatePillsContent","console","log","length","prefab","shift","putToPool","pillList","count","id","Object","prototype","hasOwnProperty","call","total","pill","getFromPool","parent","pillPar","data","getChildByName","getComponent","string","name","sprite","loadUrl","assets","spriteFrame","createButton","push","nothingLabel","active","start","initTrainingLv","curLv","exp","curExp","obj","addExp","updateProgressView","savingTrainingData","onBtnUsingPill","e","p","warn","createTipsTex","guideFinger","startGuideUpgrade","nextLvExp","curLvExp","par","trainingBonusLabelPar","expProgressDescription","expProgress","fillRange","trainingLv","blood","damage","moveSpeed","onBtnUpgrade","isCanUpgrade","playUpgradeAnim","level","anim","play","afterPlayUpgradeAnim","content","initPos","x","y","tex","setPosition","playTIPSTeXEffect","color","a1","by","position","onUpdate","target","ratio","lerp","r","g","b","a2","to","scale","action","parallel","setScale","guideTips","tips","item","stopAllByTag","guide","sequence","repeatForever","tag","btn"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, find, tween, Vec3, JsonAsset, Prefab, instantiate, Label, Sprite, NodePool, Animation, Color, Tween } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nimport { glf } from '../global/globalFun';\r\nimport { plm } from '../global/PoolManager';\r\nimport { LevelManager } from '../system/LevelManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('TrainingLayer')\r\nexport class TrainingLayer extends Component {\r\n    @property(JsonAsset)\r\n    trainingLvListJson;\r\n    @property(Prefab)\r\n    pillPrefab;\r\n    @property(Node)\r\n    pillPar;\r\n    @property(Sprite)\r\n    expProgress;\r\n    @property(Label)\r\n    expProgressDescription;\r\n    @property(Label)\r\n    trainingLv;\r\n    @property(Node)\r\n    trainingBonusLabelPar;\r\n    @property(Prefab)\r\n    tipsPrefab;\r\n    @property(Node)\r\n    nothingLabel;\r\n    @property(Node)\r\n    guideFinger;\r\n\r\n    _itemPrefabArr: Node[] = [];\r\n    _trainingLvList;\r\n    _rotationSpeed: number = 100;\r\n    _pillList: Node;\r\n    _isUpgrading: boolean = false;\r\n\r\n    _curTrainingExp: number;\r\n    _curTrainingLv: number;\r\n\r\n    _TIM: LevelManager;\r\n    onLoad() {\r\n\r\n        this._pillList = find(\"pillList\", this.node);\r\n        this._trainingLvList = this.trainingLvListJson.json;\r\n        // console.log(\"list\", this._trainingLvList);\r\n        plm.addPoolToPools(\"TLPillPrefab\", new NodePool(), this.pillPrefab);\r\n        let tipsTexPool = new NodePool();\r\n        plm.addPoolToPools(\"tipsTex\", tipsTexPool, this.tipsPrefab);\r\n    }\r\n    onEnable() {\r\n        let guideData = em.dispatch(\"getGuideData\");\r\n        if (!guideData.TrainingLayer) {\r\n            this.startTrainingLayerGuide();\r\n        }\r\n        this.updatePillsContent();\r\n    }\r\n    // 刷新药物列表\r\n    updatePillsContent() {\r\n        console.log(\"updatePillsContent\");\r\n        while (this._itemPrefabArr.length > 0) {\r\n            let prefab = this._itemPrefabArr.shift();\r\n            plm.putToPool(\"TLPillPrefab\", prefab);\r\n        }\r\n        let pillList = em.dispatch(\"getAllPills\");\r\n        let count = 0;\r\n        for (const id in pillList) {\r\n            if (Object.prototype.hasOwnProperty.call(pillList, id)) {\r\n                const total = pillList[id];\r\n                // let pill = instantiate(this.pillPrefab);\r\n                let pill = plm.getFromPool(\"TLPillPrefab\");\r\n                pill.parent = this.pillPar;\r\n                let data = em.dispatch(\"getItemDataByIdOrName\", id);\r\n                pill.getChildByName(\"name\").getComponent(Label).string = data.name;\r\n                pill.getChildByName(\"total\").getComponent(Label).string = total;\r\n                let sprite = pill.getChildByName(\"sprite\").getComponent(Sprite);\r\n                let loadUrl = \"images/items/\" + data.loadUrl + \"/spriteFrame\";\r\n                em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => sprite.spriteFrame = assets);\r\n                glf.createButton(this.node, pill, \"TrainingLayer\", \"onBtnUsingPill\", data.name);\r\n                this._itemPrefabArr.push(pill);\r\n                count++;\r\n            }\r\n        }\r\n        if (count == 0) {\r\n            this.nothingLabel.active = true;\r\n        } else {\r\n            this.nothingLabel.active = false;\r\n        }\r\n    }\r\n    start() {\r\n        this.initTrainingLv();\r\n    }\r\n    // 初始化修行等级\r\n    initTrainingLv() {\r\n        let data = em.dispatch(\"getTempData\", \"training\");//读取缓存\r\n        if (null === data) {\r\n            this._curTrainingExp = 0;\r\n            this._curTrainingLv = 0;\r\n        } else {\r\n            this._curTrainingLv = data.curLv;\r\n            let exp = this._curTrainingLv > 0 ? this._trainingLvList[this._curTrainingLv - 1].exp : 0;\r\n            this._curTrainingExp = data.curExp >= exp ? data.curExp : exp;\r\n            console.log(\"读取列表 配置修为 还没写\");\r\n        }\r\n        let obj = {\r\n            \"level\": 0,\r\n            \"maxLevel\": this._trainingLvList.length - 1,\r\n            \"curExp\": 0,\r\n            \"levelMappingExpList\": this._trainingLvList,\r\n        };\r\n        this._TIM = new LevelManager(obj);\r\n        this._TIM.addExp(this._curTrainingExp);\r\n        // console.log(\"_TIM\",this._TIM);\r\n        this.updateProgressView();\r\n        this.savingTrainingData();\r\n    }\r\n    // 记录修行数据\r\n    savingTrainingData() {\r\n        let data = {\r\n            \"curExp\": this._curTrainingExp,\r\n            \"curLv\": this._curTrainingLv\r\n        }\r\n        em.dispatch(\"savingToTempData\", \"training\", data);\r\n    }\r\n    //使用丹药\r\n    onBtnUsingPill(e, p) {\r\n        em.dispatch(\"playOneShot\", \"common/吃药\");\r\n        em.dispatch(\"reduceItemFromSS\", p, 1);//使用丹药\r\n        this.updatePillsContent();\r\n        let exp: number;\r\n        switch (p) {\r\n            case \"炼气丹\":\r\n                exp = 1;\r\n                break;\r\n            case \"筑基丹\":\r\n                exp = 10;\r\n                break;\r\n            case \"金元丹\":\r\n                exp = 200;\r\n                break;\r\n            case \"元婴丹\":\r\n                exp = 4000;\r\n                break;\r\n            case \"化神丹\":\r\n                exp = 80000;\r\n                break;\r\n\r\n            default:\r\n                exp = 0;\r\n                console.warn(\"尚未添加丹药\" + p + \"的经验值\");\r\n                break;\r\n        }\r\n        this._TIM.addExp(exp);\r\n        this._curTrainingExp = this._TIM.curExp;\r\n        // em.dispatch(\"tipsViewShow\", \"修为+\" + exp);\r\n        this.createTipsTex(\"修为+\" + exp);\r\n        this.updateProgressView();\r\n        this.savingTrainingData();\r\n\r\n\r\n        this.guideFinger.active = false;\r\n        if (!em.dispatch(\"getGuideData\").TrainingLayer) {\r\n            this.startGuideUpgrade();\r\n        }\r\n\r\n\r\n    }\r\n    updateProgressView() {\r\n        // 获取到下一级的经验\r\n        // let nextLvExp = this._trainingLvList[this._curTrainingLv+1].exp;\r\n        let nextLvExp = this._trainingLvList[this._curTrainingLv].exp;\r\n        let curLvExp = this._curTrainingLv > 0 ? this._trainingLvList[this._curTrainingLv - 1].exp : 0;\r\n        console.log(\"nextLvExp\", nextLvExp);\r\n        console.log(\"curLvExp\", curLvExp);\r\n        console.log(\"this._curTrainingExp\", this._curTrainingExp);\r\n        console.log(\"this._curTrainingExp - curLvExp\", this._curTrainingExp - curLvExp);\r\n\r\n        let string = (this._curTrainingExp - curLvExp) + \"/\" + (nextLvExp - curLvExp);\r\n        let data = this._trainingLvList[this._curTrainingLv];\r\n        let par = this.trainingBonusLabelPar;\r\n        this.expProgressDescription.string = string;\r\n        this.expProgress.fillRange = (this._curTrainingExp - curLvExp) / (nextLvExp - curLvExp);\r\n        this.trainingLv.string = data.name;\r\n        find(\"Canvas/menuLayer/title/heroBaseInfoBg/curLv\").getComponent(Label).string = data.name;\r\n        par.getChildByName(\"l1\").getComponent(Label).string = \"血量加成：\" + data.blood;\r\n        par.getChildByName(\"l2\").getComponent(Label).string = \"伤害加成：\" + data.damage;\r\n        par.getChildByName(\"l3\").getComponent(Label).string = \"移速加成：\" + data.moveSpeed;\r\n    }\r\n    onBtnUpgrade() {\r\n        if (this._isUpgrading) {\r\n            em.dispatch(\"tipsViewShow\", \"突破中...\");\r\n            return;\r\n        }\r\n        if (!this.isCanUpgrade()) {\r\n            em.dispatch(\"tipsViewShow\", \"当前状态无法突破。\");\r\n            return;\r\n        }\r\n        this.guideFinger.active = false;\r\n        this._isUpgrading = true;\r\n        this._curTrainingLv++;\r\n        this.playUpgradeAnim();\r\n        this.savingTrainingData();\r\n\r\n\r\n    }\r\n    // 是否能够升级\r\n    isCanUpgrade() {\r\n        return this._TIM.level > this._curTrainingLv;\r\n    }\r\n    playUpgradeAnim() {\r\n        console.log(\"播放突破动画\");\r\n        em.dispatch(\"playOneShot\", \"common/突破\");\r\n        let anim = find(\"training/animPar\", this.node).getComponent(Animation);\r\n        anim.play();\r\n    }\r\n    //播放完突破动画 恢复可突破状态\r\n    afterPlayUpgradeAnim() {\r\n        this._isUpgrading = false;\r\n        this.updateProgressView();\r\n        console.log(\"TrainingLayer\",em.dispatch(\"getGuideData\", \"TrainingLayer\"));\r\n        \r\n        if (!em.dispatch(\"getGuideData\").TrainingLayer) {\r\n            em.dispatch(\"setGuideData\", \"TrainingLayer\", true);\r\n            em.dispatch(\"initMainMenuByGuideData\");\r\n        }\r\n    }\r\n\r\n\r\n    //=================创建提示信息===============\r\n    createTipsTex(content: string, initPos = { x: 0, y: 100 }) {\r\n        let tex = plm.getFromPool(\"tipsTex\");\r\n        tex.getComponent(Label).string = content;\r\n        tex.parent = find(\"Canvas/menuLayer/TrainingLayer/tipsPar\");\r\n        tex.setPosition(initPos.x, initPos.y, 0);\r\n        this.playTIPSTeXEffect(tex);\r\n    }\r\n    playTIPSTeXEffect(tex, color = new Color(255, 255, 255, 255)) {\r\n        let a1 = tween().by(1, { position: new Vec3(0, 200, 0) }, {\r\n            onUpdate: (target, ratio) => {\r\n                // if(ratio>0.5) tex.getComponent(Label).color = Color.lerp(new Color(), color, new Color(color.r, color.g, color.b, 0), (ratio -0.5)*2);\r\n                tex.getComponent(Label).color = Color.lerp(new Color(), color, new Color(color.r, color.g, color.b, 0), ratio);\r\n            }\r\n        });\r\n        let a2 = tween().to(0.5, { scale: new Vec3(1.2, 1.2, 1) });\r\n        let action = tween(tex).parallel(a1, a2)\r\n            .call(() => {\r\n                tex.setScale(new Vec3(1, 1, 1));\r\n                plm.putToPool(\"tipsTex\", tex, true);\r\n            });\r\n        action.start();\r\n    }\r\n    startTrainingLayerGuide() {\r\n        let guideTips = \"点击使用丹药，提升修为。当人物全身金黄时，说明修为已满，可以通过突破提升境界。越高阶的丹药提升的修为越高。丹药可以通过炼制丹药获取。\";\r\n        em.dispatch(\"openGuideTips\", guideTips);\r\n        find(\"Canvas/menuLayer/guideFinger\").active = false;\r\n        em.dispatch(\"addItemToSS\", \"炼气丹\", 1);\r\n        let tips = \"获得物品炼气丹x1\";\r\n        em.dispatch(\"tipsViewShow\", tips);\r\n        this.updatePillsContent();\r\n        let item = this._itemPrefabArr.length > 0 ? this._itemPrefabArr[0] : null;\r\n        if (item) {\r\n            Tween.stopAllByTag(3);\r\n            let guide = this.guideFinger;\r\n            guide.active = true;\r\n            guide.parent = item;\r\n            guide.setPosition(0, 150, 0);\r\n            let a1 = tween().by(0.5, { position: new Vec3(0, -100, 0) });\r\n            let a2 = tween().by(0.5, { position: new Vec3(0, 100, 0) });\r\n            let action = tween(guide).sequence(a1, a2);\r\n            action = tween(guide).repeatForever(action);\r\n            action.tag(3);\r\n            action.start();\r\n        };\r\n    }\r\n    startGuideUpgrade() {\r\n        let btn = find(\"Canvas/menuLayer/TrainingLayer/training/upgrade\");\r\n        if (btn) {\r\n            Tween.stopAllByTag(3);\r\n            let guide = this.guideFinger;\r\n            guide.active = true;\r\n            guide.parent = btn;\r\n            guide.setPosition(0, 150, 0);\r\n            let a1 = tween().by(0.5, { position: new Vec3(0, -100, 0) });\r\n            let a2 = tween().by(0.5, { position: new Vec3(0, 100, 0) });\r\n            let action = tween(guide).sequence(a1, a2);\r\n            action = tween(guide).repeatForever(action);\r\n            action.tag(3);\r\n            action.start();\r\n        };\r\n    }\r\n}\r\n\r\n"]}