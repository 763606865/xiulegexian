{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/enemy/boss/Boss5.ts"],"names":["_decorator","Prefab","Animation","find","NodePool","em","ggd","plm","Boss","ccclass","property","Boss5","_skillData","_photosynthesisTimes","onLoad","bossData","dispatch","canMove","normalDamage","normalParticle","damage","addPoolToPools","skillPrefab","initBossInfo","setBossStrategy","usingSkillGreenThunder","gt","getFromPool","getComponent","init","hwp","parent","setWorldPosition","x","y","usingSkillPhotosynthesis","t","console","log","node","getChildByName","active","unschedule","recoveryHealthy","schedule","scheduleOnce","updateBlood","bossAttackHeroByCollider","self","other","stopAll","_isTouchHero","usingNormalAttack","_curSpeed","_rawSpeed","bwp","getWorldPosition","unitDis","angle","offset","xScale","Math","abs","attack","setPosition","setScale","anim","play","usingSkillGreenThunderAllTheTime","usingNormalParticleOneShot","isUsingSkillPhotosynthesis","isAccelerateToHero","percentage","getBloodPercentage","dis","getDistanceToHero","accelerateToHero"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-08-11 09:52:21\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-12-14 11:48:24\r\n * @FilePath: \\to-be-immortal\\assets\\script\\enemy\\boss\\Boss1.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\n//需要添加两个最终技能 1 藤蔓（控制） 2 高伤害技能\r\nimport { _decorator, Component, Node, Size, UITransform, Prefab, instantiate, Vec2, tween, Vec3, Material, Animation, Sprite, find, BoxCollider2D, math, NodePool } from 'cc';\r\nimport { em } from '../../global/EventManager';\r\nimport { ggd, groupIndex, tagData } from '../../global/globalData';\r\nimport { plm } from '../../global/PoolManager';\r\nimport { Boss } from './Boss';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Boss5')\r\nexport class Boss5 extends Boss {\r\n    @property(Prefab)\r\n    skillPrefab;\r\n\r\n    _skillData = {\r\n        \"1\": 15,//绿色闪电\r\n        \"2\": 300,//加速\r\n        \"3\": 500,//回血量\r\n        \"4\": 50,//普通攻击\r\n        \"normalParticle\": {\r\n            \"name\": \"normalParticle\",\r\n            \"damage\": 200,\r\n            \"duration\": 3,\r\n            \"moveSpeed\": 300,\r\n            \"canAttackTimes\":1,\r\n        },\r\n    }\r\n\r\n    _photosynthesisTimes = 2;//光合作用可使用次数\r\n    onLoad() {\r\n        let bossData = em.dispatch(\"usingHeroBasePropertyFun\", \"getBossDataById\", 5);\r\n        bossData.canMove = true;\r\n        this._skillData[4] = bossData.normalDamage;\r\n        this._skillData.normalParticle.damage = bossData.normalDamage;\r\n        plm.addPoolToPools(\"greenThunder\", new NodePool(), this.skillPrefab);\r\n        this.initBossInfo(bossData);\r\n        // 连续多道闪电\r\n        // this.usingSkillGreenThunderAllTheTime(3);\r\n        // this.scheduleOnce(this.usingSkillPhotosynthesis, 5);\r\n        this.setBossStrategy();\r\n    }\r\n\r\n    //==============boss技能当前=====================\r\n\r\n\r\n    // 绿色闪电\r\n    usingSkillGreenThunder() {\r\n        let gt = plm.getFromPool(\"greenThunder\");\r\n        gt.getComponent(\"GreenThunder\").init(this._skillData[1]);\r\n        let hwp = em.dispatch(\"getHeroWorldPos\");\r\n        gt.parent = find(\"Canvas/bulletLayer\");\r\n        gt.setWorldPosition(hwp.x, hwp.y + 100, hwp.y);\r\n    }\r\n    // 光合作用\r\n    usingSkillPhotosynthesis(t) {\r\n        console.log(\"开启光合作用\");\r\n        this._photosynthesisTimes--;\r\n        if (this._photosynthesisTimes < 0) return;\r\n        this.node.getChildByName(\"photosynthesis\").active = true;\r\n        this.unschedule(this.recoveryHealthy);\r\n        this.schedule(this.recoveryHealthy, 1, t);\r\n        this.scheduleOnce(() => {\r\n            this.node.getChildByName(\"photosynthesis\").active = false;\r\n        }, t);\r\n    }\r\n    recoveryHealthy() {\r\n        this.updateBlood(this._skillData[3]);\r\n    }\r\n\r\n    //重写\r\n    bossAttackHeroByCollider(self, other) {\r\n        if (ggd.stopAll) return;\r\n        if (!this._isTouchHero) return;\r\n        em.dispatch(\"usingHeroControlFun\", \"createBossDamageTex\", -this._skillData[4]);\r\n        this.usingNormalAttack();\r\n        let t: number = 2;\r\n        this.scheduleOnce(() => {\r\n            this.bossAttackHeroByCollider(self, other);\r\n        }, t);\r\n\r\n    }\r\n    // 普通攻击\r\n    usingNormalAttack() {\r\n        this._curSpeed = this._rawSpeed;\r\n        let hwp = em.dispatch(\"getHeroWorldPos\");\r\n        let bwp = this.node.getWorldPosition();\r\n        let x = hwp.x - bwp.x;\r\n        let y = hwp.y - bwp.y;\r\n        let unitDis = 50;\r\n        let angle = 0;\r\n        let offset = { x: unitDis, y: 0 }\r\n        let xScale = 1;\r\n        if (Math.abs(x) > Math.abs(y)) {\r\n            if (x < 0) {\r\n                angle = 180;\r\n                offset.x = -unitDis;\r\n                xScale = -1;\r\n            }\r\n        } else {\r\n            if (y > 0) {\r\n                angle = 90;\r\n                offset.x = 0;\r\n                offset.y = unitDis;\r\n            }\r\n            else {\r\n                angle = 270;\r\n                offset.x = 0;\r\n                offset.y = -unitDis;\r\n            }\r\n        }\r\n        let attack = this.node.getChildByName(\"attack\");\r\n        attack.angle = angle;\r\n        attack.setPosition(offset.x, offset.y);\r\n        attack.setScale(1, xScale);\r\n        let anim = attack.getComponent(Animation);\r\n        anim.play();\r\n    }\r\n    //一直释放闪电\r\n    usingSkillGreenThunderAllTheTime(t) {\r\n        this.schedule(() => {\r\n            this.usingSkillGreenThunder();\r\n        }, t);\r\n    }\r\n\r\n    /**\r\n     * @description:设置boss 攻击策略\r\n     * @Strategy1 每隔5s释放一次闪电\r\n     * @Strategy2 血量低于1/3 时 释放一次 cd30s 持续回血15s 每秒恢复200\r\n     * @Strategy3 距离超过2000px 自动使用\r\n     */\r\n    setBossStrategy() {\r\n        this.schedule(()=>{\r\n            this.usingNormalParticleOneShot(0.4);\r\n        }, 1);\r\n        this.usingSkillGreenThunderAllTheTime(5);\r\n        this.schedule(this.isUsingSkillPhotosynthesis, 1);\r\n        this.schedule(this.isAccelerateToHero, 1);\r\n    }\r\n    //是否开启光合作用\r\n    isUsingSkillPhotosynthesis() {\r\n        let percentage = this.getBloodPercentage();\r\n        if (percentage < 0.33) {\r\n            this.usingSkillPhotosynthesis(15);\r\n            this.unschedule(this.isUsingSkillPhotosynthesis);\r\n            this.scheduleOnce(() => {\r\n                this.schedule(this.isUsingSkillPhotosynthesis, 1);\r\n            }, 30);\r\n        }\r\n    }\r\n    //是否加速冲向玩家\r\n    isAccelerateToHero() {\r\n        let dis = this.getDistanceToHero();\r\n        if (dis > 2000) {\r\n            this._curSpeed = this._skillData[2];\r\n            let t = dis / this._curSpeed;\r\n            this.accelerateToHero(t);\r\n        }\r\n    }\r\n    // pauseAnim(){\r\n    //     this.node.getChildByName(\"sprite\").getComponent(Animation).stop();\r\n    // }\r\n    // resumeAnim() {\r\n    //     this.node.getChildByName(\"sprite\").getComponent(Animation).resume();\r\n    // }\r\n}\r\n\r\n"]}