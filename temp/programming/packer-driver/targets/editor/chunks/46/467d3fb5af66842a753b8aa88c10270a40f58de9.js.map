{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/TSGFDemo/Demo/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/mainMenu/SkillBookLayer.ts"],"names":["_decorator","Component","Node","find","instantiate","Label","Sprite","Color","NodePool","UITransform","SpriteFrame","Animation","Tween","tween","Vec3","em","glf","plm","ccclass","property","SkillBookLayer","_loadingList","_skillBookClass","_skillBook","_bookContent","_curSelectBook","_finishBookList","_bookPrefabList","_usingBookList","_guideRewardBookName","_guideRewardBookType","onLoad","prefab","node","addPoolToPools","onEnable","dispatch","startSkillBookLayerGuide","updateBookListView","start","dynamicLoadPrefabs","initData","initUsingBook","all","finishBookList","usingBookList","dir1","dir2","assets","initBookListView","isCompleteLoading","list","getSkillBookClassList","key","Object","prototype","hasOwnProperty","call","arr","bookClass","parent","getChildByName","getComponent","spriteFrame","typeSFs","forEach","data","book","loadUrl","name2","indexOf","name","skillBg","color","anim","scheduleOnce","play","string","createButton","total","Math","ceil","length","height","contentSize","y","setContentSize","width","console","log","stopAllByTag","guide","guideFinger","active","setPosition","a1","by","position","a2","action","sequence","repeatForever","tag","isEnd","type","push","onBtnShowBookDetail","e","p","label","lv","description","closeBookDetail","onBtnStudyBook","flag","stop","savingFinishBookData","startGuideSetSkill","skillName","sprite","onBtnSwitchBook","initSwitchBook","par","bookName","getFromPool","switchBook","ps","split","closeSwitchBook","children","child","removeFromParent","putToPool","guideTips","random","tips"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-09-19 14:16:09\r\n * @LastEditors: li_jiang_wei 739671694@qq.com\r\n * @LastEditTime: 2022-12-12 00:19:12\r\n * @FilePath: \\to-be-immortal\\assets\\script\\mainMenu\\SkillBookLayer.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, Prefab, find, instantiate, Label, Sprite, Color, NodePool, UITransform, ColorKey, SpriteFrame, Animation, Tween, tween, Vec3 } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nimport { glf } from '../global/globalFun';\r\nimport { plm } from '../global/PoolManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('SkillBookLayer')\r\nexport class SkillBookLayer extends Component {\r\n    @property([SpriteFrame])\r\n    typeSFs;\r\n    @property(Node)\r\n    guideFinger;\r\n    @property([SpriteFrame])\r\n    skillBg = [];\r\n\r\n\r\n    _loadingList = {\r\n        _skillBookClass: false,\r\n        _skillBook: false,\r\n    }\r\n    _skillBookClass: Prefab;\r\n    _skillBook: Prefab;\r\n    _bookContent: Node;\r\n    _curSelectBook: string;\r\n    _finishBookList = [];\r\n    _bookPrefabList = {};\r\n    _usingBookList = {\r\n        \"身法\": \"\",\r\n        \"心法\": \"\",\r\n        \"武技\": \"\",\r\n        \"绝技\": \"\",\r\n        \"神通\": \"\",\r\n    };\r\n\r\n    _guideRewardBookName: string;\r\n    _guideRewardBookType: string;\r\n    onLoad() {\r\n        let prefab = find(\"switchBook/bookPrefab\", this.node);\r\n        plm.addPoolToPools(\"SBLBookPrefab\", new NodePool(), prefab);\r\n        this._bookContent = find(\"ScrollView/view/content\", this.node);\r\n    }\r\n    onEnable() {\r\n        if (!em.dispatch(\"getGuideData\").SkillBookLayer) {\r\n            this.startSkillBookLayerGuide();\r\n        }\r\n        this.updateBookListView();\r\n    }\r\n    start() {\r\n        this.dynamicLoadPrefabs();\r\n        this.initData();\r\n        this.initUsingBook();\r\n\r\n    }\r\n    // 初始化数据\r\n    initData() {\r\n        let all = em.dispatch(\"getTempData\", \"SkillBookLayer\");\r\n        if (all) {\r\n            this._finishBookList = all.finishBookList;\r\n            this._usingBookList = all.usingBookList;\r\n        };\r\n    }\r\n    // 动态加载预制件 注：或许需要添加loading...\r\n    dynamicLoadPrefabs() {\r\n        let dir1 = \"prefabs/mainMenu/skillBookClass\";\r\n        let dir2 = \"prefabs/mainMenu/skillBook\";\r\n        em.dispatch(\"loadTheDirResources\", dir1, (assets) => {\r\n            this._skillBookClass = assets;\r\n            this._loadingList._skillBookClass = true;\r\n            this.initBookListView();\r\n        });\r\n        em.dispatch(\"loadTheDirResources\", dir2, (assets) => {\r\n            this._skillBook = assets;\r\n            this._loadingList._skillBook = true;\r\n            this.initBookListView();\r\n        });\r\n    }\r\n    //初始化秘籍列表显示\r\n    initBookListView() {\r\n        if (!this.isCompleteLoading()) return;\r\n        let list = this.getSkillBookClassList();\r\n        for (const key in list) {\r\n            if (Object.prototype.hasOwnProperty.call(list, key)) {\r\n                const arr = list[key];\r\n                let bookClass = instantiate(this._skillBookClass);\r\n                bookClass.parent = this._bookContent;\r\n                // bookClass.getChildByName(\"Label\").getComponent(Label).string = key;\r\n                switch (key) {\r\n                    case \"绝技\":\r\n                        bookClass.getChildByName(\"type\").getComponent(Sprite).spriteFrame = this.typeSFs[0];\r\n                        break;\r\n                    case \"秘法\":\r\n                        bookClass.getChildByName(\"type\").getComponent(Sprite).spriteFrame = this.typeSFs[1];\r\n                        break;\r\n                    case \"身法\":\r\n                        bookClass.getChildByName(\"type\").getComponent(Sprite).spriteFrame = this.typeSFs[2];\r\n                        break;\r\n                    case \"神通\":\r\n                        bookClass.getChildByName(\"type\").getComponent(Sprite).spriteFrame = this.typeSFs[3];\r\n                        break;\r\n                    case \"武技\":\r\n                        bookClass.getChildByName(\"type\").getComponent(Sprite).spriteFrame = this.typeSFs[4];\r\n                        break;\r\n                    case \"心法\":\r\n                        bookClass.getChildByName(\"type\").getComponent(Sprite).spriteFrame = this.typeSFs[5];\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n\r\n                arr.forEach(data => {\r\n                    let book = instantiate(this._skillBook);\r\n                    let loadUrl = \"images/icons/icon_\" + data.name2 + \"/spriteFrame\";\r\n                    em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => book.getChildByName(\"Sprite\").getComponent(Sprite).spriteFrame = assets);\r\n                    if (this._finishBookList.indexOf(data.name) < 0) {//未学习的功法\r\n                        book.getComponent(Sprite).spriteFrame = this.skillBg[0];\r\n                        book.getChildByName(\"Label\").getComponent(Label).color = new Color(30, 30, 30, 255);\r\n                        // book.getChildByName(\"Label\").getComponent(Label).color = new Color(255, 255, 255, 255);\r\n                        if (em.dispatch(\"getItemTotalByIdOrName\", data.name) > 0) {\r\n                            let anim = book.getComponent(Animation);\r\n                            this.scheduleOnce(() => {\r\n                                anim.play();\r\n                            }, 0);\r\n                        }\r\n                    } else {\r\n                        book.getComponent(Sprite).spriteFrame = this.skillBg[1];\r\n                        // book.getChildByName(\"Label\").getComponent(Label).color = new Color(255, 204, 0, 255);\r\n                        book.getChildByName(\"Label\").getComponent(Label).color = new Color(255, 255, 255, 255);\r\n                        //判断功法是否可以学习 可以学习且没有学的情况下播放动画\r\n                    }\r\n                    book.getChildByName(\"Label\").getComponent(Label).string = data.name;\r\n                    book.parent = find(\"/type/content\", bookClass);\r\n                    glf.createButton(this.node, book, \"SkillBookLayer\", \"onBtnShowBookDetail\", data.name);\r\n                    this._bookPrefabList[data.name] = book;\r\n                });\r\n                // let total = Math.ceil(arr.length / 4);//4为适配结果，具体根据效果展示\r\n                let total = Math.ceil(arr.length/5);//5为适配结果，具体根据效果展示\r\n                // let height = find(\"/type/content\", bookClass).getComponent(UITransform).contentSize.y * total + find(\"/type\", bookClass).getComponent(UITransform).contentSize.y;\r\n                let height = 280 * total + find(\"/type\", bookClass).getComponent(UITransform).contentSize.y;//120 skillBook 预制件的高度\r\n                bookClass.getComponent(UITransform).setContentSize(bookClass.getComponent(UITransform).contentSize.width, height);\r\n                console.log(\"height\", height);\r\n                console.log(\"contentSize.y\", find(\"/type/content\", bookClass).getComponent(UITransform).contentSize.y);\r\n            }\r\n        }\r\n        if (!em.dispatch(\"getGuideData\").SkillBookLayer) {\r\n            let book = this._bookPrefabList[this._guideRewardBookName];\r\n            Tween.stopAllByTag(4);\r\n            let guide = this.guideFinger;\r\n            guide.active = true;\r\n            guide.parent = book;\r\n            guide.setPosition(0, 150, 0);\r\n            let a1 = tween().by(0.5, { position: new Vec3(0, -100, 0) });\r\n            let a2 = tween().by(0.5, { position: new Vec3(0, 100, 0) });\r\n            let action = tween(guide).sequence(a1, a2);\r\n            action = tween(guide).repeatForever(action);\r\n            action.tag(4);\r\n            action.start();\r\n        }\r\n    }\r\n    // 刷新秘籍列表显示\r\n    updateBookListView() {\r\n        for (const key in this._bookPrefabList) {\r\n            if (Object.prototype.hasOwnProperty.call(this._bookPrefabList, key)) {\r\n                const book = this._bookPrefabList[key];\r\n                if (em.dispatch(\"getItemTotalByIdOrName\", key) > 0 && this._finishBookList.indexOf(key) < 0) {\r\n                    let anim = book.getComponent(Animation);\r\n                    anim.play();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // 是否完成加载\r\n    isCompleteLoading() {\r\n        for (const key in this._loadingList) {\r\n            if (Object.prototype.hasOwnProperty.call(this._loadingList, key)) {\r\n                const isEnd = this._loadingList[key];\r\n                if (!isEnd) return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    /**\r\n     * @description: 对获取的功法秘籍进行分类\r\n     * @returns {object} 返回分类结果\r\n     */\r\n    getSkillBookClassList() {\r\n        let all = em.dispatch(\"usingHeroBasePropertyFun\", \"getAllAboutSkillBook\");\r\n        // console.log(\"all\", all);\r\n        let list = {};\r\n        all.forEach(book => {\r\n            if (list.hasOwnProperty(book.type)) {\r\n                list[book.type].push(book);\r\n            } else {\r\n                list[book.type] = [book];\r\n            }\r\n        });\r\n        return list;\r\n    }\r\n    //显示功法秘籍详情\r\n    onBtnShowBookDetail(e, p) {\r\n        let node = find(\"bookDetail\", this.node);\r\n        let label = find(\"/bookDetail/study/Label\", this.node).getComponent(Label);\r\n        label.string = \"领悟\";\r\n        node.active = true;\r\n        this._curSelectBook = p;\r\n        if (this._finishBookList.indexOf(this._curSelectBook) > -1) {\r\n            label.string = \"已掌握\";\r\n        }\r\n        let data = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", p);\r\n        console.log(\"onBtnShowBookDetail\", data);\r\n        node.getChildByName(\"bookName\").getComponent(Label).string = data.name + \"\\n\" + data.lv + \"阶功法\";\r\n        // node.getChildByName(\"bookDescription\").getComponent(Label).string = data.description + \"\\n\\n\" + data.description2;\r\n        node.getChildByName(\"bookDescription\").getComponent(Label).string = \"\\n\\n\" + data.description;\r\n    }\r\n    closeBookDetail() {\r\n        find(\"bookDetail\", this.node).active = false;\r\n    }\r\n    // 学习秘籍\r\n    onBtnStudyBook() {\r\n        //判断秘籍是否已经学习\r\n        if (this._finishBookList.indexOf(this._curSelectBook) > -1) {\r\n            // em.dispatch(\"tipsViewShow\", \"已掌握该功法\", 3);\r\n            return;\r\n        }\r\n        // let flag = true;\r\n        let flag = em.dispatch(\"reduceItemFromSS\", this._curSelectBook, 1);\r\n        if (flag) {\r\n            this._finishBookList.push(this._curSelectBook);\r\n            find(\"/bookDetail/study/Label\", this.node).getComponent(Label).string = \"已掌握\";\r\n            let book = this._bookPrefabList[this._curSelectBook];\r\n            let anim = book.getComponent(Animation);\r\n            anim.stop();\r\n            book.getComponent(Sprite).spriteFrame = this.skillBg[1];\r\n            // book.getChildByName(\"Label\").getComponent(Label).color = new Color(255, 204, 0, 255);\r\n            book.getChildByName(\"Label\").getComponent(Label).color = new Color(255, 255, 255, 255);\r\n            this.savingFinishBookData();\r\n            if (!em.dispatch(\"getGuideData\").SkillBookLayer) {\r\n                this.startGuideSetSkill();\r\n            }\r\n        } else {\r\n            em.dispatch(\"tipsViewShow\", \"缺少秘籍:\" + this._curSelectBook, 3);\r\n        }\r\n        console.log(this._finishBookList);\r\n    }\r\n    //记录已学习的功法\r\n    savingFinishBookData() {\r\n        let data = {\r\n            finishBookList: this._finishBookList,\r\n            usingBookList: this._usingBookList\r\n        }\r\n        em.dispatch(\"savingToTempData\", \"SkillBookLayer\", data);\r\n    }\r\n    // 初始化携带功法\r\n    initUsingBook() {\r\n        // let node = find(\"usingBook\",this.node);\r\n        for (const type in this._usingBookList) {\r\n            if (Object.prototype.hasOwnProperty.call(this._usingBookList, type)) {\r\n                const skillName = this._usingBookList[type];\r\n                if (\"\" !== skillName) {\r\n                    let sprite = find(\"usingBook/\" + type, this.node).getChildByName(\"sprite\").getComponent(Sprite);\r\n                    let loadUrl = \"images/icons/icon_\" + skillName + \"/spriteFrame\";\r\n                    em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => sprite.spriteFrame = assets);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    //点击切换携带功法按钮\r\n    onBtnSwitchBook(e, type) {\r\n        console.log(\"切换\" + type);\r\n        find(\"switchBook\", this.node).active = true;\r\n        find(\"switchBook/bg/title\", this.node).getComponent(Label).string = type;\r\n        // let list = this.getSkillBookClassList()[p];\r\n        this.initSwitchBook(type);\r\n    }\r\n    // 初始化切换秘籍界面\r\n    initSwitchBook(type) {\r\n        let par = find(\"switchBook/bg/content\", this.node);\r\n        this._finishBookList;\r\n        this._finishBookList.forEach(bookName => {\r\n            let data = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", bookName);\r\n            if (data.type == type) {\r\n                // console.log(data);\r\n                let prefab = plm.getFromPool(\"SBLBookPrefab\");\r\n                let sprite = prefab.getComponent(Sprite);\r\n                prefab.parent = par;\r\n                prefab.getChildByName(\"name\").getComponent(Label).string = data.name;\r\n                let loadUrl = \"images/icons/icon_\" + data.name2 + \"/spriteFrame\";\r\n                em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => sprite.spriteFrame = assets);\r\n                glf.createButton(this.node, prefab, \"SkillBookLayer\", \"switchBook\", type + \"@\" + data.name2);\r\n            };\r\n        });\r\n    }\r\n    // 切换携带功法\r\n    switchBook(e, p) {\r\n        console.log(\"p\", p);\r\n        if (!em.dispatch(\"getGuideData\").SkillBookLayer) {\r\n            this.guideFinger.active = false;\r\n            em.dispatch(\"setGuideData\", \"SkillBookLayer\", true);\r\n            em.dispatch(\"initMainMenuByGuideData\");\r\n        }\r\n        let ps = p.split(\"@\");\r\n        let type = ps[0];\r\n        let skillName = ps[1]\r\n        let sprite = find(\"usingBook/\" + type, this.node).getChildByName(\"sprite\").getComponent(Sprite);\r\n        let loadUrl = \"images/icons/icon_\" + skillName + \"/spriteFrame\";\r\n        em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => sprite.spriteFrame = assets);\r\n        this._usingBookList[type] = skillName;\r\n        console.log(\"this._usingBookList\", this._usingBookList);\r\n        this.closeSwitchBook();\r\n        this.savingFinishBookData();\r\n    }\r\n    closeSwitchBook() {\r\n        find(\"switchBook\", this.node).active = false;\r\n        let par = find(\"switchBook/bg/content\", this.node);\r\n        while (par.children.length) {\r\n            let child = par.children[0];\r\n            child.removeFromParent();\r\n            plm.putToPool(\"SBLBookPrefab\", child);\r\n        }\r\n    }\r\n    startSkillBookLayerGuide() {\r\n        let guideTips = \"首次进入，随机获取一本一阶功法（剑雨术、一剑隔世和万剑归冢）。每次进入功法界面，如果看到不断闪烁的功法，则表明此功法可以掌握，请赶快领悟并使用。\"\r\n        em.dispatch(\"openGuideTips\", guideTips);\r\n\r\n        find(\"Canvas/menuLayer/guideFinger\").active = false;\r\n        let random = Math.random();\r\n        let tips: string;\r\n        if (random > 0.7) {\r\n            em.dispatch(\"addItemToSS\", \"万剑归冢\", 1);\r\n            tips = \"获得一阶功法：万剑归冢x1\";\r\n            this._guideRewardBookName = \"万剑归冢\";\r\n            this._guideRewardBookType = \"神通\";\r\n\r\n        } else if (random > 0.3) {\r\n            em.dispatch(\"addItemToSS\", \"一剑隔世\", 1);\r\n            tips = \"获得一阶功法：一剑隔世x1\";\r\n            this._guideRewardBookName = \"一剑隔世\";\r\n            this._guideRewardBookType = \"绝技\";\r\n        } else {\r\n            em.dispatch(\"addItemToSS\", \"剑雨术\", 1);\r\n            tips = \"获得一阶功法：剑雨术x1\";\r\n            this._guideRewardBookName = \"剑雨术\"\r\n            this._guideRewardBookType = \"武技\";\r\n        }\r\n        em.dispatch(\"tipsViewShow\", tips);\r\n    }\r\n    // 开始引导设置技能\r\n    startGuideSetSkill() {\r\n        let par = find(\"Canvas/menuLayer/SkillBookLayer/usingBook/\" + this._guideRewardBookType);\r\n        Tween.stopAllByTag(4);\r\n        let guide = this.guideFinger;\r\n        guide.active = true;\r\n        guide.parent = par;\r\n        guide.setPosition(0, 150, 0);\r\n        let a1 = tween().by(0.5, { position: new Vec3(0, -100, 0) });\r\n        let a2 = tween().by(0.5, { position: new Vec3(0, 100, 0) });\r\n        let action = tween(guide).sequence(a1, a2);\r\n        action = tween(guide).repeatForever(action);\r\n        action.tag(4);\r\n        action.start();\r\n    }\r\n}\r\n\r\n"]}