{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/prefab/import/rewardLayer/PassRewardLayer.ts"],"names":["_decorator","Component","Node","Sprite","find","instantiate","Label","director","em","ggd","ccclass","property","PassRewardLayer","_prefab","_rContent","_killLeaderRewardConfig","_isPass","_notNoticeKillReward","onLoad","add","openLayer","bind","showKillLeaderReward","showPassReward","initNode","initLeaderRewardConfig","onDestroy","remove","node","onDisable","stopAll","parent","active","strengthType","index","Math","random","result","dispatch","all","string","isDouble","forEach","data","console","log","total","prefab","itemData","id","getChildByName","getComponent","name","sprite","loadUrl","assets","spriteFrame","descriptionLabel","killCountLabel","curStageLabel","curStage","doubleTips","closeLayer","enterMainMenu","loadScene","scheduleOnce","onBtnNotNotice"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-08-26 15:22:55\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-11-28 13:17:50\r\n * @FilePath: \\to-be-immortal\\assets\\prefab\\import\\rewardLayer\\PassRewardLayer.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, Sprite, find, SpriteFrame, instantiate, Label, director } from 'cc';\r\nimport { em } from '../../../script/global/EventManager';\r\nimport { ggd } from '../../../script/global/globalData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PassRewardLayer')\r\nexport class PassRewardLayer extends Component {\r\n    @property(Label)\r\n    descriptionLabel;\r\n    @property(Label)\r\n    killCountLabel;\r\n    @property(Label)\r\n    curStageLabel;\r\n    @property(Node)\r\n    doubleTips;\r\n\r\n\r\n    _prefab: Node = null;\r\n    _rContent: Node = null;\r\n    _killLeaderRewardConfig;\r\n    _isPass: boolean = false;\r\n    _notNoticeKillReward: boolean = false;//不在提示击杀击杀精英怪奖励\r\n    onLoad() {\r\n        em.add(\"openRewardLayer\", this.openLayer.bind(this));\r\n        em.add(\"showKillLeaderReward\", this.showKillLeaderReward.bind(this));\r\n        em.add(\"showPassReward\", this.showPassReward.bind(this));\r\n        this.initNode();\r\n        this.initLeaderRewardConfig();\r\n    }\r\n    onDestroy() {\r\n        em.remove(\"openRewardLayer\");\r\n        em.remove(\"showKillLeaderReward\");\r\n        em.remove(\"showPassReward\");\r\n    }\r\n    initNode() {\r\n        this._prefab = find(\"prefab\", this.node);\r\n        this._rContent = find(\"bg/ScrollView/view/content\", this.node);\r\n    }\r\n\r\n    initLeaderRewardConfig() {\r\n        this._killLeaderRewardConfig = {\r\n            0: \"strengthBlood1\",\r\n            1: \"strengthBlood2\",\r\n            2: \"strengthBlood3\",\r\n            3: \"strengthBlood4\",\r\n            4: \"strengthBlood5\",\r\n            5: \"strengthDamage1\",\r\n            6: \"strengthDamage2\",\r\n            7: \"strengthDamage3\",\r\n            8: \"strengthDamage4\",\r\n            9: \"strengthDamage5\",\r\n            10: \"strengthMoveSpeed1\",\r\n            11: \"strengthMoveSpeed2\",\r\n            12: \"strengthMoveSpeed3\",\r\n            13: \"strengthMoveSpeed4\",\r\n            14: \"strengthMoveSpeed5\",\r\n        }\r\n    }\r\n    onDisable() {\r\n        ggd.stopAll = find(\"passRewardLayer\", this.node.parent).active;\r\n        // ggd.stopAll = false;\r\n\r\n    }\r\n    showKillLeaderReward(strengthType) {\r\n        let index = Math.random() * 5 | 0;\r\n        let result = em.dispatch(\"usingHeroControlFun\", \"updateBonusValue\", strengthType, index + 1);\r\n        em.dispatch(\"createTipsTex\", result);\r\n    }\r\n\r\n    showPassReward(all, string,isDouble=false) {\r\n        // console.log(\"showPassReward\",all);\r\n        all.forEach(data => {\r\n            console.log(data);\r\n            if (data.total > 0) {\r\n                let prefab = instantiate(this._prefab);\r\n                let itemData = em.dispatch(\"getItemDataByIdOrName\", data.id);\r\n                prefab.parent = this._rContent;\r\n                prefab.getChildByName(\"name\").getComponent(Label).string = itemData.name + \"x\" + data.total;\r\n                let sprite = prefab.getChildByName(\"sprite\").getComponent(Sprite);\r\n                let loadUrl = \"images/items/\" + itemData.loadUrl + \"/spriteFrame\";\r\n                em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => sprite.spriteFrame = assets);\r\n                prefab.active = true;\r\n            }\r\n        });\r\n        this.descriptionLabel.string = string;\r\n        this.killCountLabel.string = em.dispatch(\"geCurStageKillInfo\");\r\n        this.curStageLabel.string = \"第\" + ggd.curStage + \"关\";\r\n        if(isDouble) this.doubleTips.active = true;\r\n        else this.doubleTips.active = false;\r\n        ggd.stopAll = true;\r\n        this.node.active = true;\r\n        this._isPass = true;\r\n    }\r\n    closeLayer() {\r\n        if (this._isPass) {\r\n            // 跳出加载\r\n            this.node.getChildByName(\"loading\").active = true;\r\n            this.enterMainMenu();\r\n        }\r\n        else {\r\n            this.node.active = false;\r\n            find(\"Toggle\", this.node).active = false;\r\n            em.dispatch(\"usingMonsterManagerFun\", \"resumeAllAnim\");\r\n            em.dispatch(\"usingHeroControlFun\", \"resumeGame\");\r\n        }\r\n\r\n    }\r\n    enterMainMenu() {\r\n        let total = em.dispatch(\"getMonsterTotal\");\r\n        if (total <= 0) {\r\n            console.log(\"跳转到菜单界面\");\r\n            director.loadScene(\"mainMenu\", () => {\r\n                em.dispatch(\"switchMainBgm\", \"/audio/music/刀剑如梦\");\r\n            });\r\n        } else this.scheduleOnce(() => {\r\n            this.enterMainMenu();\r\n        }, 0.1);\r\n    }\r\n    openLayer() {\r\n        this.node.active = true;\r\n    }\r\n    //不在提示\r\n    onBtnNotNotice() {\r\n        this._notNoticeKillReward = !this._notNoticeKillReward;\r\n    }\r\n}\r\n\r\n"]}