{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/hero/weapon/ThousandsSwordToTomb.ts"],"names":["_decorator","Vec2","math","tween","Vec3","Sprite","Color","UITransform","BoxCollider2D","Contact2DType","em","ggd","groupIndex","tagData","Weapon","ccclass","property","ThousandsSwordToTomb","_moveDistance","_isPlayAnim","init","skillData","initSkillData","data","_damage","damage","moveDistance","node","getComponent","contentSize","x","console","log","_moveSpeed","_canAttackTimes","Infinity","_backDis","_attackInterval","_weaponName","name","color","wp","dispatch","xDir","random","Math","h","setWorldPosition","y","z","_flyDir","clearCacheData","initBoxCollider","sword","changeBulletRotationByFlyDir","tag","changeSize","collider","addComponent","group","heroWeapon","on","BEGIN_CONTACT","onBeginContact","END_CONTACT","onEndContact","weaponMove","deltaTime","stopAll","playDestroyAnim","dis","moveX","moveY","setPosition","getPosition","by","position","onUpdate","target","ratio","lerp","r","g","b","call","recoveryToPool","start"],"mappings":"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","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-09-20 11:45:37\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-10-26 16:14:14\r\n * @FilePath: \\copy9train\\assets\\script\\hero\\weapon\\ThousandsSwordToTomb.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, Vec2, math, tween, Vec3, Sprite, Color, color, UITransform, BoxCollider2D, Contact2DType } from 'cc';\r\nimport { em } from '../../global/EventManager';\r\nimport { ggd, groupIndex, tagData } from '../../global/globalData';\r\nimport { plm } from '../../global/PoolManager';\r\nimport { Weapon } from './Weapon';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ThousandsSwordToTomb')\r\nexport class ThousandsSwordToTomb extends Weapon {\r\n\r\n    _moveDistance: number;\r\n    _isPlayAnim: boolean;\r\n\r\n    init(skillData) {\r\n        this.initSkillData(skillData);\r\n    }\r\n    initSkillData(data) {\r\n        this._isPlayAnim = false;\r\n        this._damage = data.damage;\r\n        // this._moveDistance = data.moveDistance;\r\n        this._moveDistance = data.moveDistance - this.node.getComponent(UITransform).contentSize.x / 4;\r\n        console.log(\"data.moveDistance\", data.moveDistance);\r\n        console.log(\"this._moveDistance\", this._moveDistance);\r\n\r\n        this._moveSpeed = 2000;\r\n        this._canAttackTimes = Infinity;\r\n        this._backDis = 0;\r\n        this._attackInterval = 0.5;\r\n        this._weaponName = data.name;\r\n        this.node.getComponent(Sprite).color = new Color(255, 204, 0, 255);//恢复原来的颜色\r\n        let wp = em.dispatch(\"getHeroWorldPos\");\r\n        let xDir = math.random() > .5 ? Math.random() : -math.random();\r\n        xDir *= .7;\r\n        // xDir+=(xDir/Math.abs(xDir)*0.3);\r\n        let h = data.moveDistance;\r\n        this.node.setWorldPosition(wp.x - (h * xDir), wp.y + h, wp.z);\r\n        this._flyDir = new Vec2(xDir, -1);\r\n        console.log(\"this._flyDir\", this._flyDir);\r\n\r\n\r\n        this.clearCacheData();\r\n        this.initBoxCollider(tagData.sword);\r\n        this.changeBulletRotationByFlyDir();\r\n    }\r\n    initBoxCollider(tag: number, changeSize: { x, y } = { x: 0, y: 0 }) {\r\n        if (!tag) throw \"tag is\" + tag;\r\n        // let collider = this.node.addComponent(BoxCollider2D);\r\n        let collider = this.node.getComponent(BoxCollider2D);\r\n        if (!collider) collider = this.node.addComponent(BoxCollider2D);\r\n        collider.tag = tag;\r\n        collider.group = groupIndex.heroWeapon;\r\n        // console.log(\"collider\", collider);\r\n        collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        collider.on(Contact2DType.END_CONTACT, this.onEndContact, this);\r\n    }\r\n    weaponMove(deltaTime: number) {\r\n        // return;\r\n        if (ggd.stopAll) return;\r\n        if (!this._flyDir) return;\r\n        if (this._moveDistance <= 0) {\r\n            this.playDestroyAnim();\r\n            return;\r\n        }\r\n        if (this._moveSpeed == 0) return;\r\n\r\n        let dis = deltaTime * this._moveSpeed;\r\n        // let dis = deltaTime*(this._moveSpeed+bonusMS);\r\n        let moveX = this._flyDir.x * dis;\r\n        let moveY = this._flyDir.y * dis;\r\n        this.node.setPosition(this.node.getPosition().x + moveX, this.node.getPosition().y + moveY, 0);\r\n        this._moveDistance += moveY;\r\n\r\n    }\r\n    playDestroyAnim() {\r\n        if (this._isPlayAnim) return;\r\n        em.dispatch(\"playOneShot\",\"battle/砸地\");\r\n        this._isPlayAnim = true;\r\n        let color = new Color(255, 255, 255, 255);\r\n        tween(this.node).by(.5, { position: new Vec3(0, 0, 0) }, {\r\n            onUpdate: (target, ratio) => {\r\n                this.node.getComponent(Sprite).color = Color.lerp(new Color(), color, new Color(color.r, color.g, color.b, 0), ratio);\r\n            }\r\n        }).call(() => {\r\n            this.recoveryToPool();\r\n        }).start();\r\n    }\r\n}\r\n"]}