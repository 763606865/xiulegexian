{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/mainMenu/MainMenuGuide.ts"],"names":["_decorator","Component","Node","find","Vec3","tween","Label","Tween","em","ccclass","property","MainMenuGuide","_guideData","onDestroy","remove","onLoad","add","getGuideData","bind","setGuideData","initMainMenuByGuideData","openGuideTips","start","data","dispatch","key","Object","prototype","hasOwnProperty","call","console","log","SelectStageLayer","hideBtnsFromIndexStart","active","guideTipsLabel","string","guideTipsBg","HeroInfoLayer","stopAllByTag","node","wp","getWorldPosition","guideFinger","setWorldPosition","x","y","z","playGuideAnim1","TrainingLayer","MakePillsLayer","SkillBookLayer","value","a1","by","position","a2","action","sequence","repeatForever","tag","index","i","btnArr","length","closeGuideTips","content"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, find, Vec3, tween, Label, Tween } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 主菜单新手引导\r\n@ccclass('MainMenuGuide')\r\nexport class MainMenuGuide extends Component {\r\n    @property(Node)\r\n    guideFinger;\r\n    @property([Node])\r\n    btnArr;\r\n    @property(Node)\r\n    guideTipsBg;\r\n    @property(Label)\r\n    guideTipsLabel;\r\n\r\n    _guideData = {\r\n        \"SelectStageLayer\": false,\r\n        \"HeroInfoLayer\": false,//角色界面总引导\r\n        \"HeroInfoLayerSpace\": false,//仓库引导\r\n        \"HeroInfoLayerProperty\": false,//属性引导\r\n        \"TrainingLayer\": false,\r\n        \"MakePillsLayer\": false,\r\n        \"SkillBookLayer\": false,\r\n    }\r\n    onDestroy() {\r\n        em.remove(\"getGuideData\");\r\n        em.remove(\"setGuideData\");\r\n        em.remove(\"initMainMenuByGuideData\");\r\n        em.remove(\"openGuideTips\");\r\n    }\r\n    onLoad() {\r\n        em.add(\"getGuideData\", this.getGuideData.bind(this));\r\n        em.add(\"setGuideData\", this.setGuideData.bind(this));\r\n        em.add(\"initMainMenuByGuideData\", this.initMainMenuByGuideData.bind(this));\r\n        em.add(\"openGuideTips\", this.openGuideTips.bind(this));\r\n    }\r\n    start() {\r\n        let data = em.dispatch(\"getTempData\", \"guideData\");\r\n        if (data) {\r\n            for (const key in data) {//通过赋值的方式存取，可以在添加新属性时解决冲突问题\r\n                if (Object.prototype.hasOwnProperty.call(data, key) && this._guideData.hasOwnProperty(key)) {\r\n                    this._guideData[key] = data[key];\r\n                }\r\n            }\r\n        }\r\n        em.dispatch(\"savingToTempData\", \"guideData\", this._guideData);\r\n        this.initMainMenuByGuideData();\r\n    }\r\n    // 通过新手引导数据初始化主菜单\r\n    initMainMenuByGuideData() {\r\n        console.log(\"通过新手引导数据初始化主菜单\");\r\n        console.log(\"guide data\", this._guideData);\r\n\r\n        if (!this._guideData.SelectStageLayer) {\r\n            this.hideBtnsFromIndexStart(1);\r\n            find(\"Canvas/menuLayer/SelectStageLayer/guideSelectStage\").active = true;\r\n            this.guideTipsLabel.string = \"点击关卡,开始游戏。\\n海量怪兽等你挑战！\";\r\n            this.guideTipsBg.active = true;\r\n            this._guideData.SelectStageLayer = true;\r\n            em.dispatch(\"savingToTempData\", \"guideData\", this._guideData);\r\n        } else if (!this._guideData.HeroInfoLayer) {\r\n            this.hideBtnsFromIndexStart(2);\r\n            Tween.stopAllByTag(1);\r\n            this.guideTipsLabel.string = \"主角菜单包括仓库和属性。在仓库界面可以查看、使用、出售你的物品。在属性界面可以通过道法果提升自己的基础面板属性。\";\r\n            this.guideTipsBg.active = true;\r\n            let node = find(\"Canvas/menuLayer/selectBtnPar/btn2\");\r\n            let wp = node.getWorldPosition();\r\n            this.guideFinger.active = true;\r\n            this.guideFinger.setWorldPosition(wp.x, wp.y + 150, wp.z);\r\n            this.playGuideAnim1();\r\n        } else if (!this._guideData.TrainingLayer) {\r\n            this.hideBtnsFromIndexStart(3);\r\n            Tween.stopAllByTag(1);\r\n            let node = find(\"Canvas/menuLayer/selectBtnPar/btn3\");\r\n            let wp = node.getWorldPosition();\r\n            this.guideFinger.active = true;\r\n            this.guideFinger.setWorldPosition(wp.x, wp.y + 150, wp.z);\r\n            this.playGuideAnim1();\r\n        } else if (!this._guideData.MakePillsLayer) {\r\n            this.hideBtnsFromIndexStart(4);\r\n            Tween.stopAllByTag(1);\r\n            let node = find(\"Canvas/menuLayer/selectBtnPar/btn4\");\r\n            let wp = node.getWorldPosition();\r\n            this.guideFinger.active = true;\r\n            this.guideFinger.setWorldPosition(wp.x, wp.y + 150, wp.z);\r\n            this.playGuideAnim1();\r\n        } else if (!this._guideData.SkillBookLayer) {\r\n            this.hideBtnsFromIndexStart(5);\r\n            Tween.stopAllByTag(1);\r\n            let node = find(\"Canvas/menuLayer/selectBtnPar/btn5\");\r\n            let wp = node.getWorldPosition();\r\n            this.guideFinger.active = true;\r\n            this.guideFinger.setWorldPosition(wp.x, wp.y + 150, wp.z);\r\n            this.playGuideAnim1();\r\n        }\r\n    }\r\n    setGuideData(key, value = true) {\r\n        if (this._guideData.hasOwnProperty(key)) {\r\n            this._guideData[key] = value;\r\n            em.dispatch(\"savingToTempData\", \"guideData\", this._guideData);\r\n        } else {\r\n            throw \"set guide data error.\" + key + \" is invalid\";\r\n        }\r\n\r\n    }\r\n    //播放引导动画1\r\n    playGuideAnim1() {\r\n        let a1 = tween().by(0.5, { position: new Vec3(0, -100, 0) });\r\n        let a2 = tween().by(0.5, { position: new Vec3(0, 100, 0) });\r\n        let action = tween(this.guideFinger).sequence(a1, a2);\r\n        action = tween(this.guideFinger).repeatForever(action);\r\n        action.tag(1);\r\n        action.start();\r\n    }\r\n    // 隐藏所有菜单按钮\r\n    hideBtnsFromIndexStart(index) {\r\n        for (let i = 0; i < this.btnArr.length; i++) {\r\n            if (i >= index) this.btnArr[i].active = false;\r\n            else this.btnArr[i].active = true;\r\n        }\r\n    }\r\n    closeGuideTips() {\r\n        this.guideTipsLabel.string = \"\";\r\n        this.guideTipsBg.active = false;\r\n    }\r\n    //===========外部调用===========\r\n    // 获取新手引导数据\r\n    getGuideData() {\r\n        return this._guideData;\r\n    }\r\n    //开启引导提示\r\n    openGuideTips(content: string) {\r\n        this.guideTipsLabel.string = content;\r\n        this.guideTipsBg.active = true;\r\n    }\r\n}\r\n\r\n\r\n"]}