{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/ZA/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/mainMenu/UpgradeEquLvLayer.ts"],"names":["_decorator","Component","Node","Sprite","SpriteFrame","Label","Material","RichText","em","glf","plm","ccclass","property","UpgradeEquLvLayer","_itemPrefabArr","_curSelectItemData","_canUpgrade","_materialList","onLoad","createButton","node","curSelect","target","onEnable","updateEquList","onDisable","recoveryDefault","materialNode","getComponent","spriteFrame","getChildByName","string","itemQBg","data","length","prefab","shift","putToPool","list","dispatch","key","type","total","getFromPool","parent","itemContent","quality","initPrefabLv","sprite","loadUrl","assets","itemName","name","push","label","lv","console","log","onBtnItemInUpgradeEquLvLayer","e","p","data2","getEquNextLvData","materials","count","Object","prototype","hasOwnProperty","call","mData","isEnough","material","defaultMaterial","grayMaterial","onBtnUpgradeLv","targetLv","index","indexOf","targetName","slice","gets","onBtnEqu","colorStr","getColorStrByQuality","maskPar","description","showEquDetail","active","equName","effects","qData","effect","id","getColorStrByType","lData","baseDamage","damageTimes","attackInterval","blood","CHR","moveSpeed","onBtnClose","onBtnCloseEquDetail","curName","curLv","lvStr","nextName"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, SpriteFrame, Label, Material, RichText } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nimport { glf } from '../global/globalFun';\r\nimport { plm } from '../global/PoolManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('UpgradeEquLvLayer')\r\nexport class UpgradeEquLvLayer extends Component {\r\n\r\n    @property(Node)\r\n    itemContent;\r\n    @property(Node)\r\n    curSelect;\r\n    @property(Node)\r\n    target;\r\n    @property(Node)\r\n    maskPar;\r\n    @property(Material)\r\n    grayMaterial;\r\n    @property(Material)\r\n    defaultMaterial;\r\n    @property([SpriteFrame])\r\n    itemQBg: SpriteFrame[] = [];\r\n    @property([Node])\r\n    materialNode: Node[] = [];\r\n\r\n    _itemPrefabArr = [];\r\n    _curSelectItemData;\r\n    _canUpgrade: boolean = false;\r\n\r\n    _materialList = {\r\n        2: {\r\n            \"灵石\": 1000,\r\n            \"炼气丹\": 20\r\n        },\r\n        3: {\r\n            \"灵石\": 10000,\r\n            \"筑基丹\": 40\r\n        },\r\n        4: {\r\n            \"灵石\": 100000,\r\n            \"金元丹\": 100\r\n        },\r\n        5: {\r\n            \"灵石\": 100000,\r\n            \"元婴丹\": 200\r\n        }\r\n    }\r\n    onLoad() {\r\n        glf.createButton(this.node, this.curSelect, \"UpgradeEquLvLayer\", \"onBtnEqu\");\r\n        glf.createButton(this.node, this.target, \"UpgradeEquLvLayer\", \"onBtnEqu\");\r\n    }\r\n    onEnable() {\r\n        this.updateEquList();\r\n    }\r\n    onDisable() {\r\n        this.recoveryDefault();\r\n    }\r\n    // 恢复默认状态\r\n    recoveryDefault() {\r\n        for (const node of this.materialNode) {\r\n            node.getComponent(Sprite).spriteFrame = null;\r\n            node.getChildByName(\"Label\").getComponent(Label).string = \"\";\r\n        };\r\n        this.curSelect.getChildByName(\"Sprite\").getComponent(Sprite).spriteFrame = null;\r\n        this.target.getChildByName(\"Sprite\").getComponent(Sprite).spriteFrame = null;\r\n        this.curSelect.getComponent(Sprite).spriteFrame = this.itemQBg[0];\r\n        this.target.getComponent(Sprite).spriteFrame = this.itemQBg[0];\r\n        this.curSelect.getChildByName(\"Label\").getComponent(Label).string = \"\";\r\n        this.target.getChildByName(\"Label\").getComponent(Label).string = \"\";\r\n        this.curSelect.data = null;\r\n        this.target.data = null;\r\n\r\n        this._canUpgrade = false;\r\n        this._curSelectItemData = null;\r\n    }\r\n    // 刷新装备列表\r\n    updateEquList() {\r\n        while (this._itemPrefabArr.length > 0) {\r\n            let prefab = this._itemPrefabArr.shift();\r\n            plm.putToPool(\"SSLItemPrefab\", prefab);\r\n        }\r\n        let list = em.dispatch(\"getItemList\");\r\n        for (const key in list) {\r\n            let data = em.dispatch(\"getItemDataByIdOrName\", key);\r\n            if (data.type == \"装备\") {\r\n                let total = list[key];\r\n                let prefab = plm.getFromPool(\"SSLItemPrefab\");\r\n                prefab.parent = this.itemContent;\r\n                prefab.getChildByName(\"itemBg\").getComponent(Sprite).spriteFrame = this.itemQBg[data.quality - 1];\r\n                this.initPrefabLv(prefab, data);\r\n                let sprite = prefab.getChildByName(\"sprite\").getComponent(Sprite);\r\n                let loadUrl: string = data.loadUrl;\r\n                if (!data.loadUrl) loadUrl = \"item_default\";\r\n                loadUrl = \"images/items/\" + loadUrl + \"/spriteFrame\";\r\n                em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => sprite.spriteFrame = assets, () => {\r\n                    em.dispatch(\"loadTheDirResources\", \"images/items/item_default/spriteFrame\", (assets) => sprite.spriteFrame = assets);\r\n                });\r\n                // prefab.getChildByName(\"total\").getComponent(Label).string = \"X\" + total;\r\n                prefab.getChildByName(\"total\").getComponent(Label).string = total;\r\n                // prefab.getChildByName(\"name\").getComponent(Label).string = data.name;\r\n                prefab.itemName = data.name;//用于索引\r\n                this._itemPrefabArr.push(prefab);\r\n                glf.createButton(this.node, prefab.getChildByName(\"itemBg\"), \"UpgradeEquLvLayer\", \"onBtnItemInUpgradeEquLvLayer\", key);\r\n            }\r\n        }\r\n    }\r\n    // 初始化物品等级\r\n    initPrefabLv(prefab, data) {\r\n        let label = prefab.getChildByName(\"lv\").getComponent(Label);\r\n        if (data.type == \"装备\" && data.lv) {\r\n            console.log(\"初始化阶\");\r\n            let list = { 1: \"一阶\", 2: \"二阶\", 3: \"三阶\", 4: \"四阶\", 5: \"五阶\", 6: \"六阶\", 7: \"七阶\", 8: \"八阶\", 9: \"九阶\" };\r\n            label.string = list[data.lv];\r\n        } else label.string = \"\";\r\n    }\r\n    // 在升阶界面 点击item\r\n    onBtnItemInUpgradeEquLvLayer(e, p) {\r\n        let data = em.dispatch(\"getItemDataByIdOrName\", p);\r\n        console.log(\"onBtnItemInUpgradeEquLvLayer\", data);\r\n        if (data.lv >= 5) {\r\n            em.dispatch(\"tipsViewShow\", \"已达到最大等级，无法升级。\");\r\n            return;\r\n        };\r\n        let data2 = this.getEquNextLvData(data.name, data.lv);\r\n        console.log(\"data2\", data2);\r\n        this._curSelectItemData = data;\r\n        //初始化背景\r\n        this.curSelect.getComponent(Sprite).spriteFrame = this.itemQBg[data.quality - 1];\r\n        this.target.getComponent(Sprite).spriteFrame = this.itemQBg[data.quality - 1];\r\n        this.curSelect.data = data;\r\n        this.target.data = data2;\r\n        // 初始化物品图片\r\n        let loadUrl: string = data.loadUrl;\r\n        if (!data.loadUrl) loadUrl = \"item_default\";\r\n        loadUrl = \"images/items/\" + loadUrl + \"/spriteFrame\";\r\n        em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => {\r\n            this.curSelect.getChildByName(\"Sprite\").getComponent(Sprite).spriteFrame = assets;\r\n            this.target.getChildByName(\"Sprite\").getComponent(Sprite).spriteFrame = assets;\r\n        }, () => {\r\n            em.dispatch(\"loadTheDirResources\", \"images/items/item_default/spriteFrame\", (assets) => {\r\n                this.curSelect.getChildByName(\"Sprite\").getComponent(Sprite).spriteFrame = assets;\r\n                this.target.getChildByName(\"Sprite\").getComponent(Sprite).spriteFrame = assets;\r\n            });\r\n        });\r\n        //初始化阶\r\n        let list = { 1: \"一阶\", 2: \"二阶\", 3: \"三阶\", 4: \"四阶\", 5: \"五阶\", 6: \"六阶\", 7: \"七阶\", 8: \"八阶\", 9: \"九阶\" };\r\n        this.curSelect.getChildByName(\"Label\").getComponent(Label).string = list[data.lv];\r\n        this.target.getChildByName(\"Label\").getComponent(Label).string = list[data.lv + 1];\r\n        //升阶材料\r\n        let materials = this._materialList[data.lv + 1];\r\n        let count = 0;\r\n        this._canUpgrade = true;\r\n        for (const key in materials) {\r\n            if (Object.prototype.hasOwnProperty.call(materials, key)) {\r\n                const total = materials[key];\r\n                let mData = em.dispatch(\"getItemDataByIdOrName\", key);\r\n                console.log(\"需要\" + key + \"x\" + total);\r\n                let node = this.materialNode[count];\r\n                let isEnough = em.dispatch(\"itemIsEnough\", key, total);\r\n                if (isEnough) node.getComponent(Sprite).material = this.defaultMaterial;\r\n                else {\r\n                    node.getComponent(Sprite).material = this.grayMaterial;\r\n                    this._canUpgrade = false;\r\n                }\r\n                node.getChildByName(\"Label\").getComponent(Label).string = \"x\" + total;\r\n                let loadUrl = \"images/items/\" + mData.loadUrl + \"/spriteFrame\";\r\n                em.dispatch(\"loadTheDirResources\", loadUrl, (assets) => {\r\n                    node.getComponent(Sprite).spriteFrame = assets;\r\n                }, () => {\r\n                    em.dispatch(\"loadTheDirResources\", \"images/items/item_default/spriteFrame\", (assets) => {\r\n                        node.getComponent(Sprite).spriteFrame = assets;\r\n                    });\r\n                });\r\n                count++;\r\n            };\r\n        };\r\n    }\r\n    //升阶\r\n    onBtnUpgradeLv() {\r\n        if (!this._curSelectItemData) {\r\n            em.dispatch(\"tipsViewShow\", \"请先选择装备，再点击升阶！\");\r\n            return;\r\n        }\r\n        if (!this._canUpgrade) {\r\n            em.dispatch(\"tipsViewShow\", \"材料不足，无法升阶。\");\r\n            return;\r\n        }\r\n        //消耗合成材料\r\n        let materials = this._materialList[this._curSelectItemData.lv + 1];\r\n        for (const key in materials) {\r\n            if (Object.prototype.hasOwnProperty.call(materials, key)) {\r\n                const total = materials[key];\r\n                em.dispatch(\"reduceItemFromSS\", key, total);\r\n            }\r\n        }\r\n        em.dispatch(\"reduceItemFromSS\", this._curSelectItemData.name, 1);\r\n        let list = { 1: \"一阶\", 2: \"二阶\", 3: \"三阶\", 4: \"四阶\", 5: \"五阶\", 6: \"六阶\", 7: \"七阶\", 8: \"八阶\", 9: \"九阶\" };\r\n        let targetLv = list[this._curSelectItemData.lv + 1];\r\n        let index = this._curSelectItemData.name.indexOf(\"（\");\r\n        let targetName = this._curSelectItemData.name.slice(0, index + 1) + targetLv + \"）\";\r\n        console.log(\"targetName\", targetName);\r\n\r\n        em.dispatch(\"addItemToSS\", targetName, 1);\r\n        let gets = {};\r\n        gets[targetName] = 1;\r\n        em.dispatch(\"showGets\", gets);\r\n        this.recoveryDefault();\r\n        //刷新物品\r\n        this.updateEquList();\r\n    }\r\n    onBtnEqu(e) {\r\n        let data = e.target.data;\r\n        if (!data) return;\r\n        let colorStr = this.getColorStrByQuality(data.quality - 1);\r\n        this.maskPar.getChildByName(\"name\").getComponent(RichText).string = colorStr + data.name + \"</color>\";\r\n        this.maskPar.getChildByName(\"description\").getComponent(RichText).string = data.description;\r\n        console.log(\"onBtnEqu\",data);\r\n        \r\n        this.showEquDetail(data.name);\r\n        this.maskPar.active = true;\r\n    }\r\n    showEquDetail(equName) {\r\n        let data = em.dispatch(\"usingHeroBasePropertyFun\", \"getEquDataByName\", equName);\r\n        let effects = data.qData.effect;\r\n        //根据quality 设置颜色 还没写\r\n        let string = \"\";\r\n        for (const id of effects) {\r\n            let effect = em.dispatch(\"usingHeroBasePropertyFun\", \"getEquEffectData\", id);\r\n            console.log(\"effect\", effect);\r\n            // let colorStr = this.getColorStrByQuality(effect.quality - 1);\r\n            let colorStr = this.getColorStrByType(effect.type - 1);\r\n            string = string + colorStr + effect.name + \":\" + effect.description + \"</color>\\n\";\r\n        }\r\n        if (data.lData.baseDamage) string = string + \"基础伤害:+\" + data.lData.baseDamage + \"\\n\";\r\n        if (data.lData.damageTimes) string = string + \"伤害加成倍数:+\" + data.lData.damageTimes + \"\\n\";\r\n        if (data.lData.attackInterval) string = string + \"攻击间隔:\" + data.lData.attackInterval + \"\\n\";\r\n        if (data.lData.blood) string = string + \"血量:+\" + data.lData.blood + \"\\n\";\r\n        if (data.lData.CHR) string = string + \"暴击率:+\" + data.lData.CHR + \"\\n\";\r\n        if (data.lData.moveSpeed) string = string + \"移动速度:+\" + data.lData.moveSpeed + \"\\n\";\r\n        this.maskPar.getChildByName(\"description\").getComponent(RichText).string = string;\r\n    }\r\n    // 通过物品品质 获得 物品颜色值\r\n    getColorStrByType(index) {\r\n        index > 2 ? 2 : index;\r\n        return [\"<color=#757575>\", \"<color=#A474CF>\", \"<color=#DDA75A>\"][index];\r\n    }\r\n    getColorStrByQuality(index) {\r\n        index > 4 ? 4 : index;\r\n        return [\"<color=#599A65>\", \"<color=#728CC7>\", \"<color=#A474CF>\", \"<color=#C65C37>\", \"<color=#DDA75A>\"][index];\r\n        // return [\"<color=#7EFFA7>\",\"<color=#7EEAFF>\",\"<color=#837EFF>\",\"<color=#FFB77E>\",\"<color=#FFE000>\"][index];\r\n    }\r\n    onBtnClose() {\r\n        em.dispatch(\"usingHeroInfoLayerFun\", \"updateStorageSpace\");\r\n        this.node.active = false;\r\n    }\r\n    onBtnCloseEquDetail() {\r\n        this.maskPar.active = false;\r\n    }\r\n    // 获取下一阶物品物品数据\r\n    getEquNextLvData(curName, curLv) {\r\n        let index = curName.indexOf(\"（\");\r\n        let name = curName.slice(0, index);\r\n        let list = { 1: \"一阶\", 2: \"二阶\", 3: \"三阶\", 4: \"四阶\", 5: \"五阶\", 6: \"六阶\", 7: \"七阶\", 8: \"八阶\", 9: \"九阶\" };\r\n        let lvStr = list[curLv + 1];\r\n        if (!lvStr) throw \"lvStr is error\";\r\n        let nextName = name + \"（\" + lvStr + \"）\";\r\n        return em.dispatch(\"getItemDataByIdOrName\", nextName);\r\n    }\r\n}\r\n\r\n\r\n"]}