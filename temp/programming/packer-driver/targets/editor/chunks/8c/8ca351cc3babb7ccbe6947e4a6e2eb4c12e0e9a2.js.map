{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/preLoad/DynamicLoading.ts"],"names":["_decorator","Component","resources","director","em","PreLoad","ccclass","property","DynamicLoading","onDestroy","remove","onLoad","add","loadTheDirResources","bind","loadTheDir","preLoadAllResources","addPersistRootNode","node","loadDir","finished","total","item","preLoadScript","updateLoadingProgress","err","assets","console","log","showLoginLayer","dir","callback","errCallback","load"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAUSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,S,OAAAA,S;AAA4CC,MAAAA,Q,OAAAA,Q;;AACzEC,MAAAA,E,iBAAAA,E;;AACAC,MAAAA,O,iBAAAA,O;;;;;;AAZT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;OAIM;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;;gCAGjBQ,c,WADZF,OAAO,CAAC,gBAAD,C,UAEHC,QAAQ;AAAA;AAAA,6B,2BAFb,MACaC,cADb,SACoCP,SADpC,CAC8C;AAAA;AAAA;;AAAA;AAAA;;AAI1CQ,QAAAA,SAAS,GAAG;AACR;AAAA;AAAA,wBAAGC,MAAH,CAAU,qBAAV;AACA;AAAA;AAAA,wBAAGA,MAAH,CAAU,YAAV;AACH;;AACDC,QAAAA,MAAM,GAAG;AACL;AAAA;AAAA,wBAAGC,GAAH,CAAO,qBAAP,EAA8B,KAAKC,mBAAL,CAAyBC,IAAzB,CAA8B,IAA9B,CAA9B;AACA;AAAA;AAAA,wBAAGF,GAAH,CAAO,YAAP,EAAqB,KAAKG,UAAL,CAAgBD,IAAhB,CAAqB,IAArB,CAArB;AACA,eAAKE,mBAAL,GAHK,CAIL;;AACAb,UAAAA,QAAQ,CAACc,kBAAT,CAA4B,KAAKC,IAAjC;AACH,SAdyC,CAe1C;;;AACAF,QAAAA,mBAAmB,GAAG;AAClBd,UAAAA,SAAS,CAACiB,OAAV,CAAkB,EAAlB,EAAsB,CAACC,QAAD,EAAmBC,KAAnB,EAAkCC,IAAlC,KAAqE;AACvF;AACA;AACA;AAEA,iBAAKC,aAAL,CAAmBC,qBAAnB,CAAyCJ,QAAQ,GAAGC,KAApD;AACH,WAND,EAMG,CAACI,GAAD,EAAMC,MAAN,KAAiB;AAChB,gBAAID,GAAJ,EAAS;AACLE,cAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ;AACA;AACH,aAHD,MAGO;AACH;AACA;AACA,mBAAKF,aAAL,CAAmBM,cAAnB;AACH;AACJ,WAfD;AAgBH,SAjCyC,CAkC1C;;;AACAd,QAAAA,UAAU,CAACe,GAAD,EAAMC,QAAQ,GAAG,IAAjB,EAAuB;AAC7B7B,UAAAA,SAAS,CAACiB,OAAV,CAAkBW,GAAlB,EAAuB,CAACL,GAAD,EAAMC,MAAN,KAAiB;AACpC,gBAAID,GAAJ,EAAS;AACLE,cAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ;AACA;AACH,aAHD,MAGO;AACH;AACA,kBAAIM,QAAJ,EAAcA,QAAQ,CAACL,MAAD,CAAR;AACjB;AACJ,WARD;AASH,SA7CyC,CA8C1C;;;AACAb,QAAAA,mBAAmB,CAACiB,GAAD,EAAMC,QAAQ,GAAG,IAAjB,EAAsBC,WAAW,GAAG,IAApC,EAA0C;AACzD9B,UAAAA,SAAS,CAAC+B,IAAV,CAAeH,GAAf,EAAoB,CAACL,GAAD,EAAMC,MAAN,KAAiB;AACjC,gBAAID,GAAJ,EAAS;AACL,kBAAGO,WAAH,EAAgBA,WAAW,GAA3B,KACKL,OAAO,CAACC,GAAR,CAAYH,GAAZ;AACL;AACH,aAJD,MAIO;AACH;AACA,kBAAIM,QAAJ,EAAcA,QAAQ,CAACL,MAAD,CAAR;AACjB;AACJ,WATD;AAUH;;AA1DyC,O","sourcesContent":["/*\r\n * @Author: li_jiang_wei_12345 739671694@qq.com\r\n * @Date: 2022-09-14 11:37:52\r\n * @LastEditors: li_jiang_wei_12345 739671694@qq.com\r\n * @LastEditTime: 2022-10-27 10:34:22\r\n * @FilePath: \\copy9train\\assets\\script\\preLoad\\DynamicLoading.ts\r\n * @Description: \r\n * \r\n * Copyright (c) 2022 by li_jiang_wei_12345 739671694@qq.com, All Rights Reserved. \r\n */\r\nimport { _decorator, Component, Node, resources, SpriteFrame, game, AssetManager, director } from 'cc';\r\nimport { em } from '../global/EventManager';\r\nimport { PreLoad } from './PreLoad';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('DynamicLoading')\r\nexport class DynamicLoading extends Component {\r\n    @property(PreLoad)\r\n    preLoadScript;\r\n\r\n    onDestroy() {\r\n        em.remove(\"loadTheDirResources\");\r\n        em.remove(\"loadTheDir\");\r\n    }\r\n    onLoad() {\r\n        em.add(\"loadTheDirResources\", this.loadTheDirResources.bind(this));\r\n        em.add(\"loadTheDir\", this.loadTheDir.bind(this));\r\n        this.preLoadAllResources();\r\n        // this.loadTheDir(\"anim/enemy/monster\");\r\n        director.addPersistRootNode(this.node);\r\n    }\r\n    // 加载所有资源\r\n    preLoadAllResources() {\r\n        resources.loadDir(\"\", (finished: number, total: number, item: AssetManager.RequestItem) => {\r\n            // console.log(\"finished\",finished);\r\n            // console.log(\"total\",total);\r\n            // console.log(\"item\",item);\r\n            \r\n            this.preLoadScript.updateLoadingProgress(finished / total);\r\n        }, (err, assets) => {\r\n            if (err) {\r\n                console.log(err);\r\n                return;\r\n            } else {\r\n                // console.log(\"assets\",assets);\r\n                // this.preLoadScript.enterMainMenuScene();\r\n                this.preLoadScript.showLoginLayer();\r\n            }\r\n        });\r\n    }\r\n    // 加载文件夹 assets 为数组\r\n    loadTheDir(dir, callback = null) {\r\n        resources.loadDir(dir, (err, assets) => {\r\n            if (err) {\r\n                console.log(err);\r\n                return;\r\n            } else {\r\n                // console.log(\"loadTheDir\",assets);\r\n                if (callback) callback(assets);\r\n            }\r\n        });\r\n    }\r\n    //加载具体路径资源 asset为单个资源\r\n    loadTheDirResources(dir, callback = null,errCallback = null) {\r\n        resources.load(dir, (err, assets) => {\r\n            if (err) {\r\n                if(errCallback) errCallback();\r\n                else console.log(err);\r\n                return;\r\n            } else {\r\n                // console.log(\"loadTheDirResources\",assets);\r\n                if (callback) callback(assets);\r\n            }\r\n        })\r\n    }\r\n\r\n}\r\n\r\n"]}