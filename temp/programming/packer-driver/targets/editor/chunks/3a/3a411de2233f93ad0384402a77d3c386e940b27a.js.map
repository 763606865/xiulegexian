{"version":3,"sources":["file:///C:/Users/Administrator/Desktop/Cocos/%E4%BF%AE%E4%BA%86%E4%B8%AA%E4%BB%99/assets/script/hero/weapon/ThunderFissionBead.ts"],"names":["_decorator","find","Animation","em","tagData","plm","Weapon","ccclass","property","ThunderFissionBead","_canSplitTimes","init","splitTimes","dir","_flyDir","initSkillData","isExceedMaxDistance","node","getComponent","play","addToAnimManger","data","dispatch","_curData","_weaponId","id","_weaponName","name2","_maxLevel","maxLevel","_duration","_damage","baseDamage","_damageTimes","damageTimes","_moveSpeed","_attackInterval","initBoxCollider","sword","clearCacheData","update","deltaTime","weaponMove","weaponDuration","colliderMonster","other","isStopRun","updateMonsterBlood","changeFlyDir","colliderBoss","updateBossBlood","radian","Math","sin","random","x","y","dir1","getRotationDir","dir2","createSplitTFB","x2","cos","y2","TFB","getFromPool","layer","parent","wp","getWorldPosition","unit","setWorldPosition","z","recoveryToPool","removeAnimFromList","putToPool"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAA6BC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,S,OAAAA,S;;AACnCC,MAAAA,E,iBAAAA,E;;AACKC,MAAAA,O,iBAAAA,O;;AACLC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,M,iBAAAA,M;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;oCAGjBS,kB,WADZF,OAAO,CAAC,oBAAD,C,gBAAR,MACaE,kBADb;AAAA;AAAA,4BAC+C;AAAA;AAAA;AAAA,eAE3CC,cAF2C,GAElB,CAFkB;AAAA;;AAI3CC,QAAAA,IAAI,CAACC,UAAD,EAAoBC,GAApB,EAAyB;AACzB,eAAKH,cAAL,GAAsBE,UAAtB;AACA,eAAKE,OAAL,GAAeD,GAAf;AACA,eAAKE,aAAL,GAHyB,CAIzB;AACA;;AACA,eAAKC,mBAAL,CAAyB,GAAzB,EAA8B,CAA9B;AACA,eAAKC,IAAL,CAAUC,YAAV,CAAuBhB,SAAvB,EAAkCiB,IAAlC;AACA,eAAKC,eAAL;AACH,SAb0C,CAe3C;;;AACAL,QAAAA,aAAa,GAAG;AACZ,cAAIM,IAAI,GAAG;AAAA;AAAA,wBAAGC,QAAH,CAAY,0BAAZ,EAAwC,4BAAxC,EAAsE,oBAAtE,CAAX;AACA,eAAKC,QAAL,GAAgBF,IAAhB;AACA,eAAKG,SAAL,GAAiBH,IAAI,CAACI,EAAtB;AACA,eAAKC,WAAL,GAAmBL,IAAI,CAACM,KAAxB;AACA,eAAKC,SAAL,GAAiBP,IAAI,CAACQ,QAAtB,CALY,CAMZ;;AACA,eAAKC,SAAL,GAAiB,EAAjB;AACA,eAAKC,OAAL,GAAeV,IAAI,CAACW,UAApB;AACA,eAAKC,YAAL,GAAoBZ,IAAI,CAACa,WAAzB,CATY,CAUZ;;AACA,eAAKC,UAAL,GAAkB,EAAlB;AACA,eAAKC,eAAL,GAAuB,GAAvB;AACA,eAAKC,eAAL,CAAqB;AAAA;AAAA,kCAAQC,KAA7B;AACA,eAAKC,cAAL;AACH;;AACDC,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACtB,eAAKC,UAAL,CAAgBD,SAAhB;AACA,eAAKE,cAAL,CAAoBF,SAApB;AACH;;AACDG,QAAAA,eAAe,CAACC,KAAD,EAAQ;AACnB,cAAI,KAAKC,SAAL,CAAeD,KAAf,CAAJ,EAA2B;AAC3B,eAAKE,kBAAL,CAAwBF,KAAxB;AACA,eAAKG,YAAL;AACH;;AACDC,QAAAA,YAAY,CAACJ,KAAD,EAAQ;AAChB,cAAI,KAAKC,SAAL,CAAeD,KAAf,CAAJ,EAA2B;AAC3B,eAAKK,eAAL,CAAqBL,KAArB;AACA,eAAKG,YAAL;AACH;;AACDA,QAAAA,YAAY,GAAG;AACX,YAAE,KAAKtC,cAAP,CADW,CAEX;;AACA,cAAIyC,MAAM,GAAGC,IAAI,CAACC,GAAL,CAAS,KAAKD,IAAI,CAACE,MAAL,KAAgB,EAA9B,CAAb,CAHW,CAIX;;AACA,eAAKxC,OAAL,CAAayC,CAAb,GAAiB,CAAC,KAAKzC,OAAL,CAAayC,CAA/B;AACA,eAAKzC,OAAL,CAAa0C,CAAb,GAAiB,CAAC,KAAK1C,OAAL,CAAa0C,CAA/B;AACA,cAAIC,IAAI,GAAG,KAAKC,cAAL,CAAoB,KAAK5C,OAAzB,EAAkCqC,MAAlC,CAAX;AACA,eAAKrC,OAAL,GAAe2C,IAAf;;AACA,cAAI,KAAK/C,cAAL,GAAsB,CAA1B,EAA6B;AACzB,gBAAIiD,IAAI,GAAG,KAAKD,cAAL,CAAoB,KAAK5C,OAAzB,EAAkC,CAACqC,MAAnC,CAAX;AACA,iBAAKS,cAAL,CAAoBD,IAApB;AACH;AAEJ,SA5D0C,CA6D3C;;;AACAD,QAAAA,cAAc,CAAC7C,GAAD,EAAMsC,MAAN,EAAc;AACxB;AACA,cAAII,CAAC,GAAG1C,GAAG,CAAC0C,CAAZ;AACA,cAAIC,CAAC,GAAG3C,GAAG,CAAC2C,CAAZ;AACA,cAAIK,EAAE,GAAGN,CAAC,GAAGH,IAAI,CAACU,GAAL,CAASX,MAAT,CAAJ,GAAuBK,CAAC,GAAGJ,IAAI,CAACC,GAAL,CAASF,MAAT,CAApC;AACA,cAAIY,EAAE,GAAGR,CAAC,GAAGH,IAAI,CAACC,GAAL,CAASF,MAAT,CAAJ,GAAuBK,CAAC,GAAGJ,IAAI,CAACU,GAAL,CAASX,MAAT,CAApC;AACA,iBAAO;AAAEI,YAAAA,CAAC,EAAEM,EAAL;AAASL,YAAAA,CAAC,EAAEO;AAAZ,WAAP;AACH,SArE0C,CAsE3C;;;AACAH,QAAAA,cAAc,CAAC/C,GAAD,EAAM;AAChB,cAAImD,GAAG,GAAG;AAAA;AAAA,0BAAIC,WAAJ,CAAgB,oBAAhB,CAAV;AACA,cAAIC,KAAK,GAAGjE,IAAI,CAAC,oBAAD,CAAhB;AACA+D,UAAAA,GAAG,CAACG,MAAJ,GAAaD,KAAb;AACA,cAAIE,EAAE,GAAG,KAAKnD,IAAL,CAAUoD,gBAAV,EAAT;AACA,cAAIC,IAAI,GAAG,EAAX;AACAN,UAAAA,GAAG,CAACO,gBAAJ,CAAqBH,EAAE,CAACb,CAAH,GAAO1C,GAAG,CAAC0C,CAAJ,GAAQe,IAApC,EAA0CF,EAAE,CAACZ,CAAH,GAAO3C,GAAG,CAAC2C,CAAJ,GAAQc,IAAzD,EAA+DF,EAAE,CAACI,CAAlE,EANgB,CAOhB;;AACAR,UAAAA,GAAG,CAAC9C,YAAJ,CAAiB,oBAAjB,EAAuCP,IAAvC,CAA4C,KAAKD,cAAjD,EAAiEG,GAAjE;AACH,SAhF0C,CAiF3C;;;AACA4D,QAAAA,cAAc,GAAG;AACb,eAAKC,kBAAL;AACA;AAAA;AAAA,0BAAIC,SAAJ,CAAc,KAAKjD,WAAnB,EAAgC,KAAKT,IAArC;AACH;;AArF0C,O","sourcesContent":["import { _decorator, Component, Node, find, Animation } from 'cc';\r\nimport { em } from '../../global/EventManager';\r\nimport { ggd, tagData } from '../../global/globalData';\r\nimport { plm } from '../../global/PoolManager';\r\nimport { Weapon } from './Weapon';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ThunderFissionBead')\r\nexport class ThunderFissionBead extends Weapon {\r\n\r\n    _canSplitTimes: number = 0;\r\n\r\n    init(splitTimes:number, dir) {\r\n        this._canSplitTimes = splitTimes;\r\n        this._flyDir = dir;\r\n        this.initSkillData();\r\n        //em.dispatch(\"playOneShot\",\"battle/bullet\");\r\n        //每秒检测一次是否超过距离\r\n        this.isExceedMaxDistance(500, 1);\r\n        this.node.getComponent(Animation).play();\r\n        this.addToAnimManger();\r\n    }\r\n\r\n    // 初始化武器信息\r\n    initSkillData() {\r\n        let data = em.dispatch(\"usingHeroBasePropertyFun\", \"getSkillBookDataByIdOrName\", \"thunderFissionBead\");\r\n        this._curData = data;\r\n        this._weaponId = data.id;\r\n        this._weaponName = data.name2;\r\n        this._maxLevel = data.maxLevel;\r\n        // this._duration = data.duration;\r\n        this._duration = 10;\r\n        this._damage = data.baseDamage;\r\n        this._damageTimes = data.damageTimes;\r\n        // this._moveSpeed = 600;\r\n        this._moveSpeed = 60;\r\n        this._attackInterval = 0.5;\r\n        this.initBoxCollider(tagData.sword);\r\n        this.clearCacheData();\r\n    }\r\n    update(deltaTime: number) {\r\n        this.weaponMove(deltaTime);\r\n        this.weaponDuration(deltaTime);\r\n    }\r\n    colliderMonster(other) {\r\n        if (this.isStopRun(other)) return;\r\n        this.updateMonsterBlood(other);\r\n        this.changeFlyDir();\r\n    }\r\n    colliderBoss(other) {\r\n        if (this.isStopRun(other)) return;\r\n        this.updateBossBlood(other);\r\n        this.changeFlyDir();\r\n    }\r\n    changeFlyDir() {\r\n        --this._canSplitTimes;\r\n        // let radian = Math.sin(Math.random() * 30);\r\n        let radian = Math.sin(30 + Math.random() * 30);\r\n        //反向向量\r\n        this._flyDir.x = -this._flyDir.x;\r\n        this._flyDir.y = -this._flyDir.y;\r\n        let dir1 = this.getRotationDir(this._flyDir, radian);\r\n        this._flyDir = dir1;\r\n        if (this._canSplitTimes > 0) {\r\n            let dir2 = this.getRotationDir(this._flyDir, -radian);\r\n            this.createSplitTFB(dir2);\r\n        }\r\n\r\n    }\r\n    // 获取旋转后的方向\r\n    getRotationDir(dir, radian) {\r\n        //向量旋转指定弧度的角度\r\n        let x = dir.x;\r\n        let y = dir.y;\r\n        let x2 = x * Math.cos(radian) - y * Math.sin(radian);\r\n        let y2 = x * Math.sin(radian) + y * Math.cos(radian);\r\n        return { x: x2, y: y2 };\r\n    }\r\n    // 创建分裂珠子\r\n    createSplitTFB(dir) {\r\n        let TFB = plm.getFromPool(\"thunderFissionBead\");\r\n        let layer = find(\"Canvas/bulletLayer\");\r\n        TFB.parent = layer;\r\n        let wp = this.node.getWorldPosition();\r\n        let unit = 50;\r\n        TFB.setWorldPosition(wp.x + dir.x * unit, wp.y + dir.y * unit, wp.z);\r\n        // TFB.setWorldPosition(wp);\r\n        TFB.getComponent(\"ThunderFissionBead\").init(this._canSplitTimes, dir);\r\n    }\r\n    //自我销毁\r\n    recoveryToPool() {\r\n        this.removeAnimFromList();\r\n        plm.putToPool(this._weaponName, this.node);\r\n    }\r\n}\r\n\r\n"]}